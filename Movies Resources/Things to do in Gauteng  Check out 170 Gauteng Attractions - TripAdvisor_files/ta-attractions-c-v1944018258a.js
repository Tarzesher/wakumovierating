(function(e){var g="MAP";var i="FILTER";var k=function(q,n,p){ops={ajax:1,geo:modelGeoId};if(p){ops.Action=p}if(q){ops.o="a"+q}if(n){ops.sortOrder=n}var m=e.id("ATTR_MAP");if(m&&m.moved){var l=m.map.mapCenter();var o=m.map.getZoom();e.store("attrMapCenter",l);e.store("attrMapZoom",o);ops.mc=l.lat()+","+l.lng();ops.mz=m.map.getZoom()}if(p=="MAP"){c().show();e.servlet.Attractions.movedMap(m.map.mapCenter().lat(),m.map.mapCenter().lng())}if(m){m.map.replaceMarkers(ATTRACTION_MAP_MARKERS,"attraction",Object.merge({pid:1360,titlePID:1360},e.maps.MARKER_ATTRACTION))}};rules["#EATERY_LIST_CONTENTS .js_pageLinks a"]=function(l){l.addEvent("click",pageList)};e.queueForLoad(function(){var l=e.id("ATTR_MAP");if(l){(function(){l.getElement(".loading").show();new Asset.javascript(mapsJs,{onload:function(){e.util.load.maps(f)}})}).delay(100)}},"attraction map setup");var f=function(){var l=e.id("ATTR_MAP");var m=window[l.id];if(GBrowserIsCompatible()&&m){l.empty();l.map=new e.maps.Map(l,{origLat:m.lat,origLng:m.lng,zoom:m.zoom,smallMap:true,typeControl:false,homeIcon:false}).addEvent("onMove",a).addEvent("onZoom",h).addEvent("onReset",j).addEvent("onMapUpdate",b).addEvent("homePinOnly",function(){e.id("ATTR_ZOOM_ERR").show()}).addEvent("allPins",function(){e.id("ATTR_ZOOM_ERR").hide()});l.map.origOps=m;l.map.addMarkers(ATTRACTION_MAP_MARKERS,"attraction",Object.merge({pid:1360,titlePID:1360},e.maps.MARKER_ATTRACTION));e.id("ATTR_MAP").addEvent("onMapUpdate",b)}};function c(){var l=e.retrieve("filters.waitDialog");var m="mg s1 fatNotice";if(e.isAttractionsRedesign2012()){m+=" fatNotice_2011"}if(!l){l=new e.overlays.CenteredOverlay({style:m,showCloseButton:false,autoShow:false});l.inner.set("html","<b>"+JS_UpdatingYourResults+"</b>");e.store("filters.waitDialog",l)}return l}var d=function(l){k(null,this.options[this.selectedIndex].value)};var a=function(l){if(l||this.getZoom()<10){return}e.id("ATTR_MAP").moved=true;k(null,null,g)};var h=function(m,l){e.id("ATTR_MAP").moved=true;if(l<10){return}k(null,null,g)};var j=function(){e.id("ATTR_MAP").moved=false;e.id("add_location_input").value=map_enteraddress;e.maps.Sidebar._clearLocationError();e.id("ATTR_MAP").map.replaceMarkers([],"location",[]);k(null,null,g)};var b=function(){k(null,null,"")}}(ta));var onSelectLocationTypeAhead=function(c,f,d){var e=f?f.coords:null;var b;if(e){var a=e.split(",");b=new ta.maps.Location(a[0],a[1])}return ta.maps.Sidebar.addLocation(null,d,b,f)};ta.servlet.Attractions={isDistanceSet:false,isNameSet:false,selectedCategories:new Array(),makeRequest:function(a,i,j){var g,c;if(j){g=j[0];c=j[1]}if(!c){var e=ta.id("sortOrder");if(e){c=e.value}}var o=ta.id("FF_SORT_AVAILABLE_CALLOUT")||ta.id("FF_SORT_ACTIVE_CALLOUT");if(o){o.style.display="none"}var k=ta.id("HAC_FRIEND_SUMMARY_BUBBLE");if(k){k.style.display="none"}if(a&&!a.preventDefault){a=new Event(a)}if(a){a.preventDefault()}var b=ta.servlet.Attractions.selectedCategories,l={};if(!b.length==0){l.cat=escape(b.join(","))}if(g&&g!=null){l.o=escape(g[1])}if(typeof c!="undefined"){l.sortOrder=escape(c)}if(ta.has("mapProviderFeature.maps_api")){var f=ta.retrieve("mapProviderFeature.maps_api");l.mapProviderFeature=f}if(ta.has("attrMapCenter")){var d=ta.retrieve("attrMapCenter");l.latLng=d.lat()+","+d.lng()}var h=ta.retrieve("attrMapZoom");l.mz=h;if(ta.servlet.Attractions.isNameSet){l.q=ta.id("CUR_NAME").value}ta.servlet.Attractions.getFilterWaitOverlay().show();if(window.history&&window.history.pushState){var m="/Attractions-g"+escape(ta.retrieve("page.geo"))+"-Activities";if(l.cat&&parseInt(l.cat)){m+="-c"+l.cat}if(l.o){m+="-o"+l.o}var n=window.location.href.lastIndexOf("-");if(n){m+=window.location.href.substring(n)}window.onpopstate=function(p){if(p.state&&p.state.toSend){ta.servlet.Attractions._sendRequest(p.state.toSend)}};history.pushState({toSend:l},"",m)}ta.servlet.Attractions._sendRequest(l)},_sendRequest:function(a){new Request({url:"/AttractionsAjax-g"+escape(ta.retrieve("page.geo")),method:"get",onSuccess:ta.servlet.Attractions.updatePage,data:a,evalScripts:true}).send()},viewTabClicked:function(a,b){ta.servlet.Attractions.selectedCategories=new Array();ta.servlet.Attractions.selectedCategories.push(b);ta.servlet.Attractions.getFilterWaitOverlay().show();ta.servlet.Attractions.isNameSet=false;ta.servlet.Attractions.makeRequest()},viewCategoryButtonClicked:function(a,b){ta.servlet.Attractions.viewTabClicked(a,b)},replaceClass:function(c,d,a){var b=c.className;var e=b.replace(d,a);if(b===e){return false}c.className=e;return true},updateContent:function(e,c,a){var b=e.getElement(".js_filter_name");if(b){ta.servlet.Attractions.replaceClass(b,c,a);var d=e.getElement(".js_filter_count");ta.servlet.Attractions.replaceClass(d,c,a)}},getCatId:function(c){var a=c.className;if(a){var b=a.match(/js_c(\d*)/);if(b===null){return null}return b[1]}return null},doMouseEnterLeave:function(a){var b=ta.servlet.Attractions.getFilterTable();if(!b){return}b.getElements("td").each(function(c){if(a!==null&&ta.servlet.Attractions.getCatId(c)===a){ta.servlet.Attractions.replaceClass(c,"_normal","_hover");ta.servlet.Attractions.updateContent(c,"_normal","_hover")}else{ta.servlet.Attractions.replaceClass(c,"_hover","_normal");ta.servlet.Attractions.updateContent(c,"_hover","_normal")}})},onMouseEnter:function(a){var b=ta.servlet.Attractions.getCatId(a);ta.servlet.Attractions.doMouseEnterLeave(b)},onMouseLeave:function(){ta.servlet.Attractions.doMouseEnterLeave(null)},getFilterTable:function(){return ta.id("category_filter_table")},movedMap:function(b,a){ta.servlet.Attractions.getFilterWaitOverlay().show();ta.servlet.Attractions.makeRequest()},updatePage:function(f){var b=document.createElement("div");b.innerHTML=f;var d=ta.id("ATTRACTION_FILTER");if(d!=null){d.innerHTML=b.children[0].innerHTML;window.behavior.apply(d)}var e=ta.id("ATTRACTION_OVERVIEW");e.innerHTML=b.children[1].innerHTML;var a=ta.id("ATTR_MAP");if(a){a.fireEvent("onMapUpdate")}var g=ta.remove("hideFilters");var c=ta.retrieve("filtersVisible");if(!c&&d!=null&&g!=null){ta.servlet.Attractions.hideFilters()}ta.servlet.Attractions.getFilterWaitOverlay().hide()},showFilters:function(a){ta.id("SHOW_FILTERS").addClass("hidden");ta.id("HIDE_FILTERS").removeClass("hidden");ta.id("TAB_FILTER_CONTROLS").removeClass("hidden");ta.store("filtersVisible",true)},getFilterWaitOverlay:function(){var a=ta.retrieve("filters.waitDialog");var b="mg s1 fatNotice";if(ta.isAttractionsRedesign2012()){b+=" fatNotice_2011"}if(!a){a=new ta.overlays.CenteredOverlay({style:b,showCloseButton:false,autoShow:false});a.inner.set("html","<b>"+JS_UpdatingYourResults+"</b>");ta.store("filters.waitDialog",a)}return a},hideFilters:function(a){ta.id("HIDE_FILTERS").addClass("hidden");ta.id("SHOW_FILTERS").removeClass("hidden");ta.id("TAB_FILTER_CONTROLS").addClass("hidden");ta.store("filtersVisible",false)},loadGMaps:function(b,a){b.preventDefault();ta.util.load.mapsLazy(ta.servlet.Attractions.initGeocoder)},initGeocoder:function(){var c=new ta.maps.Geocoder(),b=parseFloat(ta.id("GEO_LAT").value),h=parseFloat(ta.id("GEO_LNG").value),a=new ta.maps.Location(b-1,h-1),d=new ta.maps.Location(b+1,h+1),f=new ta.maps.Bounds(b+1,h-1,b-1,h+1),g=ta.id("distance_submit"),e=ta.id("DISTANCE_FORM");c.setViewport(f);ta.servlet.Attractions.getLocationLatLng=ta.servlet.Attractions.getLocationLatLng.bind(c);g.onclick="ta.call('ta.servlet.Attractions.getLocationLatLng', event, this)";e.onsubmit="ta.call('ta.servlet.Attractions.getLocationLatLng', event, this)";ta.servlet.Attractions.getLocationLatLng()},getLocationLatLng:function(b,a){if(b){b.preventDefault()}var c=ta.id("geocode_search").value;if(c==""){return}this.getLatLng(c,(function(d){if(d&&this.getViewport().containsLatLng(d)){ta.id("CUR_LAT").value=d.lat();ta.id("CUR_LNG").value=d.lng();ta.servlet.Attractions.isDistanceSet=true;ta.servlet.Attractions.makeRequest()}else{var e=ta.id("MESSAGES");e.removeClass("hidden");ta.id("ATTRACTION_OVERVIEW").innerHTML="";ta.id("ATTRACTION_OVERVIEW").adopt(e);ta.id("distance_reset").removeClass("hidden")}}).bind(this))},onSelectAttractionTypeAhead:function(b,f,c){var e=f?f.coords:null;if(e){var a=e.split(",");ta.id("CUR_LAT").value=a[0];ta.id("CUR_LNG").value=a[1];ta.servlet.Attractions.isDistanceSet=true;ta.servlet.Attractions.makeRequest()}else{var d=ta.id("MESSAGES");d.removeClass("hidden");ta.id("ATTRACTION_OVERVIEW").innerHTML="";ta.id("ATTRACTION_OVERVIEW").adopt(d);ta.id("distance_reset").removeClass("hidden")}},resetDistanceFilter:function(a){ta.servlet.Attractions.isDistanceSet=false;ta.servlet.Attractions.makeRequest()},addNameFilter:function(a){if(a){a.preventDefault()}var b=ta.id("name_filter").value;if(b==""){return}ta.id("CUR_NAME").value=b;ta.servlet.Attractions.isNameSet=true;ta.servlet.Attractions.makeRequest()},resetNameFilter:function(a){ta.servlet.Attractions.isNameSet=false;ta.servlet.Attractions.makeRequest()},onCategoryLinkClick:function(b,a){b.preventDefault();a.checked=!a.checked;ta.servlet.Attractions.updateCategoryList(b,a)},updateCategoryList:function(d,c){var b=ta.servlet.Attractions.selectedCategories;var a=parseInt(c.value,10);if(!b.contains(a)){b.include(a);if(c.name=="cat_0"){$$("#ATTRTYPE_BOX input").each(function(e){if(e!=this[0]){e.checked=false;this[1].erase(parseInt(e.value,10))}}.bind([c,b]))}else{b.erase(0);ta.id("cat_0").checked=false}}else{b.erase(a)}if(b.length==0){b.include(0);ta.id("cat_0").checked=true}ta.servlet.Attractions.makeRequest()}};ta.maps.sidebar=ta.maps.Sidebar={icons:{hotel:"/img2/maps/icons/pinHotel.gif",restaurant:"/img2/maps/icons/pinRestaurant.gif",attraction:"/img2/maps/icons/pinThingToDo.gif"},_addHotelRestaurantAttraction:function(a,c){var d=ta.retrieve("maps.map");var b=ta.retrieve("zft")||[];if(!b.contains(c)){b.push(c);ta.store("zft",b)}ta.servlet.HACSearch.filtersChanged();if(d){d.showType(a)}},hotels:function(c,a){var d=ta.retrieve("maps.map");var b=ta.retrieve("zft")||[];if($(a).checked){ta.maps.Sidebar._addHotelRestaurantAttraction("hotel",1)}else{b.erase(1);ta.store("zft",b);d.hideType("hotel")}ta.servlet.HACSearch.filter.update();return true},restaurants:function(c,a){var d=ta.retrieve("maps.map");var b=ta.retrieve("zft")||[];if(ta.id(a).checked){if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_poi_check","restaurants")}ta.store("lma","BCACMap_Restaurants");ta.maps.Sidebar._addHotelRestaurantAttraction("restaurant",3)}else{if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_poi_uncheck","restaurants")}b.erase(3);ta.store("zft",b);d.hideType("restaurant")}ta.servlet.HACSearch.filter.update();return true},attractions:function(c,a){var d=ta.retrieve("maps.map");var b=ta.retrieve("zft");if(ta.id(a).checked){if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_poi_check","attractions")}ta.store("lma","BCACMap_ThingsToDo");ta.maps.Sidebar._addHotelRestaurantAttraction("attraction",2)}else{if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_poi_uncheck","attractions")}b.erase(2);ta.store("zft",b);d.hideType("attraction")}ta.servlet.HACSearch.filter.update();return true},offers:function(b,a){if(a&&ta.id(a).checked){if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_poi_check","special_offers")}ta.store("maps.offersOnly",true)}else{if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_poi_uncheck","special_offers")}ta.remove("maps.offersOnly")}ta.servlet.HACSearch.filtersChanged();return true},disneyMarkerToggle:function(c,a){var b=a.id;var d=ta.retrieve("maps.map");if($(a).checked){d.showType(b)}else{d.hideType(b)}return true},landmarkData:{coffee:{query:"Coffee",iconIndex:4,action:"BCACMap_Coffee"},copy:{query:"Copy Center",iconIndex:5,action:"BCACMap_Copy"},shipping:{query:"Fedex, Shipping",iconIndex:6,action:"BCACMap_Shipping"},rail:{query:"Rail stations",iconIndex:10,action:"BCACMap_Rail"}},_landmarkSearchCallback:function(j,h,m){var b=ta.retrieve("maps.map");var a=b.mapBounds();var f=[];for(var e=0;e<h.results.length;e++){var k=h.results[e];var d=new Element("div");var g=k.titleNoFormatting;if(k.addressLines){k.addressLines.each(function(i){d.adopt(new Element("div").set("text",i))});g=k.addressLines.join(", ")}d.adopt(new Element("a",{href:map_gmaps_address_url+encodeURIComponent(g)}).set("text",map_drivingdirections));var c={lat:k.lat,lng:k.lng,customHover:{title:k.titleNoFormatting,titleUrl:k.url,contents:d}};var l=b.createLocation(k.lat,k.lng);if(a.containsLatLng(l)){f.push(c)}}b.replaceMarkers(f,j,Object.merge({},ta.maps.MARKER_HOTEL,{anchorX:5,anchorY:30,pinIndex:7,iconIndex:ta.maps.Sidebar.landmarkData[j].iconIndex}))},_landmarkSearch:function(b,c){var e=ta.retrieve("maps.map");if(!google.search.LocalSearch){ta.maps.Sidebar._landmarkSearch.delay(1000,this,[b,c]);return}var d=new google.search.LocalSearch();d.setCenterPoint(e.mapCenter());d.setResultSetSize(google.search.Search.LARGE_RESULTSET);d.setSearchCompleteCallback(this,function(){ta.maps.Sidebar._landmarkSearchCallback(b,d,c)});var a=function(){d.execute(ta.maps.Sidebar.landmarkData[b].query)};a.delay(250)},addLandmark:function(a){var c=ta.retrieve("maps.landmarks");var b=ta.retrieve("maps.map");if(b){b.showType(a)}if(!c.contains(a)){c.push(a)}ta.store("maps.landmarks",c);ta.maps.Sidebar._landmarkSearch(a,1)},toggleLandmark:function(c,a){var e=ta.retrieve("maps.map");var d=ta.retrieve("maps.landmarks");var b=a.getProperty("id").substr(8);if($(a).checked){ta.maps.Sidebar.addLandmark(b);ta.trackEventOnPage("dynamic_large_map","sidebar_poi_check",b)}else{d.erase(b);ta.store("maps.landmarks",d);e.hideType(b);ta.trackEventOnPage("dynamic_large_map","sidebar_poi_uncheck",b)}ta.servlet.HACSearch.filter.update();return true},reloadLandmarks:function(){var a=ta.retrieve("maps.landmarks");if(a){a.each(function(b){ta.maps.Sidebar._landmarkSearch(b)})}},togglePOI:function(c,d,g){var b=ta.retrieve("maps.map");var f=d.marker;var h=d.poiType;var e=ta.retrieve("maps."+h);var i=null;var j=-1;var a="";if(h=="airports"){j=9}else{j=8}if(ta.id(d).checked){if(!e.contains(f)){e.push(f);i=b.createLocation(f.lat,f.lng)}if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_poi_check",h)}}else{e.erase(f);if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_poi_uncheck",h)}}if(b){b.replaceMarkers(e,h,Object.merge({},ta.maps.MARKER_HOTEL,{anchorX:5,anchorY:30,pinIndex:7,iconIndex:j}));if(i!=null){b.zoomAndPanToFit(i.lat(),i.lng())}b.showType(h)}if(!g){ta.servlet.HACSearch.filter.update()}},_openAccordion:function(a,b,d){if(!a){return}if(!a.hasClass("on")){a.toggleClass("on")}var c=a.getNext("div");c.removeClass("hidden");if(!c.init){ta.maps.Sidebar._populatePoiAccordion(c,b,d)}},_populatePoiAccordion:function(c,b,e){if(!ta.retrieve("maps."+b)){ta.store("maps."+b,[])}var d=ta.retrieve("maps.nearbyPOIs")[b];var a=0;if(d!=null){d.markers.each(function(m){var g=(m.customHover.title.match(/[A-Z]{3}/)||++a);var f=e;if(m.locId){f=e+m.locId+"_"+g}else{f=e+g}var i=new Element("input",{type:"checkbox",name:f,id:f}).addEvent("click",function(n){ta.call("ta.maps.Sidebar.togglePOI",n)});var j=new Element("label",{"for":f}).set("text",m.customHover.title);var h=new Element("div",{"class":"poiContainer"});var l=new Element("div",{"class":"checkbox"});var k=new Element("div",{"class":"label"});l.adopt(i);k.adopt(j);i.marker=m;i.poiType=b;h.adopt(l);h.adopt(k);c.adopt(h)})}c.init=true},_closeAccordion:function(a,c){if(!a){return}if(a.hasClass("on")){a.toggleClass("on")}var b=$(a.getNext("div"));b.addClass("hidden")},toggleAirports:function(c,a,b){if(a.get("tag")!="div"){a=a.getParent("div")}if(!a.hasClass("on")){ta.maps.Sidebar._closeAccordion($("toggle_convention_centers"),"conventionCenters");if($("toggle_nearby_cities")){ta.maps.Sidebar._closeAccordion($("toggle_nearby_cities"),"nearbyCities")}ta.maps.Sidebar._openAccordion($("toggle_airports"),"airports","airport_")}else{ta.maps.Sidebar._closeAccordion($("toggle_airports"),"airports")}if(b){ta.servlet.HACSearch.filter.update()}},toggleConventionCenters:function(b,a){if(a.get("tag")!="div"){a=a.getParent("div")}if(!a.hasClass("on")){ta.maps.Sidebar._closeAccordion($("toggle_airports"),"airports");if($("toggle_nearby_cities")){ta.maps.Sidebar._closeAccordion($("toggle_nearby_cities"),"nearbyCities")}ta.maps.Sidebar._openAccordion($("toggle_convention_centers"),"conventionCenters","convention_center_")}else{ta.maps.Sidebar._closeAccordion($("toggle_convention_centers"),"conventionCenters")}ta.servlet.HACSearch.filter.update()},toggleNearbyCities:function(b,a){if(a.get("tag")!="div"){a=a.getParent("div")}if(!a.hasClass("on")){ta.maps.Sidebar.openNearbyCities()}else{ta.maps.Sidebar._closeAccordion($("toggle_nearby_cities"),"nearbyCities")}ta.servlet.HACSearch.filter.update()},openNearbyCities:function(b,a){ta.maps.Sidebar._closeAccordion($("toggle_airports"),"airports");ta.maps.Sidebar._closeAccordion($("toggle_convention_centers"),"conventionCenters");ta.maps.Sidebar._openAccordion($("toggle_nearby_cities"),"nearbyCities","cities_")},mapMorphed:function(a,e){if(a==0){var d=ta.retrieve("maps.landmarks");d.each(function(f){e.hideType(f)});$("MAPPROMO").setStyle("display","block")}else{if(a==1){var d=ta.retrieve("maps.landmarks");d.each(function(f){e.showType(f)});$("MAPPROMO").setStyle("display","none");var c=ta.remove("maps.morphBigSource")||"t";ta.store("lma","BCACMap_"+c+"_open")}}var b=ta.servlet.HACSearch.mapMorphed(a,e);return b},mapMoved:function(a,b){ta.maps.Sidebar.reloadLandmarks();return ta.servlet.HACSearch.mapMoved(a,b)},mapZoomed:function(b,a){ta.maps.Sidebar.reloadLandmarks();return ta.servlet.HACSearch.mapZoomed(b,a)},mapReset:function(){ta.maps.Sidebar.reloadLandmarks();if(pageServlet!="BusinessCenter"){ta.maps.Sidebar._clearLocation()}return ta.servlet.HACSearch.mapReset()},_removeLocation:function(){var a=ta.retrieve("maps.map");a.hideType("location")},addLocationPopup:function(b,a){if($("add_location_text").get("text")==map_removeaddress){ta.maps.Sidebar._removeLocation();$("add_location_text").set("text",map_addaddress)}else{$("add_location").removeClass("hidden")}},closeAddLocationPopup:function(d,b){$("add_location").addClass("hidden");var a=$("add_location_input");if(a){a.value=map_addresstemplate;a.addClass("unfocused")}var c=$("add_location_input_filter");if(c){c.value="";c.addClass("unfocused")}$("add_location_error").set("text","");$("add_location_error").addClass("hidden");$("add_location_header").removeClass("error")},clearAddLocationBox:function(b,a){if(a.hasClass("unfocused")){a.value="";a.removeClass("unfocused")}},_addLocation:function(c,a,f){var h=ta.retrieve("maps.map");if(!$("add_location")){var d=$("add_location_input");if(d){d.value=c;d.removeClass("unfocused")}var e=$("add_location_input_filter");if(e){e.value=c;e.removeClass("unfocused")}}var g=ta.id("REST_MAP");var b=ta.id("ATTR_MAP");if(!h&&g){h=g.map;ta.store("maps.map",h)}else{if(!h&&b){h=b.map;ta.store("maps.map",h)}}if(!a){ta.util.load.mapsLazy(function(){var j=new ta.maps.Geocoder();var i;if(h){i=h.mapBounds()}else{i=ta.maps.Sidebar._getStaticMapBounds()}if(i){j.setViewport(i)}j.getLatLng(c,ta.maps.Sidebar._addLocationCallback)})}else{ta.maps.Sidebar._addLocationCallback(a,f)}},_getStaticMapBounds:function(){var a=null;if(ta.maps.Bounds){try{var b=ta.id("STATIC_MAP_BOUNDS");if(b){var c=b.className;var j=/n(-?\d*\.\d+)/;var d=parseFloat(j.exec(c)[1]);j=/s(-?\d*\.\d+)/;var g=parseFloat(j.exec(c)[1]);j=/w(-?\d*\.\d+)/;var i=parseFloat(j.exec(c)[1]);j=/e(-?\d*\.\d+)/;var h=parseFloat(j.exec(c)[1]);if(d&&g&&h&&i){a=new ta.maps.Bounds(d,i,g,h)}}}catch(f){ta.util.error.record(f,"Sidebar - _getStaticMapBounds");a=null}}return a},clearLocation:function(b,a){ta.maps.Sidebar._clearLocation()},addLocation:function(f,d,a,g,c){var h="";var b;b=ta.id("add_location_input");if(b){h=b.value}var e=ta.id("add_location_input_filter");if(e){h=e.value}if(!ta.id("add_location")&&(h.length==0||h==map_enteraddress)){ta.maps.Sidebar._clearLocation();if(!(ta.id("REST_MAP")||ta.id("ATTR_MAP"))){ta.servlet.HACSearch.filter.update()}return false}if(h!=map_enteraddress){ta.store("maps.address",h);ta.maps.Sidebar._addLocation(h,a,g);if(!(ta.id("REST_MAP")||ta.id("ATTR_MAP"))){ta.servlet.HACSearch.filter.update()}}return false},_clearLocation:function(){ta.maps.Sidebar._removeLocation();ta.maps.Sidebar._clearLocationError();var a=$("add_location_input");if(a){a.value=map_enteraddress;a.addClass("unfocused")}var b=$("add_location_input_filter");if(b){b.value="";b.addClass("unfocused")}},_setLocationError:function(c){$("add_location_error").set("text",c);$("add_location_error").removeClass("hidden");if($("add_location_header")){$("add_location_header").addClass("error")}else{var a=$("add_location_input");if(a){a.addClass("error")}var b=$("add_location_input_filter");if(b){b.addClass("error")}if($("add_location_text")){$("add_location_text").addClass("error")}}},_clearLocationError:function(){$("add_location_error").addClass("hidden");if($("add_location")){if($("add_location_text")){$("add_location_text").set("text",map_removeaddress)}$("add_location").addClass("hidden");$("add_location_header").removeClass("error");var a=$("add_location_input");if(a){a.value=map_addresstemplate}var b=$("add_location_input_filter");if(b){b.value=""}}else{var a=$("add_location_input");if(a){a.removeClass("error")}var b=$("add_location_input_filter");if(b){b.removeClass("error")}if($("add_location_text")){$("add_location_text").removeClass("error")}}},_addLocationCallback:function(k,f){if(k==null){ta.maps.Sidebar._setLocationError(map_addressnotfound);return}ta.store("map.poi.changed",true);ta.store("map.poi",k.toUrlValue());var b=ta.retrieve("maps.map");if(!b){ta.store("map.delayedLoc",true);ta.store("map.delayedLoc.point",k);ta.store("map.delayedLoc.data",f);ta.servlet.HACSearch.filtersChanged();return}var a=b.mapCenter();var i=new ta.maps.Location(a.lat(),a.lng());var h=i.distanceFrom(k)/1609.344;if(h>100){ta.maps.Sidebar._setLocationError(map_addressnotfound2.replace("{0}",geoName));return}var j=ta.retrieve("maps.address");var c=b.getAddressUrl(j);ta.maps.Sidebar._clearLocationError();if(f){if(f.type=="AIRPORT"){var g="/BusinessCenter-g"+f.value+"-t4-";var e=[{infoOnLoad:true,lat:k.lat(),lng:k.lng(),locId:f.value,customHover:{title:f.name,contents:new Element("div").adopt(new Element("a",{href:g,target:"_blank",rel:"nofollow"}).set("text",map_findflights)).appendText(" | ").adopt(new Element("a",{href:c,target:"_blank",rel:"nofollow"}).set("text",map_drivingdirections))}}]}else{var d=pageServlet.replace("Redesign","");var e=[{infoOnLoad:true,lat:k.lat(),lng:k.lng(),locId:f.value,customHover:{title:f.name,titleUrl:f.url,url:"GMapsLC:info,g"+f.value+",ext,from="+d+",logAction=HACMap_info"}}]}}else{var e=[{infoOnLoad:true,lat:k.lat(),lng:k.lng(),customHover:{title:map_myaddress,address:j,titleUrl:c,contents:new Element("div").set("text",j).adopt(new Element("br")).adopt(new Element("a",{target:"_blank",rel:"nofollow",href:c}).set("text",map_drivingdirections))}}]}var l={anchorX:5,anchorY:30,pinSize:new ta.support.Size(23,28),pinOffset:102,pinIndex:1,hoverIndex:2,shadowSize:new ta.support.Size(23,28),shadowOffset:102,shadowIndex:0,iconSize:new ta.support.Size(19,23),iconOffset:18,iconIndex:0,iconOffsetX:2,iconOffsetY:2};if(ta.has("storeLocation")){ta.store("map.location.marker",e);ta.store("map.location.options",l)}b.replaceMarkers(e,"location",l);b.showType("location");b.move(k.lat(),k.lng(),b.getZoom());if(ta.id("REST_MAP")||ta.id("ATTR_MAP")){updateList(null,null,ACTION_MAPCHANGED)}ta.store("hac.sortChanged","distLow");ta.servlet.HACSearch.filtersChanged()},morphBigPromo:function(b,a){ta.store("maps.morphBigSource","p");return ta.servlet.HACSearch.morphBig(b,a)},onTypeChange:function(){this.setOption("mt",this.gmap2.getCurrentMapType().getName());this.saveOptions()},clearFieldFocus:function(c,b,a){try{if(a&&b.value.trim()==b.defaultValue.trim()){b.value="";ta.id(b).removeClass("unfocused")}else{if(!a&&b.value==""){b.value=b.defaultValue;ta.id(b).addClass("unfocused")}}}catch(d){ta.util.error.record(d,"clearFieldFocus")}}};ta.commerce.HACRoomInfo=new Class({initialize:function(a){this.locId=a;this.offers={}},getRoomDetailKey:function(a){a=""+a;return(a in this.offers)?this.offers[a]["roomDetailKey"]:null},setRoomDetailKey:function(b,a){b=""+b;if(!(b in this.offers)){this.offers[b]={}}this.offers[b]["roomDetailKey"]=a}});ta.commerce.Vendor=new Class({Implements:Options,options:{checkboxID:false,additionalOffer:false,defaultChecked:false,minDaysOut:0,maxDaysOut:0},initialize:function(c,d,e,a,b){this.setOptions(c);this.name=d;this.url=e;this.window=null;this.slot=null;this.opened=false;this.vendorName=a;this.propertyId=b;this.isFlight=false},isChecked:function(){if(ta.retrieve("isMetaCheckboxCheckRates")){return this.isCheckedWithExtension("_met")}else{return this.isCheckedWithExtension()}},isCheckedWithExtension:function(d){if(this.options.checkboxID){if(d){a=ta.id(this.options.checkboxID+d);if(a){return a.checked}}var a=ta.id(this.options.checkboxID);if(!a){a=ta.id(this.options.checkboxID+"_pop")}if(!a){a=ta.id(this.options.checkboxID+"_icr")}if(!a){a=ta.id(this.options.checkboxID+"_per")}if(!a){a=ta.id(this.options.checkboxID+"_met")}if(a){try{var b=ta.id(a).getParent("li");if(b&&b.style.display=="none"){return false}}catch(c){ta.util.error.record(c,"cr checkbox hidden check")}return a.checked}}return this.options.defaultChecked&&(this.options.available||ta.retrieve("checkrates.datesChanged"))},isAvailable:function(){if(!this.isOpened()){return true}return false},isOpened:function(){try{if(!this.opened||!this.hasWindow()){return(ta.has("checkrates.cr_provider_on_mousedown")&&ta.retrieve("checkrates.cr_mousedown_provider")==this.name)}}catch(a){}return true},isDefaultChecked:function(){return this.options.defaultChecked},isHidden:function(){var a=ta.id(this.options.checkboxID);if(!a){a=ta.id(this.options.checkboxID+"_pop")}if(!a){a=ta.id(this.options.checkboxID+"_icr")}if(a){try{var b=ta.id(a).getParent("li");if(b){if(b.style.display=="none"){return true}else{if(this.options.hide){if(b.style.display=="block"){return false}else{return true}}}}}catch(c){ta.util.error.record(c,"checkbox hide check")}}return false},hasWindow:function(){if(!this.window||!this.window.windowObject||!("closed" in this.window.windowObject)||this.window.windowObject.closed){return false}return true},addRoomDetailKeyParameters:function(a){var b=a;if(this.getLowestPriceRoomDetailKey()){b+="&rdex="+this.getLowestPriceRoomDetailKey()}return b},getUrl:function(d,a){var i=this.url;if(this.isFlight){i+="&"+d.getFlightData()}else{if(ta.has("metaDatePickerEnabled")&&ta.widgets&&ta.widgets.calendar&&ta.widgets.calendar.hasPageDates()){i+="&"+ta.commerce.checkrates.multiDatePickerUserData();if(d.type=="geocheckrates"){i=ta.commerce.checkrates.addCustomUrlParams(i,"QC_Inline_Geo")}}else{if(d.type!="checkdeals"){var e=d.getUserData();if(!e){e=ta.retrieve("checkrates.avUserData")}i+="&"+e;var h="QC_Inline";var c=a;if(c){var g=false;if(g=c.className.match(/custom_area_(\w+)/)){h=g[1]}}i=ta.commerce.checkrates.addCustomUrlParams(i,h)}else{if(ta.has("photo.viewer.isPhotoLBClick")){i=ta.commerce.checkrates.addCustomUrlParams(i,"QC_Inline")}}}}var c=d.actualTrigger||a;var b=c&&(c.hasClass("msk")?c:c.getParent(".msk"));if(b){var f=b.className.match(/msk[^\s]+/);if(f&&f.length>0){i+="&msk="+f[0].substr(3)}}if(ta.has("metaCacheKey")){i+="&"+ta.retrieve("metaCacheKey")}i=this.addRoomDetailKeyParameters(i);return i},errorString:function(){var a=[];if(this.name){a.push("&name_");a.push(this.name)}if(this.slot){a.push("&slot_full")}if(this.propertyId){a.push("&propId_");a.push(this.propertyId)}var b=a.join("");if(b&&b[0]){return b.slice(1)}return"noInfo"},hasDateLimits:function(){return this.options.minDaysOut>0||this.options.maxDaysOut>0},getContentID:function(){if(this.url){return ta.util.URL.getParameter(this.url,"src")}return false},getLowestPriceRoomDetailKey:function(){var b=this.propertyId;var c=this.getContentID();var a=ta.retrieve("ta.commerce.hacRoomInfo."+b);return a?a.getRoomDetailKey(c):null}});ta.commerce.VendorSet=new Class({Implements:Options,options:{vendorSet:false},initialize:function(b,a){this.setOptions(b);this.vendorSetId=a;if(this.options.vendorSet){this.vendors=this.options.vendorSet}this.vendorsUnchecked=[];this.vendorsDefaultUnchecked=[]},getVendors:function(){if((!this.vendors)||ta.has("checkrates.sponsored_vendors.loc."+this.vendorSetId)){this.vendors=ta.retrieve("checkrates.vendors."+this.vendorSetId)}return this.vendors},getVendorsUnchecked:function(){var c=ta.retrieve("checkrates.vendors."+this.vendorSetId);for(var a=0;a<c.length;a++){var b=c[a];if(!b.isChecked()&&!b.isHidden()){this.vendorsUnchecked.push(b)}}return this.vendorsUnchecked},getAllVendorIds:function(){var b=[];var c=this.getVendors();for(var a=0;a<c.length;a++){var d=c[a];b.push(d.getContentID());b.push("__")}if(b.length>0){b.pop()}return b.join("")},getVendorsDefaultUnchecked:function(){try{var d=ta.retrieve("checkrates.vendors."+this.vendorSetId);for(var a=0;a<d.length;a++){var c=d[a];if(!c.isChecked()&&!c.isHidden()&&!c.isDefaultChecked()){this.vendorsDefaultUnchecked.push(c)}}return this.vendorsDefaultUnchecked}catch(b){ta.util.error.record(b,"vendorSet - default unchecked")}},setVendorSetDefaultChecked:function(c){var b=this.getVendors();for(var a=0;a<b.length;a++){b[a].options.defaultChecked=c}},getCheckedInfo:function(p){var q=0;var o=0;var b=0;var c=[];var g=[];var k=[];var r=[];var d=[];var a=[];var s=[];try{var n=this.getVendors();for(var f=0;f<n.length;f++){var m=n[f];d.push(m.name);d.push("__");if(m.isChecked()){q++;c.push(m.name);c.push("__");g.push(m.vendorName);g.push("__");s.push(m.getContentID());s.push("__")}else{a.push(m.name);a.push("__")}if(m.window&&m.window.closed){m.window=null}else{if(m.isOpened()){o++;k.push(m.name);k.push("__")}}}var l=ta.retrieve("checkrates.vendors."+this.vendorSetId);for(var f=0;f<l.length;f++){var h=l[f];if(h.isHidden()){b++;r.push(h.name);r.push("__")}}if(c.length>0){c.pop()}if(g.length>0){g.pop()}if(k.length>0){k.pop()}if(r.length>0){r.pop()}if(d.length>0){d.pop()}if(a.length>0){a.pop()}if(s.length>0){s.pop()}if(p=="unavail_set"){return{vendorsAvailable:d.join(""),vendorsOpened:k.join("")}}else{if(p=="unchecked"){return{vendorsUnchecked:a.join("")}}else{if(p=="count"){return q}else{if(p=="tpw_string"){return c.join("")}else{if(p=="tpv_string"){return g.join("")}else{if(p=="open_count"){return o}else{if(p=="check_more"){return{vendorsChecked:c.join(""),vendorsOpened:k.join(""),vendorsHidden:r.join("")}}else{if(p=="now_checking"){return{vendorsChecked:c.join("")}}else{if(p=="checked_content_id"){return s.join("")}}}}}}}}}}catch(j){}return{checked:q,tpw_string:c.join(""),tpv_string:g.join(""),open:o,tpw_open_string:k.join("")}},getCheckedCount:function(){return this.getCheckedInfo("count")},getCheckedString:function(){return this.getCheckedInfo("tpw_string")},getCheckedVendor:function(){return this.getCheckedInfo("tpv_string")},getCheckedContentID:function(){return this.getCheckedInfo("checked_content_id")},oneChecked:function(){var a=this.getCheckedCount();if(a==0){alert(js_0001);return false}return true},getOpenCount:function(){return this.getCheckedInfo("open_count")},storeCheckBoxValues:function(){var a={};this.getVendors().each(function(b){a[b.name]=b.isChecked()});ta.store("checkBoxSet_"+this.vendorSetId,a)},errorString:function(){var a=[];var b=this.getVendors();if(!b||b.length<1){return"empty.vendor.set"}a.push("VSet::");b.each(function(d,c){a.push("V");a.push(c);a.push(":");a.push(d.errorString())});return a.join("")}});ta.commerce.CheckRatesData=new Class({Implements:Options,options:{type:"checkRates",evnt:false},initialize:function(c,b,d,a){this.setOptions(c);this.type=this.options.type;this.vendorSetId=d;this.isCheckMore=a;this.maxAllowedWin=0;this.maxHoldingWin=2;this.useHoldingWin=false;this.cap=3;this.lbDelay=1000;this.providerOnMouseDown=false;this.skipHoldingWin=false;if(ta.has("checkrates.cr_provider_on_mousedown")&&c&&c.evnt&&c.evnt.type=="mousedown"){this.providerOnMouseDown=true}if(Browser.chrome){ta.popups.PopUtil.useShiftClick();if(!ta.has("checkrates.use_chrome_provider_on_shift_click")){if(Browser.version==22){this.maxAllowedWin=2}else{if(Browser.version>22){this.maxAllowedWin=1}}if(ta.has("checkrates.cr_provider_on_mousedown")){this.maxAllowedWin+=1}}}else{if(Browser.ie){this.maxAllowedWin=1}}this.propId=b;if(!this.propId){this.propId=this.vendorSetId}if(this.vendorSetId){this.vendorSet=new ta.commerce.VendorSet({},this.vendorSetId)}},showInfo:function(a){if(this.infoField){this.infoField.addClass("errorSpan");this.infoField.setContent(a).show()}},hideInfo:function(){if(this.infoField){this.infoField.hide();this.infoField.removeClass("errorSpan")}},showErrors:function(f,b){var a=[];if(!ta.retrieve("ta.commerce.CheckRatesData.cssAsset")){ta.store("ta.commerce.CheckRatesData.cssAsset",Asset.css(CDNHOST+"/css2/common/validation_error.css"))}if(b!=null&&b instanceof Array&&b.constructor==Array){a=b}else{a.push(b)}for(var e=0;e<a.length;e++){var d=a[e];if(d){d.addClass("errorInput");var c=ta.id("lbl_"+d.id);if(c){c.addClass("errorLabel")}}}this.showInfo(f)},clearErrors:function(a,c){var b=ta.id("lbl_"+a.id);var d=ta.id("lbl_"+c.id);if(a){a.removeClass("errorInput")}if(c){c.removeClass("errorInput")}if(b){b.removeClass("errorLabel")}if(d){d.removeClass("errorLabel")}},validate:function(){if(!this.propId||!this.vendorSetId||!this.getVendorSet()){try{var a="NoVendSet";if(this.getVendorSet()){a=this.getVendorSet().errorString()}ta.util.error.record(null,"cr data validate",new Event(this.options.evnt),{propId:this.propId,vendorSetId:this.vendorSetId,vendorSet:a})}catch(b){}return false}if(!this.getVendorSet().oneChecked()||!this.validateDates()){return false}return true},getVendorSet:function(){if(this.reorderedVendorSet){return this.reorderedVendorSet}return this.vendorSet},getAvailVendorSet:function(){if(!this.availVendorSet){this.setAvailVendorSet()}return this.availVendorSet},getOriginalVendorSet:function(){return this.vendorSet},validateDates:function(){var b=ta.id("checkIn_"+this.vendorSetId);var c=ta.id("checkOut_"+this.vendorSetId);var a=false;checkInElemPer=ta.id("checkIn_"+this.vendorSetId+"_per");if(checkInElemPer){b=checkInElemPer;c=ta.id("checkOut_"+this.vendorSetId+"_per")}checkInElemPto=ta.id("checkIn_"+this.vendorSetId+"_pto");if(checkInElemPto){b=checkInElemPto;c=ta.id("checkOut_"+this.vendorSetId+"_pto")}checkInElemMeta=ta.id("checkIn_"+this.vendorSetId+"_met");if(checkInElemMeta){b=checkInElemMeta;c=ta.id("checkOut_"+this.vendorSetId+"_met")}if(ta.has("checkrates.date_picker_on_classic")&&!ta.widgets.calendar.datesExist()){this.errorMsg=this.dateErrorCheck(this.inDate);this.showErrors(this.errorMsg,null);return false}else{if(!this.formElem||!b||!c||!b.value||!c.value){if(!b){b=ta.id("checkIn_"+this.vendorSetId+"_pop");c=ta.id("checkOut_"+this.vendorSetId+"_pop")}if(!this.formElem||!b||!c||!b.value||!c.value){return true}}}this.inDate=this.parseDate(b.value);this.outDate=this.parseDate(c.value);this.clearErrors(b,c);this.errorMsg=this.dateErrorCheck(this.inDate);if(this.errorMsg){this.showErrors(this.errorMsg,b);a=true}this.errorMsg=this.dateErrorCheck(this.outDate);if(this.errorMsg){this.showErrors(this.errorMsg,c);a=true}if(this.inDate&&this.outDate&&(this.outDate.getTime()<=this.inDate.getTime())){this.errorMsg=js_0003;this.showErrors(this.errorMsg,[c,b]);a=true}if(window.cookieDomain==".daodao.com"&&a){new Request({url:"/ActionRecord?action=DaodaoInlineCRClick"}).send();var d=ta.retrieve("daodao.checkrate.error.nodate");if(d!=null){}}return !a},parseDate:function(b){var d=false;if(DATE_FORMAT&&b){var c=b.match(DATE_FORMAT.pattern);if(c){var e=parseInt(c[DATE_FORMAT.date].replace(/^0/,""));var a=parseInt(c[DATE_FORMAT.month].replace(/^0/,""));var f=parseInt(c[DATE_FORMAT.year].replace(/^0/,""));if(e>0&&e<32&&a>0&&a<13){if(f<100){f+=2000}d=ta.util.date.create(f,a-1,e)}}}return d},dateErrorCheck:function(c){if(!c||isNaN(c)){if(js_invalid_dates_text_new2){return js_invalid_dates_text_new2}return" "}var b=new Date();ta.util.date.normalize(b);var a=ta.util.date.create(b.getFullYear(),b.getMonth(),b.getDate()+330);if(c.getTime()<b.getTime()){if(js_0002){return js_0002}return" "}if(a.getTime()<c.getTime()){if(js_0004){return js_0004}return" "}return false},getMetaUserData:function(f){var b=ta.widgets.calendar.getCheckRatesData();if(b){return b}var a=ta.retrieve("avail.data."+f);if(a){ta.store("avail.data."+f,a);return a.getState()}var d=ta.id("date_picker_"+f);if(!d){d=ta.id("date_picker_"+f+"._met")}if(d){a=new ta.commerce.AvailDataWidget(false,f);if(a&&a.getState){return a.getState()}}var e=ta.retrieve("avail.data.objects");if(e){var c=e[0];if(c&&c.getState){return c.getState()}}return false},getUserData:function(){if(!this.userData){var c=this.vendorSetId;var d=[];if(ta.has("metaDatePickerEnabled")){var a=this.getMetaUserData(c);if(!a){return false}d.push("inMonth="+escape(a.inMonth));d.push("&inDay="+escape(a.inDay));d.push("&outMonth="+escape(a.outMonth));d.push("&outDay="+escape(a.outDay));d.push("&adults="+escape(a.adults));var o=ta.retrieve("checkrates.originAirport");if(o&&o.length==3){d.push("&Orig=");d.push(o)}}else{var m=ta.id("qcInMonth_"+c);if(!m){c=this.vendorSetId+"_pop";m=ta.id("qcInMonth_"+c)}if(!m){return false}var h=ta.id("qcOutMonth_"+c);var f=ta.id("qcInDay_"+c);var p=ta.id("qcOutDay_"+c);var n=ta.id("qcAdults_"+c);var i=m.value.split(/\//);var e=h.value.split(/\//);var j=ta.util.date.create(i[1],i[0]-1,f.value);var g=ta.util.date.create(e[1],e[0]-1,p.value);var b=new Date();ta.util.date.normalize(b);if(j.getTime()<b.getTime()||g.getTime()<b.getTime()){alert(js_0002);return false}var l=ta.util.date.create(b.getFullYear(),b.getMonth(),b.getDate()+330);if(j.getTime()>l.getTime()||g.getTime()>l.getTime()){alert(js_0004);return false}d.push("inMonth=");d.push(i[0]);d.push("%20");d.push(i[1]);d.push("&inDay=");d.push(escape(f.value));d.push("&outMonth=");d.push(e[0]);d.push("%20");d.push(e[1]);d.push("&outDay=");d.push(escape(p.value));d.push("&adults=");d.push(n.selectedIndex+1);var o=ta.retrieve("checkrates.originAirport");if(o&&o.length==3){d.push("&Orig=");d.push(o)}}var k=ta.id("hacPid"+c);if(k==null){k=ta.id("hacPid")}if(k&&k.value){d.push("&pid=");d.push(k.value)}this.userData=d.join("")}return this.userData},getFlightData:function(){var a=this.vendorSetId;var h=ta.id("qcInMonth_"+a);if(!h){a=this.vendorSetId+"_pop";h=ta.id("qcInMonth_"+a)}if(!h){return false}var e=ta.id("qcOutMonth_"+a);var c=ta.id("qcInDay_"+a);var i=ta.id("qcOutDay_"+a);var f=h.value.split(/\//);var d=e.value.split(/\//);var b=[];b.push("date0=");b.push(f[1]);b.push(f[0]);b.push(escape(c.value));b.push("&date1=");b.push(d[1]);b.push(d[0]);b.push(escape(i.value));var g=ta.id("qcFlightOfferPid");if(g&&g.value){b.push("&pid=");b.push(g.value)}return b.join("")},resetVisitedFlags:function(){var c="checkrates.sUserData."+this.vendorSetId;var a=ta.retrieve(c);var b=this.getUserData();if(a&&a!=b){var d=this.getVendorSet().getVendors();for(x=0;x<d.length;x++){d[x].opened=false}}ta.store(c,b)},getCROpenCount:function(b){var a=0;b.each(function(d){var c=d.window;if(d&&d.bOpened&&c&&c.windowObject&&!c.windowObject.closed){a++}});return a},fixPopOrder:function(r){var c=this.getCheckedVendors();var n=ta.popups.PopUtil.getHoldingWindowSet();var l=this.getVendorSet().getOpenCount();var b=n.length+l;var g=this.getVendorSet().getCheckedCount();if((b+1)<g){var a=false;try{a=window.chrome}catch(m){}var i=2;var q=a?true:ta.popups.PopUtil.tryHoldingWindows(this.propId,i);if(ta.has("checkrates.chrome_dates_entry_holding")&&Browser.chrome&&!ta.has("checkrates.use_chrome_provider_on_shift_click")){r=Math.min(r,(n.length+this.maxAllowedWin))}if(q&&r<c.length){var h=c.splice(0,r).reverse();c=h.concat(c)}else{if(q){c=c.reverse()}else{var o=n.length+1;if(ta.has("checkrates.add_holding_windows")){o=Math.min(o,r)}var p=[];for(var f=0;f<o;f++){p.push(c.shift())}for(var d=0;d<p.length;d++){c.unshift(p[d])}}}}else{c=c.reverse()}this.reorderedVendorSet=new ta.commerce.VendorSet({vendorSet:c},this.vendorSetId)},getCheckedVendors:function(){try{var a=this.getVendorSet().getVendors().slice();var b=[];a.map(function(e,d){if(e.isChecked()){b.push(e)}});return b}catch(c){ta.util.error.record(c,"getCheckedVendors")}},setAvailVendorSet:function(){try{var b=[];var h=this.getVendorSet().getVendors();var c=ta.retrieve("availability_check");if(c){for(var a=0;a<h.length;a++){var f=h[a];var g=c.unavailableProviders;if(!g||!g[f.name]){b.push(f)}}this.availVendorSet=new ta.commerce.VendorSet({vendorSet:b},this.vendorSetId)}}catch(d){ta.util.error.record(d,"availability check - crData set vendor set")}},setHWFlags:function(){if(!ta.has("checkrates.use_chrome_provider_on_shift_click")){var b=this.maxAllowedWin;if(this.providerOnMouseDown){this.useHoldingWin=false}else{if(!b){this.useHoldingWin=true}else{var a=this.getCheckedVendors().length;if(this.type=="geoCheckratesLB"){a=ta.retrieve("checkrates.geo_cr_lb_nChecked")}if(a>this.cap&&!this.type=="geoCheckratesLB"){a=this.cap}if(a>=(b+this.maxHoldingWin)){this.useHoldingWin=true}else{if(a==(b+this.maxHoldingWin-1)){this.useHoldingWin=true;if(!ta.has("checkrates.cr_provider_on_mousedown")&&this.type!="geoCheckratesLB"){this.skipHoldingWin=true}}}}}}}});ta.commerce.checkrates={getPropIdFromCRElement:function(b){if(b){var a=null;if(a=b.className.match(/id_(\d+)/)){return a[1]}}return null},updateMetaLightbox:function(h){var f=ta.id("PROVIDER_BLOCK");if(!f){return}var c=f.get("html");var e='<img class="provLoading" src="'+CDNHOST+'/img2/meta_sprites/loadingAnim.gif">';f.getElements(".rightBox").each(function(i){i.setContent(e)});ta.store("ta.commerce.MetaHacOverlay.crData."+h.vendorSetId,h);var g=h.getVendorSet().getAllVendorIds();var b=h.getVendorSet().getCheckedVendor();var a=1000;var d="metaHacRequest_"+a+"_cancel";ta.remove(d);new Request({url:ta.commerce.checkrates.buildMetaHacUrl(h,g,b,true),onSuccess:function(i){f.setContent(i);ta.commerce.checkrates.metaHacRequest(h,g,b,null)},onFailure:function(){f.setContent(c)}}).send()},checkRatesClicked:function(f,b,a,d){var h=new ta.commerce.CheckRatesData({type:d,evnt:f},ta.commerce.checkrates.getPropIdFromCRElement(b),a,false);var c=false;try{c=ta.id(b).getParent(".jp_tcl_col2_top2")}catch(g){}if(!c&&(ta.has("checkrates.meta_ui_sk_box")||ta.has("checkrates.meta_ui_sk_box_v3"))){ta.commerce.checkrates.updateMetaLightbox(h)}else{ta.commerce.checkrates.displayVendors(h,b);ta.widgets.calendar.removeMetaCalendarFromSync(a)}},checkRatesMiniMeta:function(e,c,b,d,a){var f=new ta.commerce.CheckRatesData({type:d,evnt:e},ta.commerce.checkrates.getPropIdFromCRElement(c),b,false);if((ta.retrieve("checkrates.meta_ui_post_click_prices")||a)&&f.validate()){ta.commerce.meta.miniMetaAjax(null,f,1000)}},checkRatesCheckMore:function(f,b,a,d){if("geocheckrates"==d&&!ta.widgets.calendar.hasPageDates()){var c=b.getParent("form"),i=c&&c.getElement(".date_picker_calendar_wrap");if(i){i.click();return}}ta.commerce.checkrates.initCheckMoreData();try{if(ta.retrieve("metaCheckRatesFeatureEnabled")){ta.commerce.checkrates.modifyElmtClassNameForTracking(b);ta.commerce.checkrates.logMetaUITestInfo()}}catch(h){ta.util.error.record(h,"checkRatesCheckMore - modifyElmtClassNameForTracking")}var g=new ta.commerce.CheckRatesData({type:d,evnt:f},ta.commerce.checkrates.getPropIdFromCRElement(b),a,true);if(f&&f.type=="click"&&ta.has("checkrates.use_chrome_provider_on_shift_click")&&ta.has("checkrates.cr_provider_on_mousedown")){ta.remove("checkrates.use_chrome_provider_on_shift_click");return}if(ta.retrieve("isMetaCheckboxCheckRates")){g.getVendorSet().setVendorSetDefaultChecked(false)}if(ta.retrieve("p13n_test44_GeoCRLeaveBehind")&&document.URL.indexOf("/Hotel_Review-")>0&&"geocheckrates"==d){this.launchLeaveBehind("avlb",g,"",b)}else{ta.commerce.checkrates.displayVendors(g,b)}},checkRatesCheckMoreForLBTest:function(d,b,a,c,f,h){if(ta.retrieve("specialMetaLeaveBehind")||ta.retrieve("specialMetaLeaveBehindV2")){try{if(typeof h=="undefined"||!h){h=""}ta.trackEventOnPage("meta_lightbox","open",c,"",false);ta.run("ta.overlays.Factory.loadSpecialMetaLeaveBehind",{},b,a,h)}catch(g){if(ta.retrieve("specialMetaLeaveBehindV2")){ta.util.error.record(g,"checkRatesCheckMoreForLBTestV2: meta leave-behind")}else{ta.util.error.record(g,"checkRatesCheckMoreForLBTest: meta leave-behind")}}}else{ta.store("skipLBGARecord",true);ta.store("metaUITestInfo",{test:"meta_lightbox",placement:"open",type:c,value:f});ta.commerce.checkrates.checkRatesCheckMore(d,b,a,"checkrates")}},checkRatesCreateGeoCrAutoBroadenLb:function(c,b,a){try{if(!ta.widgets.calendar.hasPageDates()){ta.commerce.meta.clickMetaShowPrices(c);return}ta.trackEventOnPage("GeoCheckRates","open","SeeHotels",0,false);ta.run("ta.overlays.Factory.loadGeoCrAutoBroadenOverlay",{},b,a)}catch(d){ta.util.error.record(d,"checkRatesCreateGeoCrAutoBroadenLb cannot track/create lightbox")}},checkRatesCheckMoreMetaCheckbox:function(d,b,a,c){ta.store("isMetaCheckboxCheckRates",true);this.checkRatesCheckMore(d,b,a,c);ta.remove("isMetaCheckboxCheckRates")},checkRatesCheckMoreFromPop:function(d,b,a,c){var e=ta.retrieve("checkrates.vendors."+a);window.opener.ta.commerce.checkrates.checkRatesCheckMoreToMain(d,b,a,c,e)},checkRatesCheckMoreToMain:function(d,b,a,c,e){ta.store("checkrates.vendors."+a,e);this.checkRatesCheckMore(d,b,a,c)},checkRatesGeoCRLB:function(a,c,f){try{var b=c.className.match(/locId_(\d+_\d)/)[1];var d=new ta.commerce.CheckRatesData({type:"geoCheckratesLB",evnt:a},ta.commerce.checkrates.getPropIdFromCRElement(c),b,true,false);if(!d.validate()){return false}d.hideInfo();var j=0;var h=document.getElements("#GEO_CR_LB .popup_hotel_checkbox input");for(var g=h.length;g--;){if(h[g].checked){j++}}ta.store("checkrates.geo_cr_lb_nChecked",j);d.setHWFlags();ta.run("ta.overlays.Factory.geoCheckratesLBAjax",{},d,f)}catch(k){ta.util.error.record(k,"checkRatesGeoCRLB")}},logMetaUITestInfo:function(){if(ta.has("metaUITestInfo")){try{var b=ta.retrieve("metaUITestInfo");if(b.test&&b.placement&&b.type&&b.value){ta.trackEventOnPage(b.test,b.placement,b.type,b.value,false)}}catch(a){ta.util.error.record(a,"error logging meta test info")}ta.remove("metaUITestInfo")}},logMapSponsoredProviderClick:function(c){var b=ta.find(".overlay .skv3");if(b&&b.hasAttribute("data-sponsor")&&c&&pageServlet){var a=b.get("data-sponsor");var d=b.get("data-sponsor-provider");if(c==d){var e=(pageServlet=="LocalMapsRedesign")?"LocalMap":(pageServlet=="HACSearch"||pageServlet=="Hotels")?"HACMap":"FloatingMap";ta.trackEventOnPage(e,"sponsor_cr_sent",a)}}},logLowestPriceTestInfo:function(b,c){var d=b.getParent("div#PROVIDER_BLOCK")||b.getParent("div#PROVIDER_BLOCK_INLINE");if(d){var m=(d.id=="PROVIDER_BLOCK_INLINE")?true:false;var h=(m)?"metaLowestPriceCTAInline":"metaLowestPriceCTA";var f=(m)?"Meta_LP_CTA_Click_Inline":"Meta_LP_CTA_Click";if(ta.has(h)){var k=ta.retrieve(h);if(k.hasOwnProperty("idx")&&k.hasOwnProperty("provider")){try{var j=ta.commerce.checkrates.scrapeMetaProviders(d);var a=null;for(var g=0;g<j.length;g++){if(c==j[g]){a=g}}if(a){ta.trackEventOnPage(f,k.idx,a,0,false)}}catch(l){ta.util.error.record(l,"error logging lowest price click info")}}}}},scrapeMetaProviders:function(h){var d=[];d[0]=-1;try{if(h){var b=h.getElements(".jsPrvdr");for(var a=0;a<b.length;a++){var c=b[a].onclick+"";var g=c.match(/openMetaProvider.*'(\d+)'\)/)[1];if(g){d.push(g)}}}}catch(f){ta.util.error.record(f,"error scraping meta providers")}return d},logBlueChevronLowestPriceTestInfo:function(c,d){var f=c.getParent("#HotelDateSearch");if(f){var b="bcMetaLowestPriceCTA";var g="BlueChevron_LP_CTA_Click";if(ta.has(b)){var l=ta.retrieve(b);if(l.hasOwnProperty("idx")&&l.hasOwnProperty("provider")){try{var j=ta.commerce.checkrates.scrapeBlueChevronProviders(f);var a=null;for(var h=0;h<j.length;h++){if(d==j[h]){a=h}}if(a){ta.trackEventOnPage(g,l.idx,a,0,false)}}catch(k){ta.util.error.record(k,"error logging blue chevron lowest price click info")}}}}},scrapeBlueChevronProviders:function(h){var f=[];f[0]=-1;try{if(h){var c=h.getElements(".offer");for(var b=0;b<c.length;b++){var d=c[b].onclick+"";var a=d.match(/openMetaProvider.*'(\d+)'\)/);if(a){provider=a[1];if(provider){f.push(provider)}}}}}catch(g){ta.util.error.record(g,"error scraping blue chevron providers")}return f},changePID:function(a){var b=ta.id("hacPid");if(b){b.value=a}},checkDealsClicked:function(c,b,a){ta.commerce.checkrates.displayVendors(new ta.commerce.CheckRatesData({type:"checkdeals",evnt:c},ta.commerce.checkrates.getPropIdFromCRElement(b),a,false),b)},checkRatesPhotoOverlayClicked:function(d,b,a,c){if(ta.has("hotels.wipeDatesTwoEnabled")&&!ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.setTimeoutPageDates();ta.widgets.calendar.showAllPriceButtons(false);ta.remove("meta.isFromShowPriceButton")}ta.commerce.checkrates.initCheckMoreData();ta.store("photo.viewer.isPhotoLBClick",true);ta.store("crPageServlet_orig",crPageServlet);crPageServlet="LocationPhotosLightbox";var e=ta.commerce.checkrates.displayVendors(new ta.commerce.CheckRatesData({type:c,evnt:d},ta.commerce.checkrates.getPropIdFromCRElement(b),a,true),b);ta.remove("photo.viewer.isPhotoLBClick");if(ta.photos.viewer){ta.photos.viewer.afterCheckRates(e)}},trackMetaClick:function(d,a,c){var b="CheckRates";var e=1;ta.trackPhysicalCommerce(b,a,e,c);ta.trackAttemptedCommerce(b,a,d,e)},removeProviderCheckboxClick:function(){var b=document.getElements("#META_UI_AVAIL_SECTIONS #META_HAC_ROOM_LIST .chk");var a=document.getElements("#META_UI_AVAIL_SECTIONS #META_HAC_ROOM_LIST .checkbox_ui");b.each(function(c){ta.remove(c.id)});a.each(function(c){ta.remove(c.name)})},restoreCRPageServlet:function(){var a=ta.retrieve("crPageServlet_orig");if(a){crPageServlet=a}},initCheckMoreData:function(){this.checkMoreData={uncheckedProviders:null,alsoViewed:null,VR:null}},displayVendors:function(d,b){var a=document.getElement(".overlay");if(a&&a.overlay&&a.overlay.pin){a.overlay.pin()}if(!d.validate()){return false}d.hideInfo();try{if(ta.commerce.checkrates.showMetaCheckRates()&&d.type!="geocheckrates"){if(b&&b.className.contains("QC_Inline_Geo")){if(d.inDate&&d.outDate){var f="geo="+d.vendorSetId+"&inDay="+d.inDate.getDate()+"&inMonth="+(d.inDate.getMonth()+1)+"/"+d.inDate.getFullYear()+"&outDay="+d.outDate.getDate()+"&outMonth="+(d.outDate.getMonth()+1)+"/"+d.outDate.getFullYear();window.location="/HACSearch?"+f}}else{this.openMetaHacOverlay(d,b)}return}if(ta.commerce.checkrates.showMetaCheckRates()&&d.type=="geocheckrates"){ta.store("parentCheckRatesData",d)}ta.remove("metaCheckRatesBypass");this.popwindows(d,b);ta.commerce.checkrates.providerLoadTestReq(d.vendorSetId);ta.remove("metaCheckBoxCheckRates");if(!ta.has("checkrates.commerce_drop_to_bottom")&&!ta.has("checkrates.is_iPad_web_6")){this.addBoomerangTag(d)}}catch(c){}return true},showMetaCheckRates:function(){var b=ta.retrieve("metaCheckBoxCheckRates");var a=ta.retrieve("meta.isCheapVacationServlet");return ta.retrieve("metaCheckRatesFeatureEnabled")&&!a&&!b},popwindows:function(g,c){try{if(ta.commerce.checkrates.isAvailCheckTest()&&!window.chrome&&!ta.has("avail.check.query.complete")){if(!ta.has("availability_check")){if(!ta.has("commerce.ac.attempts")){ta.store("commerce.ac.attempts",0);ta.commerce.checkrates.triggerAvailCheck(false)}else{ta.store("commerce.ac.attempts",ta.retrieve("commerce.ac.attempts")+1)}if(ta.retrieve("commerce.ac.attempts")<30){ta.commerce.checkrates.popwindows.delay(100,this,[g,c]);return}}ta.remove("commerce.ac.attempts")}}catch(f){ta.util.error.record(f,"availability check - popwindows")}if(ta.has("pav.overlay")){ta.retrieve("pav.overlay").hide()}g.resetVisitedFlags();ta.store("checkrates.flightData",g.getFlightData());var a=ta.id("msgbox");if(g.type=="providerWindow"){ta.commerce.commerceHelper.openProviderWindowTest(g,c);if(js_0014&&a){a.hide().empty()}return false}if(js_0005&&a){a.setContent(js_0005).show()}var b=g.getVendorSet().getVendors().length;if(ta.commerce.checkrates.isAvailCheckTest()){var d=g.getAvailVendorSet();if(d&&d.getVendors()){b=d.getCheckedCount();if(isNaN(b)||b>3){b=3}}}else{if(/win_test_(\d+)/.test(ta.id("CHECK_RATE").className)){b=parseInt(RegExp.$1)}else{if(g.type=="alsoViewed"){b=3}}}if(typeof(isIPad)!="undefined"&&isIPad){if(!(typeof(iPadOSVersion)!="undefined"&&iPadOSVersion>=5)){b=1}}if(b>1){g.fixPopOrder(b)}this.popAll(g,b,c);if(a){a.hide().empty()}return true},popAll:function(n,j,k){var a=false;if(/custom_area_(\S+)\s/.test(k.className)){a=RegExp.$1}else{a="QC_Inline"}var p=n.getVendorSet().getVendors();try{if(ta.commerce.checkrates.isAvailCheckTest()){p=n.getAvailVendorSet().getVendors()}}catch(t){}ta.store("checkrates.avUserData",n.getUserData());ta.store("checkrates.avId",n.propId);var g=true;if(ta.has("checkrates.cr_provider_on_mousedown")&&n.options.evnt.type=="click"){g=false}if(g){ta.trackPhysicalCommerce("CheckRates",a,1,n.propId)}n.setHWFlags();var b=0;var l=false;var q=0;var s=p.length;try{if(Browser.chrome&&!ta.has("checkrates.use_chrome_provider_on_shift_click")){var o=ta.popups.PopUtil.getHoldingWindowSet();j=Math.min((n.maxAllowedWin+o.length),j)}}catch(t){ta.util.error.record(t,"chrome - max allowed providers")}if(!ta.has("checkrates.use_chrome_provider_on_shift_click")){if(n.providerOnMouseDown){s=1;ta.store("checkrates.afterMouseDown",true);if(p.length>1){l=true}}else{if(ta.has("checkrates.afterMouseDown")){q=1;b=1;ta.remove("checkrates.afterMouseDown")}}}for(var r=q;r<s;r++){var m=p[r];var f=m.isChecked();if(f&&m.isAvailable()){if((j-1<b)){ta.remove("checkrates.use_chrome_provider_on_shift_click");this.popBlock(n,k);return false}if(ta.has("checkrates.cr_provider_on_mousedown")){if(b==(j-1)&&!ta.has("checkrates.use_chrome_provider_on_shift_click")){n.useHoldingWin=false}if(n.options.evnt.type=="mousedown"){ta.store("checkrates.cr_mousedown_provider",m.name)}}var h=this.popOne(m,n,k);if(!h){this.popBlock(n,k);return false}else{ta.trackAttemptedCommerce("CheckRates",a,m.name,r+1);b++;ta.commerce.checkrates.addClickOutPixels(n.propId,false)}}}ta.remove("checkrates.use_chrome_provider_on_shift_click");if(n.providerOnMouseDown&&l){return true}var c=false;try{c=(window.cookieDomain==".daodao.com"&&(k.hasClass("smartdeals_checkmore")||window.pageServlet!="SmartDeals"))&&serverPool!=null&&serverPool.toLowerCase()==="b"&&j<p.length}catch(d){}if(n.isCheckMore||c){this.popBlock(n,k)}else{if(n.type!="checkdeals"){if(!ta.has("checkrates.commerce_drop_to_bottom")&&!ta.has("checkrates.is_iPad_web_6")){this.launchAVLBTest(n)}else{this.launchLeaveBehind.delay(n.lbDelay,this,["avlb",n,"",k])}}}if(ta.has("pcr.overlay")){ta.retrieve("pcr.overlay").hide()}return true},hideLoading:function(c){var a=document.id(c);if(a){var b=a.getElement(".loading");b.set("styles",{display:"none"})}},showLoading:function(d){var a=document.id(d);if(a){var c=a.getElement(".loading");var b=a.getElement(".grn_chevronRgt");c.set("styles",{display:"block"});b.set("styles",{display:"none"})}},showArrow:function(d){var a=document.id(d);if(a){var c=a.getElement(".loading");var b=a.getElement(".grn_chevronRgt");c.set("styles",{display:"none"});b.set("styles",{display:"block"})}},getDelaySecs:function(){var a=ta.id("CHECK_MORE_SITES_LB");if(a&&a.hasClass("dont_animate")){return 0}return 2000},showRemainingCheckMore:function(){var b=this.checkMoreData;var f=document.id("UNCHECKED_PROVIDERS");var a=document.id("ALSO_VIEWED_LB");var c=ta.id("VR_CROSS_SELL");var d=this.getDelaySecs();b.uncheckedProviders=f;b.alsoViewed=a;b.VR=c;if(f){this.showUncheckedProviders.delay(d,this)}else{if(a){this.showAlsoViewed.delay(d,this)}else{if(c){this.showVR.delay(d,this)}}}try{this.loadPackages(false)}catch(g){ta.util.error.record(g,"hotel packages - loadPackages")}},loadPackages:function(b){if(this.shouldSendPackagesRequest()){var f=$$(".packages");this.checkMoreData.packages=f;var h=ta.id("PACKAGES_HOTEL_ID");var k=ta.id("PACKAGES_HOTEL_NAME");var o=ta.id("PACKAGES_CHECK_IN_DATE");var d=ta.id("PACKAGES_CHECK_OUT_DATE");var i=ta.id("PACKAGES_ADULTS");var m=ta.id("PACKAGES_GEO");if(h&&k&&o&&d&&i&&m){var j=h.get("value");var n=k.get("value");var c=o.get("value");var l=d.get("value");var g=i.get("value");var e=m.get("value");var a=[];$$("#ALSO_VIEWED_LIST a").each(function(p){var q=/-d([0-9]+)-/.exec(p.href);if(q&&q[1]&&q[1]!=""){a.push(q[1])}});this.fireCallCountEvent(1);setTimeout(function(){new Request({url:"/ExpediaPackagesAjax",onSuccess:function(p){try{ta.commerce.checkrates.handlePackages(p,0)}catch(q){ta.util.error.record(q,"hotel packages - handlePackages")}},onFailure:function(p){ta.util.error.record(p.responseText,"hotel packages - call to /ExpediaPackagesAjax")},data:{hotelId:j,hotelName:n,checkInDate:c,checkOutDate:l,adults:g,geo:e,alsoViewedIds:a.join(","),isAlsoViewed:b},evalScripts:true,method:"get"}).send()},500)}}},shouldSendPackagesRequest:function(){var a=$$(".packages").length>0;return a},hasPackagesReturned:function(){return this.hasPackagesResults()||this.hasPackagesNoResults()},hasPackagesResults:function(){return $$("#QUICK_CHECK_LB_PACKAGES .checking_sites").length>0},hasPackagesNoResults:function(){return ta.id("PACKAGES_NO_RESULTS")!=null},isPackagesShowing:function(){var a=ta.id("QUICK_CHECK_LB_PACKAGES");return a&&a.hasClass("show_section")},hasVRCrossSell:function(){return ta.id("VR_CROSS_SELL")!=null},transitionToPackages:function(){this.showPackages.delay(this.getDelaySecs(),this,true)},fireCallCountEvent:function(a){ta.trackEventOnPage("checkRates","packages","callCount",a,true)},handlePackages:function(a,d){this.checkMoreData.packages.set("html",a);var b=ta.id("PACKAGES_REQUERY_KEY");if(b){var c=b.get("value");if(d<20){this.fireCallCountEvent(d+2);setTimeout(function(){new Request({url:c,onSuccess:function(f){try{ta.commerce.checkrates.handlePackages(f,d+1)}catch(g){ta.util.error.record(g,"hotel packages - handlePackages")}},onFailure:function(e){ta.util.error.record(e.responseText,"hotel packages - requery to /ExpediaPackagesAjax")},evalScripts:true,method:"get"}).send()},1000)}}else{if(!ta.id("CHECK_MORE_SITES_LB")){setTimeout(function(){if(!ta.id("AVLB_HERO_PHOTOS")&&$$("#ALSO_VIEWED_PACKAGES .checking_sites")&&$("ALSO_VIEWED_AD")&&$("ALSO_VIEWED_AD").getSize().x>0){$$("#ALSO_VIEWED_PACKAGES .checking_sites").addClass("withAd")}var f=ta.id("ALSO_VIEWED_PACKAGES");if(f&&!ta.commerce.checkrates.hasPackagesNoResults()){f.show()}else{var e=ta.id("VR_CONTAINER");if(e){e.show()}}},2000)}}},showPackagesLoop:function(a){try{if(this.hasPackagesNoResults()){if(this.hasVRCrossSell()){this.showVR()}return}var b=ta.id("QUICK_CHECK_LB_PACKAGES");if(b&&b.hasClass("show_section")){return}if(this.hasPackagesReturned()&&!this.hasPackagesNoResults()){this.showPackages(false)}else{if(a==0){return}else{this.showPackagesLoop.delay(1000,this,a--)}}}catch(c){ta.util.error.record(c,"hotel packages - showPackagesLoop")}},showPackages:function(b){try{var c=$$(".packages")[0];var a=$$(".packages .checking_sites")[0].getSize().y;c.addClass("show_section");c.removeClass("hide_section");var f=new Fx.Tween(c,{duration:"long",property:"height"});f.start(0,a);if(b){f.addEvent("complete",this.transitionToAlsoViewed.bind(this))}}catch(d){ta.util.error.record(d,"hotel packages - showPackages");if(b){this.showAlsoViewed()}}},packagesClick:function(){try{var t="ExpediaPackageMeta2";var a=ta.id("hiddenReferrer");var h=ta.id("hiddenOrigin");var j=ta.id("hiddenDestination");var c=ta.id("hiddenPercentageSaved");var g=ta.id("hiddenGeo");var f=a.get("value");var u=h.get("value");var q=j.get("value");var v=g.get("value");var o=parseFloat(c.get("value"));var s=$$(".packages .savings");var k=s&&s.length>0?true:false;var p="Expedia";var i=ta.id("hiddenSource");if(i){p=i.get("value")}var l=ta.id("CHECK_MORE_SITES_LB")!=null;var b="";var m="";if(l&&k){b="QC_AlsoViewed_Packages1a";m="16221"}else{if(l){b="QC_AlsoViewed_Packages1b";m="16222"}else{if(k){b="QC_AlsoViewed_Packages2a";m="16269"}else{b="QC_AlsoViewed_Packages2b";m="16270"}}}if(p=="Orbitz"){b+="ORB"}var d="";if(o<7.5){d=1}else{if(o<10){d=2}else{if(o<12.5){d=3}else{if(o<15){d=4}else{d=5}}}}var n=window.open("about:blank","packages","width=800,height=600,scrollbars=1");ta.trackAttemptedCommerce("packages",b,t,d);new Request.JSONP({url:"/CheapFlightsCommerce",callbackKey:"jsonp",data:{AirProvider:t,from:f,area:b,slot:d,cnt:"1",Orig:u,Dest:q,geo:v,pid:m},onSuccess:function(w){try{var z=ta.id("hiddenDetailsUrl");if(z){var y=z.get("value");if(typeof(w)!="undefined"&&w!=null){if(typeof(w.icmcid)!="undefined"&&w.icmcid){y+="&icmcid="+w.icmcid}if(typeof(w.icmdtl)!="undefined"&&w.icmdtl){y+="&icmdtl="+w.icmdtl}}n.location=y}}catch(A){ta.util.error.record(A,"hotel packages - commerceClickCallback")}},method:"get"}).send()}catch(r){ta.util.error.record(r,"hotel packages - packagesClick")}return false},avafState:0,avafTimer:null,avafMoreExpandedSize:0,avafInit:function(){this.avafState=0;this.avafTimer=null;this.avafMoreExpandedSize=0},avafIn:function(c,a){try{if(ta.commerce.checkrates.avafState!=0){return}if(a==0){ta.commerce.checkrates.avafExpand()}else{ta.commerce.checkrates.avafWait((c)?(c.target||c.srcElement):null,a)}}catch(b){ta.util.error.record(b,"also viewed - avafIn")}},avafWait:function(b,a){try{ta.commerce.checkrates.avafState=1;ta.commerce.checkrates.avafTimer=setTimeout(function(){ta.commerce.checkrates.avafExpand(b)},a)}catch(c){ta.util.error.record(c,"also viewed - avafWait")}},avafOut:function(d){try{if(ta.commerce.checkrates.avafState!=1){return}if(ta.commerce.checkrates.avafTimer==null){return}if(!d){d=window.event}if(!d){return}var a=(d.relatedTarget)?d.relatedTarget:d.toElement;var c=ta.id("ALSO_VIEWED_LIST");while(a&&a!=c&&a.nodeName!="BODY"){a=a.parentNode}if(a==c){return}clearTimeout(ta.commerce.checkrates.avafTimer);ta.commerce.checkrates.avafTimer=null;ta.commerce.checkrates.avafState=0}catch(b){ta.util.error.record(b,"also viewed - avafOut")}},avafExpand:function(b){try{ta.trk("AVAF_HOVER_EXPAND",false,b);ta.commerce.checkrates.avafState=2;var a=ta.id("expand_av_on_hover");if(!a){return}a.removeClass("hidden");a.addClass("expanding");var e=a.getSize().y;a.removeClass("expanding");a.addClass("show");var d=new Fx.Tween(a,{duration:"long",property:"height"});d.start(0,e)}catch(c){ta.util.error.record(c,"also viewed - avafExpand")}},avafMore:function(a,c){try{ta.trk("AVAF_EXPAND_"+(c?"MORE":"LESS"),false,(a)?(a.target||a.srcElement):null);if(c){var b=ta.id("hideableMore");if(!b){return}b.addClass("hidden");b=ta.id("expand_av_on_more");if(!b){return}b.removeClass("hidden");if(ta.commerce.checkrates.avafMoreExpandedSize==0){b.addClass("expanding");ta.commerce.checkrates.avafMoreExpandedSize=b.getSize().y;b.removeClass("expanding")}b.addClass("show");new Fx.Tween(b,{duration:"long",property:"height"}).start(0,ta.commerce.checkrates.avafMoreExpandedSize)}else{var b=ta.id("expand_av_on_more");if(!b){return}new Fx.Tween(b,{duration:"long",property:"height"}).start(b.getSize().y,0).chain(function(){b.removeClass("show");b.addClass("hidden");var e=ta.id("hideableMore");if(!e){return}e.removeClass("hidden")})}}catch(d){ta.util.error.record(d,"also viewed - avafMore")}},animatedShowHide:function(c,h,b){try{var f=ta.id(h);if(!f||!c){return}else{if(b==1){c.addClass("hidden")}var g=0;var a=0;if(f.hasClass("hidden")){f.removeClass("hidden");f.addClass("expanding");a=f.getSize().y;f.removeClass("expanding");f.addClass("show")}else{if(f.hasClass("show")){g=f.getSize().y;a=0}}new Fx.Tween(f,{property:"height",duration:"500"}).start(g,a).chain(function(){if(f.getSize().y==0){f.removeClass("show");f.addClass("hidden");f.setStyle("height","auto")}})}}catch(d){ta.util.error.record(d,"animatedShowHide")}},metaLbProviderHover:function(c,d,b){var a=ta.id("metaFlyout_"+d);if(!a){return}if(b){a.removeClass("hidden")}else{a.addClass("hidden")}},metaLbShowChecker:function(b,c){var a=ta.id("checker_"+c);if(!a){return}a.removeClass("hidden")},metaLbAltDates:function(i,b,g,d,j,a,c){var e,m,f;try{e=ta.util.date.create(i,b-1,g);m=ta.util.date.create(d,j-1,a);ta.widgets.calendar.setPageInDate(e);ta.widgets.calendar.setPageOutDate(m);var l=["inMonth="+b+"%20"+i,"inDay="+g,"outMonth="+j+"%20"+d,"outDay="+a];var k="http://"+document.domain+"/UpdateSessionDatesAjax?"+l.join("&");new Request({url:k,evalScripts:true,onSuccess:function(p){try{ta.widgets.calendar.syncAllDatePickers();ta.widgets.calendar.launchInlineMeta();var n=ta.retrieve("metaLeaveBehindOverlay");if(n){n.fireEvent("onClose",n);n.hide()}if(c){window.setTimeout(function(){window.location=c},800)}}catch(o){ta.util.error.record(o,"MetaLbV2 updates failed.")}}}).send()}catch(h){ta.util.error.record(h,"error constructing meta request with alternate dates")}},removeScooter:function(a){var c=ta.retrieve("scooterObj");if(c){c.removeScooter(c)}var b=ta.id(a);if(!b){return}b.parentNode.removeChild(b)},removeScooterPersistent:function(){try{ta.commerce.checkrates.removeScooter();Cookie.writeSession("SCL",1)}catch(a){}},showUncheckedProviders:function(){var d=this.checkMoreData.uncheckedProviders;var b=this.checkMoreData.alsoViewed;var c=ta.retrieve("vrCrossSellNew");if(d){var a=d.getSize().y;d.addClass("show_section");d.removeClass("hide_section");var e=new Fx.Tween(d,{duration:"long",property:"height"});e.start(0,a);if(this.hasPackagesResults()){e.addEvent("complete",this.transitionToPackages.bind(this))}else{if(b&&!c){e.addEvent("complete",this.transitionToAlsoViewed.bind(this))}else{e.addEvent("complete",this.transitionToVR.bind(this))}}}},actionRecord:function(a){new Request({url:"/ActionRecord?action="+a}).send()},transitionToAlsoViewed:function(){this.showAlsoViewed.delay(this.getDelaySecs(),this)},showAlsoViewed:function(){var a=this.checkMoreData.alsoViewed;var c=ta.retrieve("vrCrossSellNew");if(a){var b=a.getSize().y;a.addClass("show_section");a.removeClass("hide_section");var f=new Fx.Tween(a,{duration:"long",property:"height"});f.start(0,b);try{if(!this.isPackagesShowing()){if(this.shouldSendPackagesRequest()){f.addEvent("complete",this.showPackagesLoop.bind(this,10))}else{if(!c){f.addEvent("complete",this.transitionToVR.bind(this))}}}}catch(d){ta.util.error.record(d,"hotel packages - shouldSendPackagesRequest")}}},transitionToVR:function(){if(this.checkMoreData.VR){if(screen.height>=768){this.showVR.delay(2000,this)}else{this.actionRecord("VR_CROSS_SELL_SMALL_SCREEN")}}},showVR:function(){var b=this.checkMoreData.VR;var a=this.checkMoreData.alsoViewed;var d=ta.retrieve("vrCrossSellNew");if(b){var c=b.getSize().y;b.addClass("show_section");b.removeClass("hide_section");var e=new Fx.Tween(b,{duration:"long",property:"height"});e.start(0,c);ta.overlays.Factory.recordVRCrossSell();if(a&&d){e.addEvent("complete",this.transitionToAlsoViewed.bind(this))}}},recordClose:function(){if(ta.has("pav.overlay")){ta.retrieve("pav.overlay").hide()}this.actionRecord("CheckMore_Close")},buildURLForQuickCheckData:function(d,n,m,b){var j=d.getUserData();var g="";j=ta.retrieve("checkrates.avUserData");var o=m||d.getVendorSet().getCheckedInfo(n);if(o){g="&vendorsChecked="+o.vendorsChecked+"&vendorsOpened="+o.vendorsOpened+"&vendorsHidden="+o.vendorsHidden;if(ta.commerce.checkrates.isAvailCheckTest()){try{var a=d.getAvailVendorSet().getCheckedInfo("unavail_set");var c=d.getOriginalVendorSet().getCheckedInfo("unchecked");g="&vendorsChecked="+o.vendorsChecked+"&vendorsOpened="+a.vendorsOpened+"&vendorsHidden="+o.vendorsHidden+"&vendorsAvailable="+a.vendorsAvailable+"&vendorsUnchecked="+c.vendorsUnchecked}catch(i){}}}var f=pageServlet;if(crPageServlet){f=crPageServlet}if(!f){f="unknown"}var p="&avLocId=";var h=ta.retrieve("checkrates.avId");if(h){p+=h}else{p+=d.vendorSetId}var l="QC_Button";var k=false;if(k=b.className.match(/custom_area_(\w+)/)){l=k[1]}return"detail="+d.vendorSetId+"&storedUserData="+encodeURIComponent(j)+g+"&a="+l+"&s="+f+"&av=true"+p},removePCR:function(){var a=ta.retrieve("pcr.overlay");if(a){a.hide()}},popBlock:function(h,c){if(ta.has("metaCheckBoxCheckRates")){return}try{if(c.className.match(/custom_area_QC_Inline_Geo/)&&!(crPageServlet=="Hotel_Review"||crPageServlet=="ShowUserReviewsHotels")||c.className.match(/custom_area_QC_AlsoViewed_Popup/)){return}}catch(g){ta.util.error.record(g,"popBlock - could not check criteria")}h.getVendorSet().storeCheckBoxValues();var a=h.getVendorSet().getCheckedInfo("check_more");var b="/CheckMore?"+this.buildURLForQuickCheckData(h,"check_more",a,c);var f=h.getOriginalVendorSet().getVendorsUnchecked();var d=h.getOriginalVendorSet().getVendorsDefaultUnchecked();if(ta.has("checkrates.cr_provider_on_mousedown")){ta.remove("checkrates.cr_mousedown_provider")}if(!ta.has("force_popup_to_check_more")){if(c.hasClass("cmAVTest")&&a&&a.vendorsChecked&&a.vendorsOpened&&a.vendorsChecked==a.vendorsOpened){if(!ta.has("checkrates.commerce_drop_to_bottom")&&!ta.has("checkrates.is_iPad_web_6")){this.launchAVLBTest(h)}else{this.launchLeaveBehind.delay(h.lbDelay,this,["avlb",h,"",c])}return}if(c&&/avLightboxSwap/.test(c.className)){if(!ta.has("checkrates.commerce_drop_to_bottom")&&!ta.has("checkrates.is_iPad_web_6")){this.launchAVLBTest(h)}else{this.launchLeaveBehind.delay(h.lbDelay,this,["avlb",h,"",c])}return}}if(h.type=="checkdeals"){b="ABS:vpages/quickcheckdeals_ie.html"}if(h.type!="geocheckrates"&&pageServlet!="Cheap_Vacations"){if(!ta.has("checkrates.commerce_drop_to_bottom")&&!ta.has("checkrates.is_iPad_web_6")){ta.run("ta.overlays.Factory.loadCheckMoreOverlay",{},h,b,c)}else{this.launchLeaveBehind.delay(h.lbDelay,this,["checkmore",h,b,c])}}},launchLeaveBehind:function(c,d,a,b){if(d.type=="geocheckrates"||pageServlet=="Cheap_Vacations"){return}if(c=="avlb"){this.launchAVLBTest(d)}else{if(c=="checkmore"){ta.run("ta.overlays.Factory.loadCheckMoreOverlay",{},d,a,b)}}this.addBoomerangTag(d)},daodaoPopTPW:function(n,g,t,r){var l=new ta.commerce.CheckRatesData({type:r,evnt:n},ta.commerce.checkrates.getPropIdFromCRElement(g),t,true);if(!l.validate()){return false}var m=l.getVendorSet().getVendors();var c=0;for(var o=0;o<m.length;o++){var j=m[o];if(j.isChecked()&&j.isAvailable()){c=o;j.opened=true;break}}var s=m[c];var p="daodaoTPW";var d=ta.retrieve("daodaoTPW");var k="/DaoDaoTabbedProviderWindow?first="+s.name+"&locId="+t+"&"+l.getUserData();try{if(d!=null){try{d.windowObject=window.open(k,p,"left=0,top=0,width="+screen.width+",height="+screen.height);d.windowObject.focus()}catch(q){ta.util.error.record(q,"daodao pop tpw one - reuse popup");return false}}else{var h=ta.popups.PopUtil.getHoldingWindowSet();var a=screen.width;if(h.length>0){d=h[h.length-1].repurpose(k,a)}else{var f=1;try{if(window.chrome){f=0}}catch(q){}var b={customWidth:a,customHeight:screen.height,name:p,url:k,scrollbars:f,left:0,top:0};d=ta.popups.PopUtil.createCheckRatesWindow(b)}}}catch(q){ta.util.error.record(q,"pop tpw - general");return false}if(d&&d.windowObject){ta.store("daodaoTPW",d);return d}return false},updateInlineFormElementRadio:function(d){var a=d.getElement("input[type=radio]");if(a){var e=a.id.substring(a.id.length-4);if(this.crSyncExtensions.contains(e)){var b=a.id.substring(0,a.id.length-4);var c=ta.id(b);if(c){c.checked=a.checked;var f=$$("#CHECK_RATES_CONT_SYNC form")[0];if(f){var g=f.getElement("#"+b+"_icr");g.checked=c.checked}}}else{var b=a.id;var c=ta.id(b);this.crSyncExtensions.each(function(i){var h=b+i;h=ta.id(h);if(h){h.checked=c.checked}})}}},popOne:function(a,d,c){try{ta.commerce.checkrates._addTagManToDOM(a);if(a.hasWindow()){try{var g=a.window;g.windowObject=window.open(a.getUrl(d,c),g.name,g.winArgs);g.windowObject.focus()}catch(i){ta.util.error.record(i,"pop one - reuse popup");return false}}else{var j=a.name;var k=ta.popups.PopUtil.getProviderWindowDims(j,true);var h=ta.popups.PopUtil.getHoldingWindowSet();if(h.length>0&&d.useHoldingWin){a.window=h[h.length-1].repurpose(a.getUrl(d,c),k.customWidth,k.customHeight);if(d.skipHoldingWin){d.useHoldingWin=false}if(ta.has("checkrates.add_holding_windows")){if(a.window.type==ta.popups.PopUtil.windowType.CHECK_RATE){var f=ta.popups.PopUtil.getHoldingWindowSet().length;var b=window.cookieDomain;if(b){if(f>0){Cookie.write("CommercePopunder","HW"+f,{domain:b,duration:0})}else{Cookie.dispose("CommercePopunder",{domain:b})}}}}}else{var m=1;try{if(window.chrome){m=0}}catch(i){}var k=ta.popups.PopUtil.getProviderWindowDims(j,false);var l={customWidth:k.customWidth,customHeight:k.customHeight,widthOffset:k.widthOffset,heightOffset:k.heightOffset,name:j,url:a.getUrl(d,c),scrollbars:m};a.window=ta.popups.PopUtil.createCheckRatesWindow(l)}}}catch(i){ta.util.error.record(i,"pop one - general");return false}if(a.window&&a.window.windowObject){a.opened=true;return a.window}return false},addBoomerangTag:function(f){var a={};var b=ta.id("checkIn_"+f.vendorSetId);var e=ta.id("checkOut_"+f.vendorSetId);var d=ta.id("qcAdults_"+f.vendorSetId);if(!(b&&e&&d)){b=ta.id("checkIn_"+f.vendorSetId+"_pop");e=ta.id("checkOut_"+f.vendorSetId+"_pop");d=ta.id("qcAdults_"+f.vendorSetId+"_pop")}if(b&&e&&d){a.checkIn=b.value;a.checkOut=e.value;a.adults=d.value}else{return}var c={url:"/HotelCheckRates?Action=AddBoomerangTag",data:a};c.onSuccess=function(i,g){var h=ta.id("BOOMERANGTAG");if(!h){h=new Element("div",{id:"BOOMERANGTAG"});h.inject(document.body)}if(!h){return}h.innerHTML=i};new Request(c).send()},launchAVLBTest:function(c){if(c.type=="geocheckrates"||pageServlet=="Cheap_Vacations"){return}var b=c.propId;if(pageServlet&&b&&window.cookieDomain!=".daodao.com"){var a="http://"+document.domain+"/AlsoViewedLB?d="+b+"&s="+pageServlet+"&"+c.getUserData()+"&checkRatesType=checkRates";if(ta.has("page.geo")){a+="&geo="+ta.retrieve("page.geo")}ta.run("ta.overlays.Factory.launchAVLBCompleteFn",{},a)}},openProviderWindowUrl:function(i,e,b,g){var h=ta.asInt("commerce.provWinNum");h++;ta.store("commerce.provWinNum",h);var a=ta.retrieve("commerce.previousTpwNumbers");var d=a+"_"+h;if(!a){d=h}var f="TAProviderWindow_"+d;i=i+"&otpwn="+d;var j=window.open(i,f,this.getProviderWinArgs(d));j.focus();ta.store("commerce.TPWindow",j);var c=(function(){try{if(j.closed){clearTimeout(c)}else{var l=j.location.href;window.status=l}}catch(k){clearTimeout(c);new Request({url:"/ActionRecord?action=fbProvWin|id_"+e+"|ctrId_"+b+"|cv_"+g}).send()}}).periodical(1500);return j},addCustomUrlParams:function(c,b){var f=new RegExp("(&|\\?)area=[^&]*");c=c.replace(f,"$1area="+b);if(crPageServlet){var a=new RegExp("(&|\\?)from=[^&]*");c=c.replace(a,"$1from=HotelDateSearch_"+crPageServlet)}var d=c;try{c=ta.commerce.meta.tracking.updateUrlWithTiming(c,b)}catch(g){ta.util.error.record(g,"problem updating winUrl with timing in CheckRates.addCustomParams");c=d}return c},checkMoreClickRe:function(f,a,g,q){new Event(f).preventDefault();if(a){var i="QC_Button";var h=false;if(h=a.className.match(/custom_area_(\w+)/)){i=h[1]}var j="";var m=false;if(m=a.className.match(/custom_refer_(\w+)/)){j=m[1]}var l="UNKNOWN";var c=false;if(c=a.search.match(/\?p=(\w+)\W/)){l=c[1]}var b=ta.id(a).hasClass("flightOffer");var k;if(b){k=a.href+"&"+ta.retrieve("checkrates.flightData")}else{var d=ta.retrieve("checkrates.avUserData");k=this.addCustomUrlParams(a.href,i)+"&"+d}var p=1;try{if(window.chrome){p=0}}catch(f){}var n=ta.popups.PopUtil.getProviderWindowDims(g,false);var o={customWidth:n.customWidth,customHeight:n.customHeight,widthOffset:n.widthOffset,heightOffset:n.heightOffset,name:g,url:k,scrollbars:p};ta.trackPhysicalCommerce("CheckMore",i,1,modelLocId);var r=ta.popups.PopUtil.createCheckRatesWindow(o);if(r){ta.trackAttemptedCommerce("CheckMore",i,l,1)}}},checkMoreClick:function(B,q,z,C,g,a){new Event(B).preventDefault();if(q){if(a){ta.commerce.checkrates.showLoading(q.id)}var y="QC_Button";var D=false;if(D=q.className.match(/custom_area_(\w+)/)){y=D[1]}var j=false;if(j=q.className.match(/custom_refer_(\w+)/)){crPageServlet=j[1]}var f=ta.id(q).hasClass("flightOffer");var l;if(f){l=q.href+"&"+ta.retrieve("checkrates.flightData")}else{var o=ta.retrieve("checkrates.avUserData");l=this.addCustomUrlParams(q.href,y)+"&"+o}var n=1;try{if(window.chrome){n=0}}catch(B){}var w=ta.popups.PopUtil.getProviderWindowDims(z,false);var h={customWidth:w.customWidth,customHeight:w.customHeight,widthOffset:w.widthOffset,heightOffset:w.heightOffset,name:z,url:l,scrollbars:n};var k=ta.popups.PopUtil.createCheckRatesWindow(h);if(k&&a){ta.commerce.checkrates.showArrow(q.id)}if(f){ta.id(q).removeClass("sprite-findflights_ylwCnr").addClass("sprite-findflights_ylwCnrChk")}else{ta.id(q).removeClass(C).addClass(g)}if(ta.id(q).getParent("#QUICK_CHECK_LB_PARTNERS")){var E=0;var b=0;var s=document.id("QUICK_CHECK_LB_PARTNERS");var A=s.getElements(".unClickedCount");A.each(function(e){if(ta.id(e).hasClass(C)){E++}if(ta.id(e).hasClass(g)){b++}},this);if(a){if(b>1){var m=document.getElement(".chkOpenedSitesDesc");var v=document.getElement(".oneMoreOpened");ta.id(m).removeClass("hideOne");ta.id(v).addClass("hideOne")}var u=document.getElement(".cs_ps .openedSites");u.innerHTML=b}if(E<1){var t=ta.id("emptyAlsoViewed");if(t){var c=ta.retrieve("overlays.current");if(c){c.hide();ta.remove("overlays.current")}}else{var p=document.getElement(".chkSitesDesc");if(p){p.addClass("hideOne")}var d=document.getElement(".oneMore");if(d){d.addClass("hideOne")}}return}else{if(E<2){var p=document.getElement(".chkSitesDesc");if(p){p.addClass("hideOne")}var d=document.getElement(".oneMore");if(d){d.removeClass("hideOne")}}else{var i=document.getElement(".cs_ps .opnSites");i.innerHTML=E}}}if(window.cookieDomain==".daodao.com"){if(ta.id(q).getElements("span")[0].hasClass("show-price-org")){ta.id(q).getElements("span")[0].removeClass("show-price-org").addClass("show-price-black")}var r=ta.id(q).getParent("li").getParent("ul").getElements(".show-price-org").length;ta.id("remainingCount").set("html",r)}}},showProviders:function(){if(this.validateDates()){var a=$$("div.geoProviderHidden");if(a){a.removeClass("geoProviderHidden");a.addClass("geoProvider")}var c=ta.id("HotelDateSearch")||ta.id("HotelDateSearch_icr");if(c){var b=c.getElement("span.error_msg_geo");if(b){b.hide()}}}},validateDates:function(){var b=ta.id("checkIn_"+this.geoId)||ta.id("checkIn_"+this.geoId+"_icr");var e=ta.id("checkOut_"+this.geoId)||ta.id("checkOut_"+this.geoId+"_icr");if(!b||!e||!b.value||!e.value){return false}var d=this.parseDate(b.value);var c=this.parseDate(e.value);var a=this.dateErrorCheck(d);var f=this.dateErrorCheck(c);if(a&&f){return true}else{return false}},parseDate:function(b){var d=false;if(DATE_FORMAT&&b){var c=b.match(DATE_FORMAT.pattern);if(c){var e=parseInt(c[DATE_FORMAT.date].replace(/^0/,""));var a=parseInt(c[DATE_FORMAT.month].replace(/^0/,""));var f=parseInt(c[DATE_FORMAT.year].replace(/^0/,""));if(e>0&&e<32&&a>0&&a<13){if(f<100){f+=2000}d=ta.util.date.create(f,a-1,e)}}}return d},dateErrorCheck:function(c){if(!c||isNaN(c)){return false}var b=new Date();ta.util.date.normalize(b);var a=ta.util.date.create(b.getFullYear(),b.getMonth(),b.getDate()+330);if(c.getTime()<b.getTime()){return false}if(a.getTime()<c.getTime()){return false}return true},updateHiddenDateFields:function(f,b){var e=this.parseDate(b.value);var a=this.dateErrorCheck(e);if(a&&typeof(a)=="string"){if(a.replace(/^\s+|\s+$/g,"").length>0){alert(a)}return}if(window.cookieDomain==".daodao.com"){var c=ta.id("HotelDateSearch");if(c&&c.hasClass("show-meta-prices")){ta.run("dd.hotels.halfmeta.showDaoDaoMetaPrices")}}var d=ta.id(b).overlay;if(d&&d.calendar){d.calendar.select(null,e)}},crSyncExtensions:new Array("_pop","_icr","_pto","_per","_amo","_cro","_met","_imt"),_showSuppressedProviders:function(a){if(ta.retrieve("checkrates.datesChanged")){return}try{var b=ta.id(a);b.getElements(".unavailable").each(function(d){d.removeClass("unavailable");if(d.hasClass("js_ua_checked")){d.getElements("input").set("checked",true)}ta.commerce.checkrates.updateCRFormElement(d)});ta.store("checkrates.datesChanged",true)}catch(c){ta.util.error.record(c,"_showSuppressedProviders")}},findInlineCRLocationId:function(){var e=null;var f=ta.id("HotelDateSearch");if(f){var a=f.getElements("input[type=text]");for(var d=a.length;d--;){var b=a[d];var c=b.id.match(/_(\d+)/);if(c.length){e=c[1];break}}}return e},updateCRCalendar:function(c){if(c.form){ta.commerce.checkrates._showSuppressedProviders(c.form)}try{var b=c.before;var a=b.dayField;if(a&&/qcInDay_(\d+)/.test(a.id)){ta.commerce.checkrates.checkCRLimits(RegExp.$1)}}catch(d){ta.util.error.record(d,"update cal crLimits check")}ta.commerce.checkrates.updateCRFormElement(this);if(ta.id("META_UI_INLINE")){ta.commerce.checkrates.updateCRForm("_imt")}},checkCRLimits:function(g){try{if(!g){return}var d=new Date();var o=document.getElement('input[id*="qcInDay_'+g+'"]').value;var p=document.getElement('input[id*="qcInMonth_'+g+'"]').value;p=p.split("/");d.setDate(o);d.setMonth(p[0]-1);d.setFullYear(p[1]);var n=ta.retrieve("checkrates.vendors."+g);for(var h=0;h<n.length;h++){var m=n[h];if(m.hasDateLimits()){var c='input[id*="'+m.options.checkboxID+'"]';var f=document.getElement(c);if(f){var l=true;var b;var a=m.options.minDaysOut;if(a>0){b=new Date();b.setDate(b.getDate()+a);l=(d>=b)}var k=m.options.maxDaysOut;if(k>0&&l){b=new Date();b.setDate(b.getDate()+k);l=(d<=b)}if(f.getParent("li")){f.getParent("li").style.display=(l?"block":"none")}}}}}catch(j){ta.util.error.record(j,"check crLimits")}},updateCRFormElement:function(f){try{f=ta.id(f);var n=f.get("tag").toLowerCase();if(n=="li"){f=f.getElement("input[type=checkbox]")}var g=f.id.split("_")[0];var j=this.findInlineCRLocationId();var m=g+"_"+j;var d=f.id;var b=d.substring(d.length-4);var q=[m,m+"_icr",m+"_per",m+"_imt"];if(this.crSyncExtensions.contains(b)){for(var h=q.length;h--;){var m=q[h];if(m!=d){var p=ta.id(m);if(p){if(n=="li"&&b!="_pop"){p.checked=f.checked;var o=f.getParent("li");if(o&&!o.hasClass("unavailable")){var c=p.getParent("li");if(c){c.removeClass("unavailable")}}}else{if(n=="select"){p.selectedIndex=f.selectedIndex}else{if(n=="input"){var a=f.form;if(window.cookieDomain==".daodao.com"){if(a.hasClass("show-meta-prices")){ta.run("dd.hotels.halfmeta.showDaoDaoMetaPrices")}}var l=m.substring(m.length-4);if(!this.crSyncExtensions.contains(l)){l=""}this.updateCRFormElement_In(j,f,b,l)}}}}}}}}catch(k){ta.util.error.record(k,"updateCRFormElement")}},updateCRForm:function(a){try{if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers();return}var q=ta.id("HotelDateSearch"+a);var p=ta.id("HotelDateSearch");var f=["select","input[type=checkbox]","input[type=hidden]","input[type=text]"];if(q&&p){for(var l=f.length;l--;){var c=f[l];var s=p.getElements(c);var d=q.getElements(c);for(var h=d.length;h--;){var r=d[h];var o=r.id.split("_")[0];for(var g=s.length;g--;){var n=s[g];if(n.id.contains(o)){if(c=="input[type=checkbox]"){var t=n.getParent("li");if(t&&!t.hasClass("unavailable")){var b=r.getParent("li");if(b){b.removeClass("unavailable")}}}if(c=="select"){r.selectedIndex=n.selectedIndex}else{if(c=="input[type=checkbox]"&&a!="_pop"){r.checked=n.checked}else{if(!r.id.contains("hacPid")){r.value=n.value}}}}}}}}}catch(m){ta.util.error.record(m,"updateCRForm")}},updateCRFormElement_In:function(k,r,m,o){try{var l=r.id.match(/_(\d+)/)[1];var c=ta.id("checkIn_"+k+o);var b=ta.id("checkOut_"+k+o);var n=ta.id("checkIn_"+l+m);var i=ta.id("checkOut_"+l+m);var f=ta.id("qcInDay_"+k+o);var p=ta.id("qcOutDay_"+k+o);var g=ta.id("qcInDay_"+l+m);var d=ta.id("qcOutDay_"+l+m);var h=ta.id("qcInMonth_"+k+o);var s=ta.id("qcOutMonth_"+k+o);var j=ta.id("qcInMonth_"+l+m);var a=ta.id("qcOutMonth_"+l+m);if(c&&n&&b&&i&&f&&g&&p&&d&&h&&j&&s&&a){c.value=n.value;b.value=i.value;f.value=g.value;p.value=d.value;h.value=j.value;s.value=a.value}}catch(q){ta.util.error.record(q,"updateCRFormElement_In")}},availCheck:function(b){var a=ta.id("availability")&&ta.id("availability").value=="1";var d=ta.id(b).getElement(".overlaySrc");if(a&&d){var c=d.innerHTML;d.innerHTML=c.replace(/cid=(\w+_)?&amp;/,"")}},positionCheckRates:function(){try{var m=window.getScroll();var r=false;try{r=window.location.href}catch(l){}if(r){var j=ta.retrieve("pcr.initialUrl");if(!j){j=r;ta.store("pcr.initialUrl",j)}if(j!=r){ta.store("pcr.initialYPos",m.y);ta.store("pcr.initialUrl",r)}}var i=true;var a=ta.retrieve("pcr.initialYPos");if(a&&a>0){i=(Math.abs(a-m.y)>=100)}if(ta.retrieve("pcr.scrollPoint")<=0){var b=ta.id("CHECK_RATE");var o=document.getElement(".postShowMetaCR");var q=ta.id("BIG_ORANGE_CTA");var h=0;if(b){h=b.getPosition().y}if(ta.retrieve("checkrates.meta_ui_post_click_prices")&&o){h=Math.max(h,o.getPosition().y)}if(q){h=Math.max(h,q.getPosition().y)}ta.store("pcr.scrollPoint",h)}var d=m.y>=ta.retrieve("pcr.scrollPoint")&&i;var f=$$(".overlayBG");if(d&&!ta.retrieve("pcr.overlay").visible&&!ta.has("pcr.keepHidden")&&!f.length&&!ta.has("pcr.disabled")){ta.store("pcr.initialYPos",-1);if(typeof(persistentCRCss)!="undefined"&&!ta.retrieve("ta.persCrCssAsset")){ta.store("ta.persCrCssAsset",Asset.css(persistentCRCss))}ta.retrieve("pcr.overlay").show();if(ta.id("PERSISTENT_HAC")){ta.servlet.HACSearch.updateHACFormCal(0,"_per");ta.servlet.HACSearch.updateHACFormAdults(0,"_per")}else{ta.commerce.checkrates.updateCRForm("_per")}if(!ta.id("PERSISTENT_CHECK_RATES_WRAP").hasClass("pcrStatic")){var g=ta.retrieve("pcr.overlay").container;g.setStyle("margin-top",-125);var c=new Fx.Tween(g,{duration:"300",transition:"bounce:out"});if(ta.has("checkrates.urgency_msg_placement_pcr")&&!ta.has("checkrates.urgencyMsgPCRShowing")){c.start("margin-top",-125,0).chain(function(){ta.commerce.checkrates.toggleUrgencyMessage.delay(1000,this,"_pcr")})}else{c.start("margin-top",-125,0)}}var n=ta.id("PERSISTENT_CHECK_RATES_WRAP").getElement(".miniMeta");if(n&&ta.widgets.calendar.datesExist()&&(ta.retrieve("pcr_redesign_v1")||ta.retrieve("pcr_redesign_v2"))){n.addClass("miniMetaHide")}var k=ta.id("PERSISTENT_CHECK_RATES_WRAP").getParent();if(!k.getElement(".drop_gradient")){var p=new Element("div.drop_gradient");p.inject(k,"bottom")}if(!ta.retrieve("pcr.firstShow")){ta.trackEventOnPage("PersistentCheckRates","shown","",1,true);ta.store("pcr.firstShow",true);ta.commerce.meta.updateProvAreaFromLightBox(ta.retrieve("page.location"))}}else{if(!d&&ta.retrieve("pcr.overlay").visible){ta.retrieve("pcr.overlay").hide();ta.widgets.calendar.closeCalendarWidgets()}}}catch(l){window.removeEvent("scroll",ta.commerce.checkrates.positionCheckRates);ta.util.error.record(l,"pcr - positionCheckRates");return false}},_updateSecondaryFormElement_CB:function(){var a=ta.id("CHECK_RATES_CONT");if(a){var b=a.getElements("input.chk");b.each(function(f,d){var e=ta.id(f.id+"_pop");var c=ta.id(f.id+"_per");if(e){e.checked=f.checked}if(c){c.checked=f.checked}})}},availCheckQuery:function(d,b,a,c,f,e){new Request.JSON({url:"/AvailabilityCheckJson",method:"get",data:{checkin:d,checkout:b,adults:a,country:f,geo:e,action:c},onSuccess:function(h,g){if(c&&c=="peek"){ta.store("availability_check",h)}}}).send()},isAvailCheckTest:function(){if(!ta.has("avail.check.test")){var a=ta.id("CHECK_RATES_CONT");if(a&&a.hasClass("avail_check")){ta.store("avail.check.test",true)}else{ta.store("avail.check.test",false)}}return ta.retrieve("avail.check.test")},triggerAvailCheck:function(g){try{if(ta.commerce.checkrates.isAvailCheckTest()){var d=ta.id("CHECK_RATES_CONT");var j=ta.commerce.checkrates.normalizeDate(d.getElement("input.checkIn").value);if(!j){return false}var a=new Date(j.getTime());a.setDate(j.getDate()+2);if(d.getElement("input.checkOut").value.match(/\d+/)){a=ta.commerce.checkrates.normalizeDate(d.getElement("input.checkOut").value);if(!a){return false}}var i="2";var h=d.getElement("select");if(h&&!isNaN(h.value)){i=h.value}var c="0";if(accomIdMatch=d.className.match(/did_(\d+)/)){c=accomIdMatch[1]}var k="191";if(countryIdMatch=d.className.match(/cid_(\d+)/)){k=countryIdMatch[1]}var b="peek";if(g){b="query";if(g=="before"){a.setDate(j.getDate()+2)}}ta.commerce.checkrates.availCheckQuery(ta.commerce.checkrates.tacDateFormat(j),ta.commerce.checkrates.tacDateFormat(a),i,b,k,c)}}catch(f){ta.util.error.record(f,"availability select date click")}},tacDateFormat:function(a){var c=a.getDate();var d=a.getMonth();d=d+"";if(d.length<2){d="0"+d}var b=a.getFullYear();return b+"-"+d+"-"+c},normalizeDate:function(b){if(!b||typeof b!="string"){return false}try{var c=b.match(DATE_FORMAT.pattern);if(c){var f=parseInt(c[DATE_FORMAT.date].replace(/^0/,""));var a=parseInt(c[DATE_FORMAT.month].replace(/^0/,""));var g=parseInt(c[DATE_FORMAT.year].replace(/^0/,""));if(f>0&&f<32&&a>0&&a<13){if(g<100){g+=2000}return ta.util.date.create(g,a-1,f)}else{return false}}else{return false}}catch(d){}return false},availCheckChangeDates:function(){try{document.getElement(".overlay").overlay.hide()}catch(a){ta.util.error.record(a,"availCheckChangeDates")}},openMetaProvider:function(s,h,o,q,l){h=ta.id(h);if(!h||!s){return}if(s.target.src){var a=s.target.src;if(a.contains("expandActive")){var c="ta.commerce.checkrates.isExpanded."+o+"."+q;ta.store(c,true);h.addClass("partnerExpanded").removeClass("partnerCollapsed");return}else{if(a.contains("contract")){var c="ta.commerce.checkrates.isExpanded."+o+"."+q;ta.store(c,false);h.addClass("partnerCollapsed").removeClass("partnerExpanded");return}}}if(q){var n=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+o);var v=false;if(n){v=n.getVendorSet()}else{n=new ta.commerce.CheckRatesData({type:"checkRates",evnt:s},ta.commerce.checkrates.getPropIdFromCRElement(h),o,true);v=n.getVendorSet()}if(n){n.actualTrigger=h}if(v){var r=v.getVendors();for(var t=0;t<r.length;t++){var z=r[t];if(q==z.getContentID()){ta.commerce.checkrates._addTagManToDOM(z);var d=z.getUrl(n,h);var p;if(ta.browser.isIE10Metro()){var y=ta.remove("ta.meta.navArea");if(y=="QC_Meta_Book_Inline"){p="QC_Meta_Metro_Inline"}else{p="QC_Meta_Metro_Lightbox"}}else{p=ta.remove("ta.meta.navArea")||"QC_Meta_Lightbox"}d=ta.commerce.checkrates.addCustomUrlParams(d,p);if(l){d=d+"&m="+l}try{var u=z.name;var m=ta.popups.PopUtil.getProviderWindowDims(u,true);var j=ta.popups.PopUtil.getHoldingWindowSet();if(j.length>0&&n.useHoldingWin){j[j.length-1].repurpose(z.getUrl(n,h),m.customWidth,m.customHeight);if(n.skipHoldingWin){n.useHoldingWin=false}if(ta.has("checkrates.add_holding_windows")){if(z.window.type==ta.popups.PopUtil.windowType.CHECK_RATE){var f=ta.popups.PopUtil.getHoldingWindowSet().length;var k=window.cookieDomain;if(k){if(f>0){Cookie.write("CommercePopunder","HW"+f,{domain:k,duration:0})}else{Cookie.dispose("CommercePopunder",{domain:k})}}}}}else{var g=1;try{if(window.chrome){g=0}}catch(w){}var b={customWidth:m.customWidth,customHeight:m.customHeight,widthOffset:m.widthOffset,heightOffset:m.heightOffset,name:u,url:d,scrollbars:g};ta.popups.PopUtil.createCheckRatesWindow(b)}}catch(w){}ta.commerce.checkrates.trackMetaClick(r[t].name,p,o);ta.commerce.checkrates.logMetaUITestInfo();ta.commerce.checkrates.logLowestPriceTestInfo(h,q);if(p=="QC_Meta_Lightbox"){ta.commerce.checkrates.logMapSponsoredProviderClick(q)}ta.commerce.checkrates.logBlueChevronLowestPriceTestInfo(h,q);ta.commerce.checkrates.addClickOutPixels(o,true);return}}}}},openMetaHacOverlay:function(d,a){if(ta.has("metaDatePickerEnabled")&&!ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.setErrorStyling(a);return}var c=d.getVendorSet().getCheckedContentID();var b=d.getVendorSet().getCheckedVendor();ta.store("ta.commerce.MetaHacOverlay.crData."+d.vendorSetId,d);ta.run("ta.overlays.Factory.metaCheckRatesOverlay",{},d,c,b,a)},multiDatePickerUserData:function(){var d=ta.widgets.calendar.getPageInDate();var b=ta.widgets.calendar.getPageOutDate();var c=ta.widgets.calendar.getPageAdultsCount();if(!d||!(d instanceof Date)||!b||!(b instanceof Date)){return}var a=[];a.push("inMonth=");a.push(d.getMonth()+1);a.push("%20");a.push(d.getFullYear());a.push("&inDay=");a.push(d.getDate());a.push("&outMonth=");a.push(b.getMonth()+1);a.push("%20");a.push(b.getFullYear());a.push("&outDay=");a.push(b.getDate());a.push("&adults=");a.push(c);return a.join("")},_parseDatePickerDate:function(c){if(c&&c.split&&c.split(" ").length>1){var a=c.split(" ");var b=new Date();b.setFullYear(a[0]);b.setMonth(a[1]);b.setDate(a[2]);return b}},buildMiniMetaHacUrl:function(b,a,k,e,g,h,j,i,c,f,d){return ta.commerce.checkrates.buildVarMetaHacUrl("MiniMetaCRAjax",b,a,k,e,g,h,j,i,c,f,d)},buildMetaHacUrl:function(c,b,j,e,f,g,i,h,d){var a=ta.commerce.checkrates.buildVarMetaHacUrl("MetaCheckRatesAjax",c,b,j,e,f,g,i,h,d);if(c&&ta.maps&&ta.maps.mapsponsor){if(typeof c.mapsponsor=="undefined"){c.mapsponsor=ta.maps.mapsponsor.getSponsorForLocation(c.vendorSetId)}if(c.mapsponsor){a+="&mapSponsorship="+c.mapsponsor}}return a},buildVarMetaHacUrl:function(l,w,q,p,t,k,G,m,r,n,h,j){var b=false;if(ta.browser.isIE10Metro()){if(G=="QC_Meta_Book_Inline"){b="QC_Meta_Metro_Inline"}else{b="QC_Meta_Metro_Lightbox"}}else{if(!G){if(ta.has("ta.meta.navArea")){b=ta.retrieve("ta.meta.navArea")}else{b="QC_Meta_Lightbox"}}else{b=G}}var o="";if(ta.has("metaDatePickerEnabled")){o=ta.commerce.checkrates.multiDatePickerUserData()}if(!o){o=w.getUserData();if(!o&&ta.retrieve("parentCheckRatesData")){var d=ta.retrieve("parentCheckRatesData");o=d.getUserData()}if(!ta.has("metaDatePickerEnabled")){if(!m){m=ta.commerce.checkrates.getTravelDataFromDOM()}if(m&&m.sInMonthYear&&m.sOutMonthYear&&m.inDay&&m.outDay&&m.adults){var a=m.sInMonthYear,H=m.sOutMonthYear,g=m.inDay,c=m.outDay,A=m.adults;var z=[];z.push("inMonth=");z.push(a[0]);z.push("%20");z.push(a[1]);z.push("&inDay=");z.push(g);z.push("&outMonth=");z.push(H[0]);z.push("%20");z.push(H[1]);z.push("&outDay=");z.push(c);z.push("&adults=");z.push(A);o=z.join("")}}}if(!o&&w){return"/"+l+"?detail="+w.vendorSetId}else{if(!o&&!w){return +"/"+l+"?detail="}}var v="";if(k){v="&metaVersion="+k}var C="";if(ta.has("meta.baseLocationId")){C="&baseLocId="+ta.retrieve("meta.baseLocationId")}var s="";if(ta.retrieve("checkrates.mini_meta_by_percent_cpc_see_all_click")||ta.retrieve("checkrates.hr_bc_see_all_click")){s="&seeAllClick=true"}var f="/"+l+"?detail="+w.vendorSetId+"&"+o+"&area="+b+"&checkedContentID="+q+"&checkedContentNames="+p+v+C+s;var y=f;try{f=ta.commerce.meta.tracking.updateUrlWithTiming(f,b)}catch(F){ta.util.error.record(F,"problem updating url with timing in CheckRates.buildVarMetaHacUrl");f=y}if(ta.commerce.meta.tracking.hasAnySuppressedAreas()){var D=ta.commerce.meta.tracking.getSuppressedAreasAsString();if(D){f+="&suppressImpressionsOnComplete="+D}}if(ta.retrieve("ta.commerce.suppress_commerce_impressions.enabled")){y=f;try{f=ta.commerce.checkrates.checkSuppressCommerceImpressions(f,j);if(!f){f=y}}catch(F){ta.util.error.record(F,"problem updating url with isFirstPageLoad in CheckRates.buildVarMetaHacUrl");f=y}}if(t){f+="&finalRequest=true"}if(r){f+="&numTries="+r}if(h){f+="&loadingTimeoutPassed="+h}if(n){var u=n[0];if(u){f+="&premiumContentId="+u;for(var B=1;B<n.length;B++){u=n[B];f+=","+u}}}var E="ta.commerce.MetaHacOverlay.currency";if(ta.has(E)){f+="&currency="+ta.retrieve(E);ta.remove(E)}return f},checkSuppressCommerceImpressions:function(a,c){if(!a||!c){return}suppressKey=c+"_suppressCommerceImpressionState";var b=ta.commerce.meta.polling.getPollingAttemptForRequest(c);if(b){if(b===1){if(ta.retrieve("meta.isFromDatesChange")){ta.remove("meta.isFromDatesChange");ta.store(suppressKey,true);a+="&isFirstPageLoad=false";return a}}else{if(ta.retrieve(suppressKey)){a+="&isFirstPageLoad=false";return a}}}return a},getTravelDataFromDOM:function(){var m={};if(!ta.widgets.calendar){return null}var b=ta.widgets.calendar.getPageInDate();var g=ta.widgets.calendar.getPageOutDate();var a=ta.widgets.calendar.hasPageDates();if(a&&b&&b.getMonth&&g&&g.getMonth){var h=ta.widgets.calendar.getPageAdultsCount();var d=new Array();d.push(b.getMonth()+1);d.push(b.getFullYear());var l=new Array();l.push(g.getMonth()+1);l.push(g.getFullYear());m.sInMonthYear=d;m.sOutMonthYear=l;m.inDay=b.getDate();m.outDay=g.getDate();m.adults=h}else{var f=ta.id("META_HAC_DATE_SELECTOR");if(!f){f=ta.id("META_HAC_DATE_SELECTOR_met")}if(!f){return null}var i=f.getElement(".chk-in .month"),c=f.getElement(".chk-in .day"),e=f.getElement(".chk-out .month"),k=f.getElement(".chk-out .day"),j=f.getElement(".adults select");if(!i||!c||!e||!k||!j){return null}m.sInMonthYear=i.value.split(/\//);m.sOutMonthYear=e.value.split(/\//);m.inDay=escape(c.value);m.outDay=escape(k.value);m.adults=j.selectedIndex+1}return m},buildMetaHacUrl_allProviders:function(f,p,i,l,A){var c=false;if(ta.browser.isIE10Metro()){if(A=="QC_Meta_Book_Inline"){c="QC_Meta_Metro_Inline"}else{c="QC_Meta_Metro_Lightbox"}}else{c=A||"QC_Meta_Lightbox"}var r="";if(i){r="&metaVersion="+i}var m="";if(ta.has("metaDatePickerEnabled")){m=ta.commerce.checkrates.multiDatePickerUserData()}else{if(!l){var u=ta.id("META_HAC_DATE_SELECTOR_met");if(!u){return}var q=u.getElement(".chk-in .month"),g=u.getElement(".chk-in .day"),y=u.getElement(".chk-out .month"),k=u.getElement(".chk-out .day"),b=u.getElement(".adults select");if(!q||!g||!y||!k||!b){return}var a=q.value.split(/\//),C=y.value.split(/\//),n=ta.util.date.create(a[1],a[0]-1,g.value),B=ta.util.date.create(C[1],C[0]-1,k.value);var t=[];t.push("inMonth=");t.push(a[0]);t.push("%20");t.push(a[1]);t.push("&inDay=");t.push(escape(g.value));t.push("&outMonth=");t.push(C[0]);t.push("%20");t.push(C[1]);t.push("&outDay=");t.push(escape(k.value));t.push("&adults=");t.push(b.selectedIndex+1);m=t.join("")}}var j="false";if(l&&!ta.has("metaDatePickerEnabled")){j="true"}var v="";if(ta.has("meta.baseLocationId")){v="&baseLocId="+ta.retrieve("meta.baseLocationId")}var o="";if(ta.retrieve("checkrates.mini_meta_by_percent_cpc_see_all_click")||ta.retrieve("checkrates.hr_bc_see_all_click")){o="&seeAllClick=true"}var h="/MetaCheckRatesAjax?detail="+f+"&"+m+"&area="+c+r+"&returnAllOffers=true&useSessionDates="+j+v+o;var s=h;try{h=ta.commerce.meta.tracking.updateUrlWithTiming(h,c)}catch(z){ta.util.error.record(z,"problem updating url with timing in CheckRates.buildMetaHacUrl_allProviders");h=s}if(ta.commerce.meta.tracking.hasAnySuppressedAreas()){var w=ta.commerce.meta.tracking.getSuppressedAreasAsString();if(w){h+="&suppressImpressionsOnComplete="+w}}if(p){h+="&finalRequest=true"}if(ta.maps&&ta.maps.mapsponsor){var d=ta.maps.mapsponsor.getSponsorForLocation(f);if(d){h+="&mapSponsorship="+d}}return h},metaHacRequest:function(z,s,r,C,I,v,k){ta.commerce.meta.clearStoredMiniData();var h="metaHacRequest_curCancelKey";var d=13;if(ta.isStateOptMiniMeta()){d=10}var m=ta.retrieve("meta.travelData");var B=false;if(C==null){m=ta.commerce.checkrates.getTravelDataFromDOM();ta.store("meta.travelData",m);C=new Date().getTime();if(ta.commerce.meta&&z&&z.vendorSetId){if(I){ta.commerce.meta.loadBestPriceXsell(z.vendorSetId,"REC_CONT_INLINE",{isInline:true})}else{ta.commerce.meta.loadBestPriceXsell(z.vendorSetId,"REC_CONT",{isInline:false})}}var p=false;if(I){if(ta.has("metaCheckRatesUpdateDivInline")){p=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}}else{if(ta.has("metaCheckRatesUpdateDiv")){p=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}}if(p&&p.removeClass){p.removeClass("hidden")}if(ta.has("metaUI.hrTestComHvy")){var y=ta.id("COMHVY");if(y){y.removeClass("noDates");y.addClass("hasDates")}var H=ta.id("OPEN_CAL_PRNT");if(H){H.empty()}}if(ta.has("metaUI.hrTestComHvy")||ta.isStateOptMiniMeta()){if(ta.has("metaUI.hiddenAV")){var a=ta.retrieve("metaUI.hiddenAV");if(a&&a.removeClass){a.removeClass("hidden")}ta.remove("metaUI.hiddenAV")}}}var i="metaHacRequest_"+C+"_cancel";if(ta.has(h)){var G=ta.retrieve(h);if(G!=i){ta.store(G,true);ta.commerce.meta.polling.removePollingInfoForRequest(G)}}if(I){var g=document.getElement(".meta_rates_content .postShowMetaCR");var q=document.getElement(".meta_rates_content .postShowMetaCRLB");var b=document.getElement(".meta_rates_content .postShowMetaCRLBPCR");if(ta.has("checkrates.mini_meta_by_percent_cpc")&&ta.retrieve("checkrates.mini_meta_by_percent_cpc_see_all_click")){var w=g.getElement(".seeMore.threshold");if(w){var t=g.getElements(".postClickPrice.hide");t.each(function(J,e){J.removeClass("hide")});w.hide()}}ta.commerce.meta.updateProvArea(g,q,b);if(ta.retrieve("stateopt_modal_test")&&ta.retrieve("worst_hack_ever")){var n=document.getElement(".stateoptModalLink");if(n&&n.click){n.click();ta.store("worst_hack_ever",false);ta.store("stateoptModal.GA_auto",true)}}}if(!ta.has(i)){ta.store(i,false);ta.store(h,i)}if(ta.retrieve(i)==true){return}var E=ta.retrieve("metaCheckRatesOverlay");if(!z||(!E&&!I)){return}var A=false;if(E){A=E.inner}if(ta.has("metaCheckRatesUpdateDiv")){A=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}if(I&&ta.has("metaCheckRatesUpdateDivInline")){A=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}if(!A){return}try{A.innerHTML=ta.commerce.checkrates._setCollapseExpand(z,A.innerHTML);if(ta.retrieve("metaChangeDateClicked")){ta.commerce.checkrates.removeProviderCheckboxClick();ta.remove("metaChangeDateClicked")}if(ta.retrieve("metaAvailSectionsCheckboxEnabled")){ta.commerce.checkrates.restoreProviderCheckboxClick()}var D;if(ta.commerce.meta.polling.isRequestBeingPolled(i)){D=ta.commerce.meta.polling.getPollingAttemptForRequest(i);if(!D||D>d){ta.commerce.meta.polling.removePollingInfoForRequest(i);return}}else{D=1;ta.commerce.meta.polling.setPollingAttemptForRequest(i,D)}if(!A.innerHTML.contains("hacComplete")){var c=false;if(I){c="QC_Meta_Inline"}if(!v){v=1}if(ta.isMetaHotelMBP2013()&&typeof(ta.commerce.meta)!="undefined"){ta.commerce.meta.hideMiniMetaCrossSell("MINI_META_CROSS_SELL_UNAVAIL")}setTimeout(function(){new Request({url:ta.commerce.checkrates.buildMetaHacUrl(z,s,r,true,k,c,m,v),onSuccess:function(e,J){if(ta.retrieve(i)==true){return}if(ta.retrieve("metaCheckRatesOverlay")||ta.retrieve("metaCheckRatesUpdateDivInline")){e=ta.commerce.checkrates._setCollapseExpand(z,e);A.innerHTML=e;if(ta.retrieve("checkrates.meta_ui_sk_box")){ta.commerce.meta.restoreProviderHover()}}if(ta.retrieve("metaChangeDateClicked")){ta.commerce.checkrates.removeProviderCheckboxClick();ta.remove("metaChangeDateClicked")}if(ta.retrieve("metaAvailSectionsCheckboxEnabled")){ta.commerce.checkrates.restoreProviderCheckboxClick()}if((ta.commerce.checkrates.getMetaPricesCount(I)>0||D>9)&&ta.commerce.meta.hacIsBlockingXSell(I)){if(I){ta.commerce.meta.metaInYourMeta("REC_CONT_INLINE",{xsell:false,inline:true})}else{ta.commerce.meta.metaInYourMeta("REC_CONT",{xsell:false,inline:false})}}ta.commerce.checkrates.updateMetaProviders(z);ta.store("ta.commerce.checkrates.hacAttempt",D+1);if(ta.retrieve("meta.dropdownMiniMeta")){ta.commerce.checkrates.updateDropdownFlyout(e)}if(ta.retrieve("meta.sponsoredLinks")){ta.commerce.checkrates.updateSponsoredLinks(e)}if(ta.has("meta.isHackathonBC")){if(ta.isStateOptNoAvailOnHREnabled()&&e.contains("showStateOptHRNoAvailability")){ta.commerce.meta.showStateOptHRNoAvailUI(e)}else{if(e.contains("showCarousel")){ta.commerce.meta.loadCarouselXSell(e.contains("anyOfferLoadingOrNotDisplaying"))}else{ta.commerce.meta.hideCarouselXSell()}}if(ta.isBCHoverTable()){ta.commerce.meta.handleHoverTableResponseText(e)}}ta.commerce.meta.polling.incrementPollingAttemptForRequest(i);ta.commerce.checkrates.metaHacRequest(z,s,r,C,I,v+1,k)},evalScripts:true}).send()},ta.commerce.meta.polling.getPollingWaitTimeForRequest(i))}else{try{ta.commerce.meta.polling.removePollingInfoForRequest(i);if(I){ta.commerce.meta.metaInYourMeta("REC_CONT_INLINE",{xsell:false,inline:true})}else{ta.commerce.meta.metaInYourMeta("REC_CONT",{xsell:false,inline:false})}if(E){ta.commerce.meta.storeMiniData(E.inner)}var o=ta.commerce.checkrates._getAvailCount(A);var j;var u="complete";if(I){if(ta.id("COMHVY")){j="Mini-Meta";if(ta.find(".NotShowing .postClickPrice")){u+="_may_be_available"}else{if(ta.find("#HotelDateSearch .price .minCost")){if(ta.find(".strikeHigh")){u+="_available_lp_chevron"}else{u+="_available"}}else{u+="_unavailable"}}}else{j="Metainline"}}else{j="meta_lightbox"}if(A.innerHTML.contains("doneNoAvailability")){ta.widgets.calendar.trackCalendarEvent("DATEPICKER","RESULTS_EMPTY",ta.widgets.calendar.getPageAdultsCount(),ta.widgets.calendar.getPageAdultsCount());if((ta.id("MAYBE_BUTTONS_INLINE")&&I)||(ta.id("MAYBE_BUTTONS")&&!I)&&j!="Mini-Meta"){u+="|may_be_availabile"}else{if(j!="Mini-Meta"){u+="|unavailable"}}}else{ta.widgets.calendar.trackCalendarEvent("DATEPICKER","RESULTS_PRESENT",ta.widgets.calendar.getPageAdultsCount(),ta.widgets.calendar.getPageAdultsCount())}ta.trackEventOnPage(j,u,o.toString());ta.commerce.meta.showLowestPriceCTA(I);if(ta.isStateOptMiniMeta()&&typeof(ta.commerce.meta)!="undefined"){if(A.innerHTML.contains("doneNoAvailability")&&window.modelLocId){ta.commerce.meta.hacAltDates(window.modelLocId,true,null,"MM_ALT_DATES");ta.commerce.meta.loadMiniMetaCrossSell(window.modelLocId,"MMSO_XSELL",false,false)}else{ta.trackEventOnPage("Mini_meta_State-Optimized","display","not_shown")}}if(ta.isMetaHotelMBP2013()&&typeof(ta.commerce.meta)!="undefined"){if(A.innerHTML.contains("hacMiniOfferUnavailable")){ta.commerce.meta.loadMiniMetaCrossSell(ta.retrieve("meta.baseLocationId"),"MINI_META_CROSS_SELL",false,false);ta.commerce.meta.showMiniMetaCrossSell("MINI_META_CROSS_SELL_UNAVAIL")}else{ta.commerce.meta.hideMiniMetaCrossSell("MINI_META_CROSS_SELL_UNAVAIL")}}if(ta.has("tests.bookingcom")&&ta.tests&&ta.tests.bookingcom){ta.tests.bookingcom.chkLightbox()}var l=ta.find(".overlay .skv3");if(l&&l.hasAttribute("data-sponsor")){var f=l.getAttribute("data-sponsor");ta.maps.ads.injectMetaLightBoxAd(f)}if(ta.isBCHoverTable()){ta.commerce.meta.handleHoverTableResponseText(responseText)}}catch(F){ta.util.error.record(F,"ta.commerce.meta.metaHacRequest - failure in complete results block")}}}catch(F){ta.util.error.record(F,"meta HAC - ajax requests")}},getMetaPricesCount:function(a){var c=0;var b=ta.retrieve("metaCheckRatesOverlay");var d=false;if(b){d=b.inner}if(ta.has("metaCheckRatesUpdateDiv")){d=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}if(a&&ta.has("metaCheckRatesUpdateDivInline")){d=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}if(!d){return}var e=d.getChildren(".metaProvider .roomPrice");if(e){c=e.length}return c},_getAvailCount:function(c){var a=0;var b=0;c=ta.id(c);var e=c.getChildren(".metaProvider");if(e){a=e.length}var d=c.getChildren(".remainingProviders .available");if(d){b=d.length}return a+b},miniMetaReportLateAvailability:function(){var c=document.getElement("#CHECK_RATES_CONT div.hacMiniComplete");var a=document.getElement("#CHECK_RATES_CONT div.hacMiniCompleteTimeOut");if(c||a){return}var b=document.getElement("div.bc_flags");if(b){b.addClass("hacMiniCompleteTimeOut")}ta.commerce.checkrates.cancelMiniMetaCurrentQuery();ta.commerce.checkrates.gaHacCompleteAndStillLoading()},miniMetaAppearLoaded:function(f,e,c,b,a){var d=document.getElement("#CHECK_RATES_CONT div.hacMiniComplete");if(d){return}ta.commerce.checkrates.cancelMiniMetaCurrentQuery();ta.commerce.checkrates.gaHacCompleteOrTimedOut(b,true);ta.commerce.checkrates.removePremiumsIfLoading();ta.commerce.checkrates.loadingTextLinksToVisitSite();ta.commerce.checkrates.noPremiumOffers();ta.commerce.checkrates.miniMetaHacRequest(f,e,c,new Date().getTime(),a+1,true)},noPremiumOffers:function(){var b=document.getElements("#CHECK_RATES_CONT div.premium");var a=document.getElement(".similarCarousel");if(b.length<1&&!a){ta.commerce.meta.loadCarouselXSell(false)}},loadingTextLinksToVisitSite:function(){var d=document.getElements("#CHECK_RATES_CONT span.textLink");var g=[];var j=[];var a=[];var b=[];var f=0;if(!d){return}for(var e=0;e<d.length;e++){var k=d[e];if(e<3){g.push(k)}var n=k.getElement(".textLinkLoading");var m=k.getElement(".sprite-visitSite");if(k.getElement(".price")){j.push(k)}else{if(n||m){if(n&&m){n.hide();m.show()}a.push(k)}else{b.push(k)}}if(k.hasClass("remaining")){f++}if(e>2){k.dispose()}}var o=d.length-f;var p=[];var h=true;var l=document.getElement("#CHECK_RATES_CONT div.textLinks");var c;if(l){c=l.getElement(".wrap")}if(!c){return}p.push.apply(p,j);p.push.apply(p,a);p.push.apply(p,b);for(e=0;e<p.length;e++){k=p[e];if(e<3){if(h&&k.get("data-contentid")==g[e].get("data-contentid")){k=d[e]}else{h=false;g[e].dispose()}}var q=e%2==0;if(q){k.addClass("odd")}else{k.removeClass("odd")}if(o<1){k.addClass("remaining")}else{k.removeClass("remaining")}o--;if(!h||e>2){k.inject(c,"bottom")}}},removePremiumsIfLoading:function(){var b=document.getElements("#CHECK_RATES_CONT div.premium");for(var a=0;a<b.length;a++){var c=b[a];if(c.getElement(".loading")){c.dispose()}}},cancelMiniMetaCurrentQuery:function(){var a="miniMetaHacRequest_curCancelKey";if(ta.has(a)){var b=ta.retrieve(a);ta.store(b,true);ta.commerce.meta.polling.removePollingInfoForRequest(b)}},updateInterrupter:function(b){var d=0;for(var c=0;c<b.length;c++){if(b[c].hasClass("interrupterContent")){d=b[c];break}}if(d){var a=document.getElement("#MINI_META_IN_REVIEWS");if(a){if(a.getElement(".interrupterContent")){a.getElement(".interrupterContent").destroy()}d.inject(a);ta.widgets.calendar.syncAllDatePickers();if(ta.has("ta.mmir.newDates")&&d.hasClass("loading")){if(ta.has("hac.progress.timer")){ta.remove("hac.progress.timer").stopTimer()}if(document.getElement(".interrupterProgressBar")){ta.store("hac.progress.timer",new ta.hac.RequestTimer({showProgressBar:true,triggerLoadingState:false,triggerListingsLoadState:false,trackProgress:false,progBarContainerSelector:".interrupterProgressBar",forceResults:false}))}ta.remove("ta.mmir.newDates")}else{if(ta.has("hac.progress.timer")&&!d.hasClass("loading")){ta.retrieve("hac.progress.timer").closeProgressBar()}}}}},miniMetaHacRequest:function(o,m,l,p,n,a){if(!n){n=0}if(!a){a=false}var d="miniMetaHacRequest_curCancelKey";var c=13;if(ta.isStateOptMiniMeta()){c=10}var f=ta.retrieve("meta.travelData");if(p==null){f=ta.commerce.checkrates.getTravelDataFromDOM();ta.store("meta.travelData",f);ta.store("ta.commerce.checkrates.hacAttempt",0);p=new Date().getTime()}var e="miniMetaHacRequest_"+p+"_cancel";if(ta.retrieve(e)==true){return}if(ta.has(d)){var s=ta.retrieve(d);if(s!=e){ta.store(s,true);ta.commerce.meta.polling.removePollingInfoForRequest(s)}}if(!ta.has(e)){ta.store(e,false);ta.store(d,e)}var r;if(ta.commerce.meta.polling.isRequestBeingPolled(e)){var r=ta.commerce.meta.polling.getPollingAttemptForRequest(e);if(!r||r>c){ta.commerce.meta.polling.removePollingInfoForRequest(e);return}}else{r=1;ta.commerce.meta.polling.setPollingAttemptForRequest(e,r)}var h=[];if(a){var t=$$("#CHECK_RATES_CONT div.premium");for(var q=0;q<t.length;q++){var b=t[q].get("data-contentid");h.push(parseInt(b))}}var g="miniMetaHacRequest_longTimeoutKey";var k="miniMetaHacRequest_appearLoadedTimeoutKey";if(n<1){var j;if(ta.has(g)){j=ta.retrieve(g);clearTimeout(Number.from(j))}if(ta.has(k)){j=ta.retrieve(k);clearTimeout(Number.from(j))}j=setTimeout(function(){ta.commerce.checkrates.miniMetaReportLateAvailability()},ta.commerce.minimeta.ajax.MINI_META_STOP_LOADING_TIMEOUT);ta.store(g,Number.from(j))}if(ta.isMetaHotelMBP2013()&&typeof(ta.commerce.meta)!="undefined"){ta.commerce.meta.hideMiniMetaCrossSell("MINI_META_CROSS_SELL_UNAVAIL")}new Request({url:ta.commerce.checkrates.buildMiniMetaHacUrl(o,m,l,true,null,"QC_Meta_Mini",f,n,h,a,e),onSuccess:function(G,i){if(ta.retrieve(e)==true){return}var D=new Element("div",{html:G});var R=G.contains("hacMiniComplete");var L=document.getElement(".similarCarousel");var I=Elements.from(G);if(!L||n<1){ta.commerce.meta.updateProvArea(I[0],I[1],I[2]);if(ta.has("ta.mini_meta_in_reviews")){ta.commerce.checkrates.updateInterrupter(I)}}if(ta.retrieve("meta.dropdownMiniMeta")){if(!document.getElement(".dropdownMiniMeta")){var z=document.getElement(".postShowMetaCR");if(z){ta.commerce.checkrates.injectDropdownMiniMeta(G,z)}}ta.commerce.checkrates.updateDropdownFlyout(G)}if(ta.isBCHoverTable()){ta.commerce.meta.handleHoverTableResponseText(G)}if(ta.has("meta.isHackathonBC")&&!a){if(ta.isStateOptNoAvailOnHREnabled()&&G.contains("showStateOptHRNoAvailability")){ta.commerce.meta.showStateOptHRNoAvailUI(G)}else{if(G.contains("showCarousel")){if(!L){ta.commerce.meta.loadCarouselXSell(G.contains("anyOfferLoadingOrNotDisplaying"))}}else{ta.commerce.meta.hideCarouselXSell()}}}if(ta.has("meta.isHackathonBC")&&ta.has("meta.horizontal_xsell_enabled")){ta.commerce.meta.horizontalXSell.updateHorizontalXSell(D,o.vendorSetId)}if(ta.has("meta.isHackathonBC")&&I&&I.length>0){var K=ta.id("META_COMMERCE_BUTTON");var E=I[0];if(K&&E){var P=E.getElement(".price");var O=E.getElement(".offer")?E.getElement(".offer").get("data-contentid"):null;var S=E.getElement(".offer")?E.getElement(".offer").get("data-provider"):null;if(S){var A=E.getElement(".providerLogo");var C=A&&A.getElement("img")?A.getElement("img").get("alt"):null;if(S.contains("Com")&&!C.contains("Com")){S=C}}if(S&&P&&O){var T=document.getElement(".noRequest");if(T){T.removeClass("noRequest")}var N=K.get("onclick");var J="Meta_Thumbnail";var B=N.indexOf("this")+7;var y=N.lastIndexOf(",")-1;var M=N.substring(B,y);K.removeEvents("click");K.addEvent("click",function(V){ta.commerce.meta.updateNavArea(J);ta.call("ta.commerce.checkrates.openMetaProvider",V,this,M,O)});var H=".price";K.getElement(H).innerHTML=P.innerHTML;var u=".provider";K.getElement(u).innerHTML=S}else{var w=document.getElement(".metaClickOnHero");if(w){w.addClass("noRequest")}}}}if(!R&&ta.has("meta.isHackathonBC")&&!ta.isStateOptNoAvailOnHREnabled()&&G.contains("firstRequest")){j=setTimeout(function(){ta.commerce.checkrates.miniMetaAppearLoaded(o,m,l,p,n)},ta.commerce.minimeta.ajax.MINI_META_APPEAR_LOADING_TIMEOUT);ta.store(k,Number.from(j))}if(!R){ta.commerce.meta.polling.incrementPollingAttemptForRequest(e);setTimeout(function(){ta.commerce.checkrates.miniMetaHacRequest(o,m,l,p,n+1,a)},ta.commerce.meta.polling.getPollingWaitTimeForRequest(e))}else{if(ta.isMetaHotelMBP2013()&&typeof(ta.commerce.meta)!="undefined"){ta.commerce.meta.polling.removePollingInfoForRequest(e);if(G.contains("hacMiniOfferUnavailable")){ta.commerce.meta.showMiniMetaCrossSell("MINI_META_CROSS_SELL_UNAVAIL")}else{ta.commerce.meta.hideMiniMetaCrossSell("MINI_META_CROSS_SELL_UNAVAIL")}}else{if(ta.has("meta.isHackathonBC")){var v="meta.bc.bestPricesForYourStay";if(G.contains("allNotAvailable")){v="meta.bc.onlinePricesNotAvailable"}ta.commerce.meta.updateHeaderMsg(".metaDatesChosen",ta.retrieve(v));ta.commerce.meta.polling.removePollingInfoForRequest(e);ta.commerce.meta.displayBlueChevronLowestPriceCTA();if(ta.has("tests.bookingcom")&&ta.tests&&ta.tests.bookingcom){ta.tests.bookingcom.chkHR(true)}if(!a){ta.commerce.checkrates.gaHacCompleteOrTimedOut(p,false)}if(ta.isStateOptNoAvailOnHREnabled()&&G.contains("showStateOptHRNoAvailability")){ta.commerce.meta.showStateOptHRNoAvailUI(G)}var Q=document.getElement(".similarCarousel");if(a&&Q){ta.commerce.checkrates.gaHacCompletedAfterTimeOut(G)}setTimeout(function(){ta.commerce.checkrates.gaHacCompleteAndStillLoading()},1000)}else{if(ta.isStateOptMiniMeta()&&typeof(ta.commerce.meta)!="undefined"){ta.commerce.meta.polling.removePollingInfoForRequest(e);if(G.contains("hacMiniOfferUnavailable")){ta.commerce.meta.hacAltDates(window.modelLocId,true,null,"MM_ALT_DATES");ta.commerce.meta.loadMiniMetaCrossSell(window.modelLocId,"MMSO_XSELL",false,false)}else{ta.trackEventOnPage("Mini_meta_State-Optimized","display","not_shown")}}}}}if(ta.retrieve("meta.sponsoredLinks")){ta.commerce.checkrates.updateSponsoredLinks(G)}if(R&&ta.retrieve("meta_urgency_messaging.enabled")){var F=ta.id("META_URGENCY_MESSAGE");if(F&&F.hasClass("hidden")){var U=35;F.setStyles({height:0,opacity:0});F.removeClass("hidden");new Fx.Tween(F).start("height",0,U).chain(function(){F.setStyle("height","auto");this.start("opacity",0,1)})}}},evalScripts:true}).send()},gaHacCompleteAndStillLoading:function(){var a=ta.commerce.checkrates.getNumOffersStillLoading();if(a>0){ta.trackEventOnPage("HAC","HACError","LoadingAfterHACComplete",a,true)}},gaHacCompleteOrTimedOut:function(g,j){var c=0;var h="unknown";if(j){c=ta.commerce.minimeta.ajax.MINI_META_APPEAR_LOADING_TIMEOUT;var i=ta.commerce.checkrates.getNumOffersStillLoading();var b=document.getElements("#CHECK_RATES_CONT div.premium");var d=document.getElements("#CHECK_RATES_CONT span.textLink");var f=0;if(b){f+=b.length}if(d){f+=d.length}var a=f-i;if(f>0){var e=Math.round((a/f)*10)*10;if(e%10==0&&e>-1&&e<101){h=""+e+"percent"}}}else{c=new Date().getTime()-g;h="100percent"}ta.trackEventOnPage("HAC","HACComplete",h,c,true)},getNumOffersStillLoading:function(){var c=document.getElements("#CHECK_RATES_CONT span.textLinkLoading");var b=document.getElements("#CHECK_RATES_CONT div.loading");var a=0;if(c){a+=c.length}if(b){a+=b.length}return a},gaHacCompletedAfterTimeOut:function(e){var d=Elements.from(e)[0];if(!d){return}var c=d.getElementsByClassName("price");var b=d.getElementsByClassName("priceBlock");var a=0;if(c){a+=c.length}if(b){a+=b.length}ta.trackEventOnPage("HAC","StateCarouselDisplayed","",a,true)},showHideXSellCarousel:function(a){if(ta.isStateOptNoAvailOnHREnabled()&&a.contains("showStateOptHRNoAvailability")){ta.commerce.meta.showStateOptHRNoAvailUI(a)}else{if(a.contains("showCarousel")){ta.commerce.meta.loadCarouselXSell(a.contains("anyOfferLoadingOrNotDisplaying"));ta.store("showHoverTextLinks",true)}else{ta.commerce.meta.hideCarouselXSell()}}},injectDropdownMiniMeta:function(c,a){responseXML=new Element("div",{html:c});var b=responseXML.getElement(".dropdownMiniMeta");if(b){b.inject(a)}},updateDropdownFlyout:function(c){var a=document.getElement(".rgba_flyout.dropdownMiniMeta");if(a){responseXML=new Element("div",{html:c});var b=responseXML.getElement(".dropdownMiniMeta");if(b){var d=a.getElement(".inner");d.innerHTML="";b.set("class","dropdownMiniMeta");d.adopt(b)}ta.commerce.checkrates.setDropdownHoverState()}},updateSponsoredLinks:function(c){var b=ta.id("COMMERCE_TOP");if(b){var d=b.getElement("ul");if(d){responseXML=new Element("div",{html:c});var a=responseXML.getElement(".metaSponsoredLinks");if(a){a.set("class","metaSponsoredLinks");a.replaces(d)}}}},setDropdownHoverState:function(){if(ta.retrieve("dropdownMiniMeta.hover")){ta.commerce.meta.hoverTopOffer()}else{if(ta.retrieve("dropdownMiniMeta.blur")){ta.commerce.meta.blurTopOffer()}}},updateMetaProviders:function(e){var m=e.getVendorSet();var o=m.getVendors();var f=ta.id("META_UI_AVAIL_SECTIONS");for(var g=0;g<o.length;g++){var h=o[g].getContentID();var d=o[g].vendorName;var k=o[g].options.image;var l=ta.id("partner_"+h);if(l&&d){var c="";if(!f&&e.options.type!="meta_inline_checkrates"){if(k){var b="82";c='<div class="partnerImage"><img src="'+CDNHOST+"/img2/"+k+'" alt="'+d+'" width="'+b+'"></div>'}else{c='<div class="partnerName">'+d+"</div>"}}l.innerHTML=c+l.innerHTML.replace(/@@partnerName@@/g,d)}}var p=document.getElement("#CHECK_RATES_CONT ul.provider");var n=document.getElement("#META_HAC_DATE_SELECTOR .providerContainer");if(!n){n=document.getElement("#META_HAC_DATE_SELECTOR_met .providerContainer")}if(p&&p.length>0&&n&&n.length>0){n[0].innerHTML=p[0].outerHTML}var j=document.getElement("#META_UI_AVAIL_SECTIONS .meta_title_div");if(j){var a=document.getElement("#META_UI_AVAIL_SECTIONS .meta_title_replace");j.innerHTML=a.innerHTML}},showMetaDateSelector:function(){var b=ta.id("META_HAC_DATE_SELECTOR"),a=ta.id("META_HAC_ROOM_LIST");if(!b){b=ta.id("META_HAC_DATE_SELECTOR_met")}if(b){if(this.metaTimeout){clearTimeout(this.metaTimeout)}this.checkAllProviders();b.show();if(a){a.hide()}ta.store("ta.commerce.checkrates.hide_room_types",true)}},selectCheckboxForProvider:function(c){if(!c){return}var b=document.getElementById(c);var a=b&&b.getNext(".checkbox_ui");if(b){b.checked=!b.checked;ta.commerce.checkrates.storeProviderCheckboxClick(c)}if(a){a.toggleClass("checked");if(a.hasClass("checked")){a.setProperty("src",CDNHOST+"/img2/ui/checkbox_org_checked.gif")}else{a.setProperty("src",CDNHOST+"/img2/ui/checkbox_org_unchecked.gif")}}},storeProviderCheckboxClick:function(b){var a=document.getElementById(b);ta.store(b,a)},restoreProviderCheckboxClick:function(){var b=document.getElements("#META_UI_AVAIL_SECTIONS #META_HAC_ROOM_LIST .chk");var a=document.getElements("#META_UI_AVAIL_SECTIONS #META_HAC_ROOM_LIST .checkbox_ui");b.each(function(d){var c=ta.retrieve(d.id);if(c){d.checked=c.checked}});a.each(function(d){var c=ta.retrieve(d.name);if(c){if(c.checked){d.addClass("checked");d.setProperty("src",CDNHOST+"/img2/ui/checkbox_org_checked.gif")}else{d.removeClass("checked");d.setProperty("src",CDNHOST+"/img2/ui/checkbox_org_unchecked.gif")}}})},checkAllProviders:function(){var a=document.getElements('.provider input[type="checkbox"]');ta.commerce.checkrates.selectAllCheckBoxes(a)},selectAllCheckBoxes:function(a){a.each(function(b){b.checked=true;ta.commerce.checkrates.storeProviderCheckboxClick(b.id)})},selectAllImgCheckBoxes:function(a){a.each(function(b){b.addClass("checked");b.setProperty("src",CDNHOST+"/img2/ui/checkbox_org_checked.gif")})},modifyElmtClassNameForTracking:function(a){if(a&&/custom_area_QC_Meta[ \t\Z]/.test(a.className)){if(ta.browser.isIE10Metro()){a.className=a.className.replace("QC_Meta","QC_Meta_Metro")}else{a.className=a.className.replace("QC_Meta","QC_Meta_Lightbox")}}},_setCollapseExpand:function(b,h){var l=b.getVendorSet().getVendors();var f=0;for(var e=0;e<l.length;e++){var k=l[e];var d=k.propertyId;var a=k.getContentID();var j="ta.commerce.checkrates.isExpanded."+d+"."+a;var c=ta.retrieve(j);if(d&&a){var g="collapseExpand_"+d+"_"+a;if(c){h=h.replace(g,"partnerExpanded")}else{h=h.replace(g,"partnerCollapsed")}}}return h},changeMetaDates:function(c,b){var a=ta.id("META_HAC_DATE_SELECTOR_met");if(a){a.setStyle("display","block");b.destroy()}if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}},partnerHoverOn:function(c,b){var a=b;while(a&&!a.hasClass("partner")){a=a.parent}if(a){a.addClass("partnerHvr")}},partnerHoverOff:function(c,b){var a=b;while(a&&!a.hasClass("partner")){a=a.parent}if(a){a.removeClass("partnerHvr")}},toggleUrgencyMessage:function(m){try{if(!m){m=""}var c=ta.id("URGENCY_MESSAGE"+m);if(!c){return}var d=false;var l=false;var i=false;var j=false;var a="";var f="";var b=false;if(c.hasClass("slide_in")){var n=document.getElement("#HotelDateSearch .provider");b=document.getElement("#BODYCON .col.balance");if(n&&b){var h=n.getCoordinates();var k=b.getCoordinates();c.style.top=(h.top-k.top)+"px";c.style.left=(k.width+7)+"px";b.style.position="relative";j=h.left-k.left+70}a="slide_in";b.addClass("hide_x_overflow")}else{if(c.hasClass("middle")){var n=document.getElement("#HotelDateSearch .provider");if(n){var h=n.getCoordinates();var b=ta.id("PAGE");c.style.top=h.top+"px";c.style.left=(h.left+70)+"px"}a="middle"}else{if(m=="_pcr"){var n=document.getElement("#PERSISTENT_CHECK_RATES .fl");if(n){var b=document.getElement("#PERSISTENT_CHECK_RATES");var h=n.getCoordinates(b);c.style.top=h.top+"px";c.style.left=(h.right+10)+"px"}a="pcr"}else{if(c.hasClass("top_right")){var b=document.getElement("#HEAD .masthead");a="top_right"}else{if(c.hasClass("bottom_right")){a="bottom_right"}}}}}if(b){b.grab(c.dispose())}if(c.hasClass("anim_left")){l="left";i=c.style.left;d=new Fx.Tween(c,{transition:"quad:out",duration:"1500"});f="left"}else{if(c.hasClass("anim_height")){l="height";i=0;j=c.getSize().y;d=new Fx.Tween(c,{transition:"quad:out",duration:"500"});c.style.height="0px";f="height"}else{if(c.hasClass("anim_opacity")){l="opacity";i=0;j=1;d=new Fx.Tween(c,{transition:"bounce:out",duration:"250"});c.addClass("opacity_0");f="opacity"}}}c.removeClass("hide_section");if(ta.has("checkrates.urgency_msg_once")){d.start(l,i,j);if(m=="_pcr"){ta.store("checkrates.urgencyMsgPCRShowing",true)}else{d.chain(function(){this.start.delay(6000,this,[l,j,i])});if(c.hasClass("slide_in")){d.chain(function(){c.addClass("hide_section");if(b.hasClass("hide_x_overflow")){b.removeClass("hide_x_overflow")}})}}}else{d.start(l,i,j).chain(function(){this.start.delay(6000,this,[l,j,i])},function(){this.start.delay(4000,this,[l,j,i])},function(){this.start.delay(6000,this,[l,j,i])})}ta.trackEventOnPage("UrgencyMessage",f,a,1,true)}catch(g){ta.util.error.record(g,"urgency messaging")}},providerLoadTestReq:function(a){if(ta.retrieve("checkrates.meta_provider_load_test")){new Request({url:"/ProviderLoadTestAjax",data:{detail:a}}).send()}},_addTagManToDOM:function(b){if(b.options.trackClick){var a=new Element("img",{src:b.options.trackClick,height:1,width:1,styles:{position:"absolute",bottom:0,left:0}});document.body.appendChild(a)}},addClickOutPixels:function(d,b){try{if(ta.has("remarketing.clickoutpixels")&&ta.has("remarketing.clickouturl")){var a=ta.retrieve("remarketing.clickouturl");if(a){if(b){a+="&isMetaCheckRates=true"}a=a.replace("replaceTxt",d)}ta.store("ads.monikerClickOutUrl",a);ta.common.ads.loadClickOutMonikers()}}catch(c){ta.util.error.record(c,"click out monikers failure (meta="+b+")")}},displayRemainingProviders:function(d){try{var c=ta.id("CHECK_RATES_CONT");var b=c.getElements("li");for(var a=b.length;a--;){b[a].removeClass("hide")}d.hide();ta.store("checkrates.mini_meta_by_percent_cpc_see_all_click",true)}catch(f){ta.util.error.record(f,"displayRemainingProviders")}},addMetaHacRoomInfoToOffer:function(d,c,b){if(!b||!c||!d){return}var a=ta.retrieve("ta.commerce.hacRoomInfo."+c)||new ta.commerce.HACRoomInfo(c);a.setRoomDetailKey(d,b);ta.store("ta.commerce.hacRoomInfo."+c,a)},startScooter:function(){try{if(typeof ta!="undefined"&&ta.p13n&&ta.p13n.Scooter){var a=ta.retrieve("scooterObj");if(a&&a!="undefined"){a.removeScooter(a);ta.remove("scooterObj")}var a=new ta.p13n.Scooter();if(a){if(ta.retrieve("checkrates.hotel_flyout_micro_meta")&&a.getScooterContent){a.getScooterContent(a)}else{if(a.getScooterContentNonAjax){a.getScooterContentNonAjax(a)}}ta.store("scooterObj",a);ta.trackEventOnPage("scooter","Displayed",null,0,true)}}}catch(b){ta.util.error.record(b,"startScooter failed")}},getTravelDataForURL:function(){try{var d=[];var i=ta.retrieve("meta.travelData");i=ta.commerce.checkrates.getTravelDataFromDOM();if(i&&i.sInMonthYear&&i.sOutMonthYear&&i.inDay&&i.outDay&&i.adults){var g=i.sInMonthYear,c=i.sOutMonthYear,b=i.inDay,a=i.outDay,f=i.adults;d.push("inMonth=");d.push(g[0]);d.push("%20");d.push(g[1]);d.push("&inDay=");d.push(b);d.push("&outMonth=");d.push(c[0]);d.push("%20");d.push(c[1]);d.push("&outDay=");d.push(a);d.push("&adults=");d.push(f)}return d.join("")}catch(h){ta.util.error.record(h,"getTravelDataForURL")}}};ta.queueForLoad(function(){var c=false;try{c=window.location.href}catch(b){}if(c){var a=ta.retrieve("pcr.initialUrl");if(!a){a=c;ta.store("pcr.initialUrl",a)}}if(ta.commerce.checkrates.showMetaCheckRates()){ta.commerce.checkrates.checkAllProviders()}},"pcr.inititalUrl and metro check all providers");ta.commerce.meta={toggleTab:function(c,d,a){if(c&&ta.id(c).hasClass("selected")&&a){return}var b=ta.id(c);var f=false;if(b.hasClass("tab0")){f=document.getElement(".meta_inline_tabs .tab1");document.getElement(".meta_review_content").show();document.getElement(".meta_rates_content").hide();ta.remove("pcr.disabled");if(a){ta.trackEventOnPage("MetaInline","reviews_tab_click","")}else{ta.trackEventOnPage("MetaInline","reviews_tab","")}}else{if(!ta.has("metaCheckRatesCSS")){ta.store("metaCheckRatesCSS",new Asset.css(metaCheckRatesCSS))}var e=c.className.match(/locId_(\d+)/)[1];var g=true;ta.commerce.checkrates.geoId=e;if(!b.hasClass("dont_show")){ta.store("pcr.disabled",true);if(ta.retrieve("pcr.overlay")){ta.retrieve("pcr.overlay").hide()}}ta.commerce.checkrates.updateCRForm("_imt");f=document.getElement(".meta_inline_tabs .tab0");b=document.getElement(".meta_inline_tabs .tab1");if(!b.hasClass("dont_show")){document.getElement(".meta_review_content").hide();document.getElement(".meta_rates_content").show()}if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}ta.commerce.meta.updateInlineMeta(e,d);ta.trackEventOnPage("MetaInline","prices_tab","");if(a){ta.trackEventOnPage("MetaInline","prices_tab_click","")}}if(!b.hasClass("dont_show")){ta.id(f).removeClass("sprite-tab-active");ta.id(f).addClass("sprite-tab-idle");ta.id(b).addClass("sprite-tab-active");ta.id(b).removeClass("sprite-tab-idle");ta.id(b).addClass("selected");ta.id(f).removeClass("selected")}},updateInlineMeta:function(d,b){if(!ta.widgets.calendar.hasPageDates()){ta.commerce.meta.popInlineDatePicker(b,d);return}var a=ta.id("CHECK_RATE");if(!a){return}var c=new ta.commerce.CheckRatesData({type:"meta_inline_checkrates",evnt:b},d,d,true);ta.commerce.checkrates.checkAllProviders();ta.commerce.meta.loadInlineMeta(c,d)},popInlineDatePicker:function(c,d){if(!d){return}var a;var b="_inm";if(c&&c.target&&c.target.getParent("#CHECK_RATES_CONT")){a=ta.id("date_picker_"+d)}a=a||ta.id("date_picker_"+d+b);if(a){var e=a.getParent(".date_picker_calendar_wrap");if(e&&e.onclick){e.onclick(c,e,d,b);e.fireEvent("click",c,e,d,b);(function(){try{ta.retrieve("avail.data."+d+b).calendar.calendarOverlay.position()}catch(f){}}).delay(200)}}},clickMetaShowPrices:function(d){if(!ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.setErrorStyling(new Event(d).target);return}var a=document.getElement(".cr_lb_overlay");if(a&&a.overlay){a.overlay.hide()}var b=ta.id("CHECK_RATE");var c="meta_inline_checkrates";var g=ta.id("MetaPricesTab");if(g){var f=g.className.match(/locId_(\d+)/)[1];var e=new ta.commerce.CheckRatesData({type:c,evnt:d},f,f,true);if(e.validateDates()){if(ta.retrieve("meta.trackShowPriceButton")){ta.trackEventOnPage("DATEPICKER","SearchButton","");ta.store("meta.trackShowPriceButton",false)}if(ta.isDisablePriceTabAutoToggle()||ta.retrieve("suppressInlineToggle")){if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}ta.commerce.checkrates.updateCRForm("_imt");ta.commerce.meta.updateInlineMeta(f,d);ta.store("suppressInlineToggle",false)}else{ta.commerce.meta.toggleTab(g,d)}}}},loadInlineMeta:function(c,b){var a="lb_allProviders";if(ta.has("meta.isHackathonBC")){a="lb_allProviders_bc_meta"}if(ta.has("checkrates.mini_meta_by_percent_cpc")){ta.store("checkrates.mini_meta_by_percent_cpc_see_all_click",false)}new Request({url:ta.commerce.checkrates.buildMetaHacUrl_allProviders(b,false,a,true,"QC_Meta_Inline"),onSuccess:function(e,f){if(ta.has("meta.isHackathonBC")&&e.contains("hacMiniComplete")){ta.commerce.checkrates.showHideXSellCarousel(e)}var d=ta.id("MetaRatesContent");if(!d){return}e=ta.commerce.checkrates._setCollapseExpand(c,e);d.innerHTML=e;ta.commerce.checkrates.metaTimeout=setTimeout(function(){var h=c.getVendorSet().getAllVendorIds();var g=c.getVendorSet().getCheckedVendor();ta.commerce.checkrates.metaHacRequest(c,h,g,null,true,0,a)},10)},evalScripts:true}).send()},showLowestPriceCTA:function(g){var b=(g)?"metaLowestPriceCTAInline":"metaLowestPriceCTA";if(ta.has(b)){var f=true;if(g){var j=document.getElement(".meta_rates_content");f=j&&j.style.display=="block"}if(f){var c=ta.retrieve(b);if(c.hasOwnProperty("idx")){var h=(g)?"Meta_LP_CTA_Display_Inline":"Meta_LP_CTA_Display";var e=(c.idx==0)?"Not_Displayed":"Displayed";var i=c.idx+"";ta.trackEventOnPage(h,e,i)}var d=(g)?"LP_CTA_INLINE":"LP_CTA";var a=ta.id(d);if(a){(function(){a.fade("in")}).delay(1000)}}}},enterDatesClick:function(b,c){var a=ta.id("CHECK_RATE");var d="meta_inline_checkrates";var f=a.className.match(/id_(\d+)/)[1];var e=new ta.commerce.CheckRatesData({type:d,evnt:b},f,f,true);document.write("ENTER DATES CLICK");if(ta.commerce.meta.validateInlineMetaDates(e)){ta.commerce.meta.toggleTab(ta.id("MetaPricesTab"))}},validateInlineMetaDates:function(b){if(ta.has("metaDatePickerEnabled")){return true}var f=b.vendorSetId;var d=ta.id("checkIn_"+f+"_imt");var h=ta.id("checkOut_"+f+"_imt");var i=false;var a=ta.id("HotelDateSearch_imt");if(!a||!d||!h||!d.value||!h.value){return true}var c=b.parseDate(d.value);var g=b.parseDate(h.value);ta.commerce.meta.clearErrors(f,"_imt");ta.commerce.meta.hideInfo(a);var e=b.dateErrorCheck(c);if(e){ta.commerce.meta.showErrors(e,d,a);i=true}e=b.dateErrorCheck(g);if(e){ta.commerce.meta.showErrors(e,h,a);i=true}if(c&&g&&(g.getTime()<=c.getTime())){e=js_0003;ta.commerce.meta.showErrors(e,[h,d],a);i=true}b.clearErrors(ta.id("checkIn_"+f),ta.id("checkOut_"+f));b.hideInfo();return !i},showErrors:function(g,b,f){var a=[];if(!ta.retrieve("ta.commerce.CheckRatesData.cssAsset")){ta.store("ta.commerce.CheckRatesData.cssAsset",Asset.css(CDNHOST+"/css2/common/validation_error.css"))}if(b instanceof Array&&b.constructor==Array){a=b}else{a.push(b)}for(var e=0;e<a.length;e++){var d=a[e];if(d){d.addClass("errorInput");var c=ta.id("lbl_"+d.id);if(c){c.addClass("errorLabel")}}}ta.commerce.meta.showInfo(g,f)},clearErrors:function(f,c){var a=ta.id("checkIn_"+f+c);var d=ta.id("checkOut_"+f+c);if(!a){return false}var b=ta.id("lbl_"+a.id);var e=ta.id("lbl_"+d.id);if(a){a.removeClass("errorInput")}if(d){d.removeClass("errorInput")}if(b){b.removeClass("errorLabel")}if(e){e.removeClass("errorLabel")}},showInfo:function(c,a){var b=a.getElement("span.error_msg");if(b){b.addClass("errorSpan");b.setContent(c).show()}},hideInfo:function(a){var b=a.getElement("span.error_msg");if(b){b.hide();b.removeClass("errorSpan")}},changeMetaDates:function(c,b){var a=ta.id("META_HAC_DATE_SELECTOR_imt");if(a){a.setStyle("display","block")}b.destroy()},hideMetaDates:function(){var a=document.getElement("#META_HAC_ROOM_LIST_INLINE .headerReplace");if(a){var b=document.getElement("#META_HAC_ROOM_LIST_INLINE .roomDisplayAndChange");b.innerHTML=a.innerHTML;a.destroy()}},chevronHover:function(e,c,b,d){if(c){b=b||"sprite-bookBtnOrangeIdleSmallOver";d=d||"sprite-bookBtnOrangeIdleSmall";var a=ta.id(c).getElement("."+d);if(a){a.removeClass(d);a.addClass(b)}}},chevronBlur:function(e,c,b,d){if(c){b=b||"sprite-bookBtnOrangeIdleSmallOver";d=d||"sprite-bookBtnOrangeIdleSmall";var a=ta.id(c).getElement("."+b);if(a){a.removeClass(b);a.addClass(d)}}},hoverTopOffer:function(){var a=document.getElement(".rgba_gray_arrow_up");if(a){a.removeClass("rgba_gray_arrow_up");a.addClass("rgba_yellow_arrow_up")}},blurTopOffer:function(){var a=document.getElement(".rgba_yellow_arrow_up");if(a){a.removeClass("rgba_yellow_arrow_up");a.addClass("rgba_gray_arrow_up")}},hoverBookBtn:function(a){var a=ta.id(a);if(a.hasClass("sprite-bookBtnOrangeIdle")){a.removeClass("sprite-bookBtnOrangeIdle");a.addClass("sprite-bookBtnOrangeOver")}if(a.hasClass("sprite-bookBtnGreyIdle")){a.removeClass("sprite-bookBtnGreyIdle");a.addClass("sprite-bookBtnGreyOver")}if(a.hasClass("sprite-bookIdle")){a.removeClass("sprite-bookIdle");a.addClass("sprite-bookOver")}if(a.hasClass("sprite-goIdle")){a.removeClass("sprite-goIdle");a.addClass("sprite-goOver")}if(a.hasClass("sprite-selectIdle")){a.removeClass("sprite-selectIdle");a.addClass("sprite-selectOver")}if(a.hasClass("sprite-bookSmallIdle")){a.removeClass("sprite-bookSmallIdle");a.addClass("sprite-bookSmallOver")}if(a.hasClass("sprite-goSmallIdle")){a.removeClass("sprite-goSmallIdle");a.addClass("sprite-goSmallOver")}if(a.hasClass("sprite-selectSmallIdle")){a.removeClass("sprite-selectSmallIdle");a.addClass("sprite-selectSmallOver")}if(a.hasClass("sprite-goBtnGrey")){a.removeClass("sprite-goBtnGrey");a.addClass("sprite-goBtnGreyOver")}if(a.hasClass("sprite-goBtnOrange")){a.removeClass("sprite-goBtnOrange");a.addClass("sprite-goBtnOrangeOver")}if(a.hasClass("sprite-chevronOrangeIdle35")){a.removeClass("sprite-chevronOrangeIdle35");a.addClass("sprite-chevronOrangeOver35")}if(a.hasClass("sprite-chevronGreyIdle27")){a.removeClass("sprite-chevronGreyIdle27");a.addClass("sprite-chevronGreyOver27")}if(a.hasClass("sprite-chevronIdle_ylw")){a.removeClass("sprite-chevronIdle_ylw");a.addClass("sprite-chevronHover_ylw")}},blurBookBtn:function(a){var a=ta.id(a);if(a.hasClass("sprite-bookBtnOrangeOver")){a.removeClass("sprite-bookBtnOrangeOver");a.addClass("sprite-bookBtnOrangeIdle")}if(a.hasClass("sprite-bookBtnGreyOver")){a.removeClass("sprite-bookBtnGreyOver");a.addClass("sprite-bookBtnGreyIdle")}if(a.hasClass("sprite-bookOver")){a.removeClass("sprite-bookOver");a.addClass("sprite-bookIdle")}if(a.hasClass("sprite-goOver")){a.removeClass("sprite-goOver");a.addClass("sprite-goIdle")}if(a.hasClass("sprite-selectOver")){a.removeClass("sprite-selectOver");a.addClass("sprite-selectIdle")}if(a.hasClass("sprite-bookSmallOver")){a.removeClass("sprite-bookSmallOver");a.addClass("sprite-bookSmallIdle")}if(a.hasClass("sprite-goSmallOver")){a.removeClass("sprite-goSmallOver");a.addClass("sprite-goSmallIdle")}if(a.hasClass("sprite-selectSmallOver")){a.removeClass("sprite-selectSmallOver");a.addClass("sprite-selectSmallIdle")}if(a.hasClass("sprite-goBtnGreyOver")){a.removeClass("sprite-goBtnGreyOver");a.addClass("sprite-goBtnGrey")}if(a.hasClass("sprite-goBtnOrangeOver")){a.removeClass("sprite-goBtnOrangeOver");a.addClass("sprite-goBtnOrange")}if(a.hasClass("sprite-chevronOrangeOver35")){a.removeClass("sprite-chevronOrangeOver35");a.addClass("sprite-chevronOrangeIdle35")}if(a.hasClass("sprite-chevronGreyOver27")){a.removeClass("sprite-chevronGreyOver27");a.addClass("sprite-chevronGreyIdle27")}if(a.hasClass("sprite-chevronHover_ylw")){a.removeClass("sprite-chevronHover_ylw");a.addClass("sprite-chevronIdle_ylw")}},hoverSmallBookBtn:function(b){var a=ta.id(b).getElement(".bookBtn");if(a==null){return}if(a.hasClass("sprite-bookBtnOrangeIdleSmall")){a.removeClass("sprite-bookBtnOrangeIdleSmall");a.addClass("sprite-bookBtnOrangeIdleSmallOver")}if(a.hasClass("sprite-bookSmallIdle")){a.removeClass("sprite-bookSmallIdle");a.addClass("sprite-bookSmallOver")}if(a.hasClass("sprite-goSmallIdle")){a.removeClass("sprite-goSmallIdle");a.addClass("sprite-goSmallOver")}if(a.hasClass("sprite-selectSmallIdle")){a.removeClass("sprite-selectSmallIdle");a.addClass("sprite-selectSmallOver")}},blurSmallBookBtn:function(b){var a=ta.id(b).getElement(".bookBtn");if(a==null){return}if(a.hasClass("sprite-bookBtnOrangeIdleSmallOver")){a.removeClass("sprite-bookBtnOrangeIdleSmallOver");a.addClass("sprite-bookBtnOrangeIdleSmall")}if(a.hasClass("sprite-bookSmallOver")){a.removeClass("sprite-bookSmallOver");a.addClass("sprite-bookSmallIdle")}if(a.hasClass("sprite-goSmallOver")){a.removeClass("sprite-goSmallOver");a.addClass("sprite-goSmallIdle")}if(a.hasClass("sprite-selectSmallOver")){a.removeClass("sprite-selectSmallOver");a.addClass("sprite-selectSmallIdle")}},providerHoverOn:function(b,h,g){var f=ta.id(b);f.addClass("partnerHvr");var a=f.getElement(".price_overlay");if(a){var e=f.getElement(".perNight");var d=e.getCoordinates().width+29;a.addClass("show");if(ta.util.i18n.isRtl()){a.setStyles({position:"absolute",left:d,zindex:"101"})}else{a.setStyles({position:"absolute",right:d,zindex:"101"})}}var c=b.getElement(".bookBtn");if(c){ta.commerce.meta.hoverBookBtn(c)}ta.store("meta.hoverProvider",h);ta.store("meta.hoverProviderPosn",g)},providerHoverOff:function(b,c){var e=ta.id(b);e.removeClass("partnerHvr");var a=e.getElement(".price_overlay");if(a){a.removeClass("show")}var d=b.getElement(".bookBtn");if(d){ta.commerce.meta.blurBookBtn(d)}ta.remove("meta.hoverProvider")},restoreProviderHover:function(){var a=ta.retrieve("meta.hoverProvider");var e=ta.retrieve("meta.hoverProviderPosn");if(a&&e){var d=ta.id("PROVIDER_BLOCK");if(d){var c=d.getElements(".metaProvider");var b=d.getElement(".provider_"+a);if(c&&b&&b.hasClass("order_"+e)){c.each(function(f){ta.commerce.meta.providerHoverOff(f)});ta.commerce.meta.providerHoverOn(b,a,e)}}}},updateNavArea:function(a){var b=ta.retrieve("ta.meta.navArea");if(!b||b.indexOf(a)<0){ta.store("ta.meta.navArea",a)}},getNavAreaContextFromDom:function(b,a){b=ta.id(b);if(b.getParent(".persistentCR")){return(a)?"|PCR":"PCR"}else{if(b.getParent(".photosOverlay")){return(a)?"|Photo_Lightbox":"Photo_Lightbox"}else{if(b.getParent(".amenities_lightbox")){return(a)?"|Amenities_Lightbox":"Amenities_Lightbox"}else{if(b.getParent("#CHECK_RATES_LB")){return(a)?"|Photo_LB":"Photo_LB"}else{return}}}}},updateNavAreaFromParts:function(b,a,c){b=b?b:"";a=a?a:"";c=c?c:"";var d=[b,a,c].join("|").replace("||","|").replace(/(\|$)/g,"");ta.commerce.meta.updateNavArea(d)},updateNavAreaMini:function(b,c,a){c=ta.id(c);var d=ta.commerce.meta.getNavAreaContextFromDom(c);d=d?"|"+d:"";ta.commerce.meta.updateNavAreaFromParts(b,d,a)},updateNavAreaMiniLPChevron:function(b){var d=document.getElementById("LOC_PHOTOS");var a=document.getElementById("AMENITY_LIGHTBOX");var c=document.getElementById("PERSISTENT_CHECK_RATES");if(d){ta.commerce.meta.updateNavArea(b+"|Photo_Lightbox|LP_Chevron")}else{if(a){ta.commerce.meta.updateNavArea(b+"|Amenities_Lightbox|LP_Chevron")}else{if(c){ta.commerce.meta.updateNavArea(b+"|PCR|LP_Chevron")}else{ta.commerce.meta.updateNavArea(b+"|LP_Chevron")}}}},loadBestPriceXsell:function(s,v,g,f){try{if(ta.retrieve("checkrates.one_second_xsell")!=true){return}var u=g&&g.isInline;var r=g&&g.isModalPrefetch;var o="";var h="";var w=false;var b=false;if(g&&g.isMetaLeaveBehind){w=true;o="leavebehind";if(g.openedVendors){h=g.openedVendors}}if(g&&g.isMetaLbV2){b=true;o="metalbv2";if(g.openedVendors){h=g.openedVendors}}var t=1000;var a="loadBestPriceXsell_numTries";var j="loadBestPriceXsell_curCancelKey";if(u){a="loadBestPriceXsellInline_numTries";j="loadBestPriceXsellInline_curCancelKey"}var B="meta.xsellTravelData";if(u){B="meta.xsellTravelDataInline"}var k=ta.retrieve(B);if(f==null){f=new Date().getTime();ta.store(a,0);k=ta.commerce.checkrates.getTravelDataFromDOM();ta.store(B,k);var l=ta.id(v);if(l&&!w&&!b){l.innerHTML="";l.setStyle("height",0);l.setStyle("opacity","0");var q=ta.retrieve("metaCheckRatesOverlay");q=ta.id(q);if(!u&&q&&q.container&&q.container.getPosition){window.scrollTo(0,q.container.getPosition().y)}}if(u){ta.store("stateoptModal.prefetch",false);ta.commerce.meta.metaInYourMeta_resetInline()}else{ta.commerce.meta.metaInYourMeta_resetLB()}}var i="loadBestPriceXsell_"+f+"_cancel";if(u){i="loadBestPriceXsellInline_"+f+"_cancel"}if(ta.retrieve(i)){return}if(ta.has(j)){var A=ta.retrieve(j);if(A!=i){ta.store(A,true)}}if(!ta.has(i)){ta.store(i,false);ta.store(j,i)}var m=ta.retrieve(a);var D=m+1;ta.store(a,D);if(!k||!k.adults||!k.inDay||!k.outDay||!k.sInMonthYear||!k.sOutMonthYear){return}var C="";if(typeof(pageServlet)!=undefined&&pageServlet){C=pageServlet}var n={detail:s,adults:k.adults,inMonth:k.sInMonthYear[0]+" "+k.sInMonthYear[1],inDay:k.inDay,outMonth:k.sOutMonthYear[0]+" "+k.sOutMonthYear[1],outDay:k.outDay,"try":ta.retrieve(a),reqNum:g.secondTry?"2":"1",type:o,isInlineRequest:u?"1":"0",openedVendors:h,origServlet:C};var d=Object.toQueryString(n);if(!d||!d.trim()){ta.util.error.record(null,"ta.commerce.meta.loadBestPriceXsell  - toQueryString failure",null,n);return}var c=ta.retrieve("ta.meta.navArea");var p;try{p=ta.commerce.meta.tracking.setTimingForNavArea(c)}catch(z){ta.util.error.record(z,"problem locking timing in ta.commerce.meta.loadBestPriceXsell")}if(p){n.metaRequestTiming=p}if(ta.commerce.meta.tracking.hasAnySuppressedAreas()){var y=ta.commerce.meta.tracking.getSuppressedAreasAsString();if(y){n.suppressImpressionsOnComplete=y}}if(r){ta.store("modalPrefetchOutstanding",true)}new Request({url:"/MetaBestPriceCrossSellAjax?"+d,evalScripts:true,onSuccess:function(F,H){if(r){ta.store("modalPrefetchOutstanding",false)}if(ta.retrieve(i)){return}var E=F.contains("xsellHacStatusReady")||F.contains("xsellHacStatusSOL")||g.secondTry;if(w||b){E=E&&(F.contains("hacComplete")||g.secondTry)}if(!E){setTimeout(function(){XsellOptions={secondTry:true,xsell:true,isInline:u,isMetaLeaveBehind:w,isModalPrefetch:r,isHrRedesignTest:false,isMetaLbV2:b,openedVendors:h};ta.commerce.meta.loadBestPriceXsell(s,v,XsellOptions,f)},t)}else{var G=ta.id(v);if(G){if(w||b){G.setStyle("height",311);G.setStyle("overflow","hidden")}else{if(!r){G.setStyle("height",0);G.setStyle("opacity","0")}}G.innerHTML=F;if(w||b){var e=ta.retrieve("metaLeaveBehindOverlay");if(e&&!ta.id("META_PRICE_XSELL")&&!ta.id("MAYBE_BUTTONS")&&!ta.id("META_PRICE_XSELL_NOT_AVAIL")){e.fireEvent("onClose",e);e.hide()}else{var I=ta.id("META_LEAVE_BEHIND");if(!I){I=ta.id("META_LEAVE_BEHIND_NOT_AVAIL")}ta.commerce.meta.revealBestPriceXsell(G,I,u,(w|b))}}else{ta.commerce.meta.metaInYourMeta(v,{xsell:true,inline:u,isModalPrefetch:r})}}ta.store(a,0)}},onFailure:function(){ta.store(a,0);if(r){ta.store("modalPrefetchOutstanding",false)}ta.util.error.record(null,"ta.commerce.meta.loadBestPriceXsell - MetaBestPriceCrossSellAjax request failed")}}).send()}catch(z){ta.util.error.record(z,"ta.commerce.meta.loadBestPriceXsell")}},loadGeoCrAutoBroadenContents:function(g,i){var o=5;var f=1000;var d=3;var c="QC_Meta_Mini|GeoCheckRatesLightBox";try{var a=function(){j=false};var m=function(){g.fireEvent("close",g);g.hide()};var j=true;var l=ta.id(g.inner);if(!l){throw new Exception("Cannot find parent: "+g)}var p=ta.commerce.meta.tracking.setTimingForNavArea(c);g.addEvent("close",a);var n={d:i,area:c,metaRequestTiming:p};var h=0;var b=function(){if(!j){return}++h;n.attempt=h;new Request({url:"/GeoCrAutoBroadenAjax",data:n,method:"get",evalScripts:true,onSuccess:function(q,t){try{if(!j){return}var r=Elements.from(q,true);var s=r.getElement(".progress").filter(function(e){return e})[0];if(!s){ta.util.error.record(null,"geo check rate malform response missing progress",null,n);m()}else{if(/\btourismUrl-(\S+)\b/.exec(s.className)){var u=RegExp.$1;ta.setEvtCookie("GeoCheckRatesLightBox","unload","Redirect",0,"/Tourism");document.location.href=u}else{l.setStyles({overflow:"hidden",height:520});l.innerHTML="";l.adopt(r);if(!s.hasClass("isHacComplete")&&h<o){setTimeout(b,f)}}}}catch(v){ta.util.error.record(v,"cannot process geo check rate response",null,n);m()}},onFailure:function(){ta.util.error.record(null,"geo check rate request failed",null,n);m()}}).send()};b()}catch(k){ta.util.error.record(k,"cannot send geo check rate initial request");if(m){m()}}},xSellResponses:{lb_hac:false,lb_xsell:false,inline_hac:false,inline_xsell:false},metaInYourMeta_resetLB:function(){ta.commerce.meta.xSellResponses.lb_hac=false;ta.commerce.meta.xSellResponses.lb_xsell=false},metaInYourMeta_resetInline:function(){ta.commerce.meta.xSellResponses.inline_hac=false;ta.commerce.meta.xSellResponses.inline_xsell=false},hacIsBlockingXSell:function(a){var b=ta.commerce.meta.xSellResponses;if(a){return b.inline_xsell}else{return b.lb_xsell}},metaInYourMeta_renderToDiv:function(e,c,l){if(ta.retrieve("stateopt_modal_test")){l=true}var k="STATE_OPT_RESPONSE";var h="MAYBE_BUTTONS";var g="MAYBE_ROWS";var i="CHANGE_DATES";if(c){k+="_INLINE";h+="_INLINE";g+="_INLINE";i+="_INLINE"}var f=ta.id(e);var d=ta.id(k);var b=ta.id(h);var a=ta.id(g);var j=ta.id(i);if(!f||!j||!d){ta.util.error.record(null,"One or more State Opt LB elements is null");return}j.dispose();if(!l&&a){d.getElement(".stepIdentifier").innerHTML="2";a.dispose();a.inject(f.getElement(".noavailHeader"),"after");a.removeClass("hidden")}else{if(b){b.dispose();b.inject(f,"bottom");b.removeClass("hidden")}else{j.getElement(".stepIdentifier").innerHTML="2"}}j.inject(f,"bottom");j.removeClass("hidden")},metaInYourMeta:function(e,n){var c=n&&n.inline;var j=n&&n.isModalPrefetch;var b=n&&n.xsell;var h=ta.commerce.meta.xSellResponses;if(c){if(b){h.inline_xsell=true}else{h.inline_hac=true}}else{if(b){h.lb_xsell=true}else{h.lb_hac=true}}if((c&&h.inline_xsell&&h.inline_hac)||(!c&&h.lb_xsell&&h.lb_hac)||j){var l=ta.id("META_PRICE_XSELL");var k=ta.id("STATE_OPT_RESPONSE");if(c){l=ta.id("META_PRICE_XSELL_INLINE");k=ta.id("STATE_OPT_RESPONSE_INLINE")}if(l&&l.hasClass&&!l.hasClass("hidden")){return}if(k&&k.hasClass&&!k.hasClass("hidden")){return}var m=l;var d=false;var g=ta.commerce.checkrates.getMetaPricesCount(c);if(g==null){g=0}if(g<1&&k){m=k;d="metaCheckRatesUpdateDiv";if(c){d="metaCheckRatesUpdateDivInline"}}var i=ta.id(e);if(i){if(m){ta.commerce.meta.revealBestPriceXsell(i,m,c,false,d,j)}else{var a="lA";if(c){a=a+"_Inline"}var f=ta.id(a);if(f&&f.removeClass){f.removeClass("hidden")}}}}},revealBestPriceXsell:function(a,d,m,p,h,k){if(a){a=ta.id(a)}if(d){d=ta.id(d)}if(!a||!d){ta.util.error.record(null,"revealBestPriceXsell - required elements missing");return}if(d.removeClass){d.removeClass("hidden")}var l=new Fx.Tween(a,{property:"opacity"});if(p){var q=ta.retrieve("metaLeaveBehindOverlay");if(q&&q.container){var n=q.container;if(n.hasClass&&n.hasClass("hidden")&&n.removeClass){n.removeClass("hidden")}ta.commerce.checkrates.removePCR()}}else{var j="META_MINI_META_MAYBE";if(m){j="META_MINI_META_MAYBE_INLINE"}var b=ta.id(j);var e=true;if(b){e=false}if(h){ta.commerce.meta.metaInYourMeta_renderToDiv(d,m,e)}if(!k){var o="Displayed_Lightbox";if(m){o="Displayed_Inline"}var c=d.getElements(".hotelListing").length;if(c==0){c="0";o="Not_"+o}ta.trackEventOnPage("Meta_State-Optimized_XSell",o,c)}}var g=d.getSize().y;var f=new Fx.Tween(a,{property:"height",onComplete:function(){if(!p){l.start(0,1)}}});if(h&&ta.has(h)){var i=ta.id(ta.retrieve(h));if(i&&i.addClass){i.addClass("hidden")}}if(k){ta.commerce.meta.openStateoptModal("prefetch")}f.start(g);var r=ta.retrieve("metaCheckRatesOverlay");if(r&&r.container&&r.closeBtn&&ta.id(window).getScroll().y>r.container.getPosition().y){r.closeBtn.scrollIntoView()}},openStateoptModal:function(b,g){try{if(!b){b="click"}ta.store("stateoptModal."+b,true);var a=ta.retrieve("stateoptModal.prefetch");var f=ta.retrieve("stateoptModal.click");if(a&&f){var d=ta.id("MetaRatesContent");if(d&&d.innerHTML){if(!ta.has("metaCheckRatesCSS")){ta.store("metaCheckRatesCSS",new Asset.css(metaCheckRatesCSS))}ta.commerce.meta.toggleTab(ta.id("ReviewsTab"));ta.run("ta.overlays.Factory.precookedMetaLB",{},d);ta.store("stateoptModal.click",false)}else{ta.util.error.record(null,"openStateoptModal - missing MetaRatesContent")}}else{if(f&&!a&&!ta.retrieve("modalPrefetchOutstanding")){if(g){ta.commerce.meta.loadBestPriceXsell(g,"REC_CONT_INLINE",{xsell:true,isInline:true,isModalPrefetch:true})}else{ta.util.error.record(null,"openStateoptModal - missing locId")}}}}catch(c){ta.util.error.record(c,"openStateoptModal")}},closeStateoptModal:function(){var a=document.getElement(".stateoptModal .roundOuterClose");if(a){if(ta.id("MetaPricesTab")){ta.commerce.meta.toggleTab(ta.id("MetaPricesTab"))}a.click()}},replaceAFWithMetaAF:function(d){try{ta.store("checkrates.meta_progressive_avaf_executed",true);var b=new Element("div",{styles:{},html:d});b.inject(document.body);var g=b.getElementById("PROGRESSIVE_META");if(g){var c=g.getElements(".prog");if(!c){return}var a=ta.id("ALSO_VIEWED_LIST");if(!a){return}a.removeClass("oldVer");a.addClass("metaMicro");c.each(function(i,h){var j=i.id.match(/avaf_meta_id_(\d+)/)[1];var e=ta.id("avaf_id_"+j);if(e){i.clone(true,true).replaces(e)}});b.dispose()}}catch(f){ta.util.error.record(f,"ta.commerce.meta.replaceAFWithMetaAF")}},loadMetaAF:function(f,g,h){try{if(ta.retrieve("checkrates.meta_af")!=true){return}var c="meta_af_last_request";var b=new Date().getTime();ta.store(c,b);var d=1000;var k=ta.commerce.checkrates.getTravelDataFromDOM();if(!k||!k.adults||!k.inDay||!k.outDay||!k.sInMonthYear||!k.sOutMonthYear){return}var j={detail:f,adults:k.adults,inMonth:k.sInMonthYear[0]+" "+k.sInMonthYear[1],inDay:k.inDay,outMonth:k.sOutMonthYear[0]+" "+k.sOutMonthYear[1],outDay:k.outDay,reqNum:h?"2":"1",type:"af"};var a=Object.toQueryString(j);if(!a||!a.trim()){ta.util.error.record(null,"ta.commerce.meta.loadMetaAF - toQueryString failure",null,j);return}new Request({url:"/MetaBestPriceCrossSellAjax",data:j,evalScripts:true,onSuccess:function(o,r){if(ta.retrieve(c)!=b){return}var n=o.contains("xsellHacStatusReady")||o.contains("xsellHacStatusSOL")||h;if(!n){setTimeout(function(){ta.commerce.meta.loadMetaAF(f,g,true)},d)}else{if(ta.has("checkrates.meta_progressive_avaf")&&!ta.has("checkrates.meta_progressive_avaf_executed")){ta.commerce.meta.replaceAFWithMetaAF(o)}else{var q=ta.id(g);if(q){q.setStyle("height",0);q.setStyle("opacity","0");q.innerHTML=o;ta.commerce.checkrates.avafInit();var m=ta.id("ALSO_VIEWED_LIST");if(m){var p=new Fx.Tween(q,{property:"opacity"});var e=m.getSize().y;var l=new Fx.Tween(q,{property:"height",onComplete:function(){q.setStyle("height","auto");p.start(0,1)}});l.start(0,e)}}}if(ta.retrieve("reposition_avaf_gutter")){ta.commerce.meta.repositionGutter()}}},onFailure:function(){ta.util.error.record(null,"ta.commerce.meta.loadMetaAF - MetaBestPriceCrossSellAjax request failed")}}).send()}catch(i){ta.util.error.record(i,"ta.commerce.meta.loadMetaAF")}},updateProvAreaFromLightBox:function(e){var b=ta.retrieve("meta.baseLocationId");if(b&&e==b){var d=ta.retrieve("meta.postShowMetaCR");var c=ta.retrieve("meta.postShowMetaCRLB");var a=ta.retrieve("meta.postShowMetaCRLBPCR");if(d&&c&&a){ta.commerce.meta.updateProvArea(d,c,a);return}}if(ta.widgets.calendar.datesExist()){ta.commerce.checkrates.checkRatesMiniMeta(null,document.getElementById("CHECK_RATE"),b,"checkrates")}},updateProvArea:function(i,m,l){if(m&&m.hasClass("hidden")){m.removeClass("hidden")}if(l&&l.hasClass("hidden")){l.removeClass("hidden")}var e=document.getElement("#CHECK_RATES_CONT.chkRates");var c=document.getElement("#LOC_PHOTOS .chkRates");var f=document.getElement("#AMENITY_LIGHTBOX .chkRates");var g=ta.retrieve("pcr.overlay");var b=document.getElement("#CHECK_RATES_LB .chkRates");var k=document.getElement(".similarCarousel");var j=document.getElement(".premiumTimeout");if(k&&j){var a=e.getElement("div.bc_text_content");if(a){var d=i.getChildren()[1];if(d){var h=d.clone(false);h.innerHTML=d.innerHTML;a.innerHTML="";a.adopt(h)}}}else{ta.commerce.meta.updateCRAreaWithProperMiniMeta(e,i)}ta.commerce.meta.updateCRAreaWithProperMiniMeta(c,l);ta.commerce.meta.updateCRAreaWithProperMiniMeta(f,l);ta.commerce.meta.updateCRAreaWithProperMiniMeta(b,m);ta.commerce.meta.updatePCRAreaWithMiniMeta(g,l);if(ta.has("meta.isHackathonBC")){ta.commerce.meta.alignPriceBlocks();if(ta.has("meta.bc.isRevisedUnavailability")){ta.commerce.meta.truncateProviderNames()}}if(i&&i.getElement(".hacMiniComplete")){ta.commerce.meta.fireGAEvent(i)}},updatePCRAreaWithMiniMeta:function(c,a){if(a==null||c==null){return}var f=c.inner;if(!f){return}ta.commerce.meta.suppressCRArea(f);var d=f.getElement(".postShowMetaCRLBPCR");if(d!=null){d.destroy()}var e=f.getElement("fieldset.miniMetaContainer");var b=a.getElement(".disclaimer");if(b!=null){b.destroy()}ta.commerce.meta.adoptMiniMetaElem(e,a);if(!ta.widgets.calendar.datesInRange()){ta.commerce.meta.showCRArea(f)}},adoptMiniMetaElem:function(c,a){if(c!=null&&(ta.widgets.calendar.datesInRange()||ta.id("COMHVY"))){var d=c.getElement(".disclaimer");if(d!=null&&!d.getParentBySelector("#hover_table_display_area")){d.destroy()}var b=a.clone(false);b.innerHTML=a.innerHTML;c.adopt(b)}else{if(!ta.widgets.calendar.datesInRange()){ta.commerce.meta.showCRArea(c)}}},updateCRAreaWithProperMiniMeta:function(e,a){if(a==null||e==null){}else{ta.commerce.meta.suppressCRArea(e);var b=e.getElement(".metaDatesNotChosen");var d=e.getElement(".metaDatesChosen");if(d&&ta.retrieve("meta.bc.show_title")){if(b){b.addClass("miniMetaHideHdr");b.removeClass("miniMetaShowHdr")}d.addClass("miniMetaShowHdr");d.removeClass("miniMetaHideHdr")}var c=e.getElement(".postShowMetaCR");if(c!=null){c.destroy()}var c=e.getElement(".postShowMetaCRLB");if(c!=null){c.destroy()}var c=e.getElement(".postShowMetaCRLBPCR");if(c!=null){c.destroy()}var f=e.getElement("fieldset");ta.commerce.meta.adoptMiniMetaElem(f,a)}},fireGAEvent:function(d){var a=ta.retrieve("meta.chevronTracking");var c=ta.retrieve("meta.chevronAction");var b=ta.retrieve("meta.chevronLabel");if(a&&c){if(!b){ta.trackEventOnPage(a,c)}else{ta.trackEventOnPage(a,c,b)}}ta.remove("meta.chevronTracking");ta.remove("meta.chevronAction");ta.remove("meta.chevronLabel")},miniMetaAjaxNoTimer:function(a,b){return ta.commerce.meta.miniMetaAjax(a,b,1000)},miniMetaAjax:function(c,e,a){if(c!=null){var f=c.getElement(".hacMiniComplete");if(f!=null){return}}if(e==null){}else{var d=e.getVendorSet().getCheckedContentID();var b=e.getVendorSet().getCheckedVendor();ta.store("ta.commerce.MetaHacOverlay.crData."+e.vendorSetId,e);ta.commerce.checkrates.miniMetaHacRequest(e,d,b)}},suppressCRArea:function(a){var b=a.getElements(".miniMetaShow");Array.each(b,function(c){c.removeClass("miniMetaShow");c.addClass("miniMetaHide");if(ta.id("PERSISTENT_CHECK_RATES_WRAP")&&(ta.retrieve("pcr_redesign_v1")||ta.retrieve("pcr_redesign_v2"))){ta.id("PERSISTENT_CHECK_RATES_WRAP").getElement(".miniMeta").addClass("miniMetaHide")}})},showCRArea:function(a){var c=a.getElement(".postShowMetaCR");if(c!=null){c.destroy()}var b=a.getElements(".miniMetaHide");Array.each(b,function(d){d.removeClass("miniMetaHide");d.addClass("miniMetaShow")})},showCurrencyPicker:function(c,b){var a=document.getElement(".currencies");if(a){c.stop();a.show();document.addEvent("click",ta.commerce.meta.closeCurrencyPicker)}},closeCurrencyPicker:function(b){var a=document.getElement(".currencies");if(a&&!a.containsEvent(b)){b.stop();a.hide();document.removeEvent("click",ta.commerce.meta.closeCurrencyPicker)}},selectCurrency:function(b,d,m,a){try{ta.commerce.meta.clearStoredMiniData();var j=ta.id(b.target);if(!a){if(j&&b.type){if(b.type==="click"){a=j.get("text");var i=j.getParent();if(i){i.hide()}}else{if(b.type==="change"){a=j.value}}}}if(a.test(/[A-Z]{3}/)){ta.store("ta.commerce.MetaHacOverlay.currency",a);new Request({url:"/ActionRecord?action=MetaCurrencyPicker"}).send();ta.trackEventOnPage("MetaCurrencyPicker","selected",a,1);var h=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+m);if(!h){return}if(ta.has("checkrates.meta_ui_sk_box")||ta.has("checkrates.meta_ui_sk_box_v3")){var c=ta.id("PROVIDER_BLOCK");if(!c){c=ta.id("PROVIDER_BLOCK_INLINE")}if(!c){return}var l=c.get("html");var g='<img class="provLoading" src="'+CDNHOST+'/img2/meta_sprites/loadingAnim.gif">';c.getElements(".rightBox").each(function(e){e.setContent(g)});var f=h.getVendorSet().getAllVendorIds();var n=h.getVendorSet().getCheckedVendor();new Request({url:ta.commerce.checkrates.buildMetaHacUrl(h,f,n,true),onSuccess:function(e){c.setContent(e);ta.commerce.meta.storeMiniData(c);if(c.id=="PROVIDER_BLOCK_INLINE"){ta.commerce.meta.updateProvAreaFromLightBox(h.vendorSetId)}if(ta.retrieve("hotels.redesignEnabled")){ta.store("hotels.datesChanged",true)}var o=document.getElement(".selectedCurrency");if(o){o.set("text",a)}},onFailure:function(){c.setContent(l)}}).send()}else{if(ta.id("META_UI_AVAIL_SECTIONS")){ta.commerce.checkrates.displayVendors(h)}}}}catch(k){ta.util.error.record(null,"ta.commerce.meta.selectedCurrency")}},tryAnotherHotelClick:function(){var a=document.getElement(".metaCheckRatesOverlay .roundOuterClose");if(a){a.click()}},clearStoredMiniData:function(){if(ta.retrieve("checkrates.meta_ui_post_click_prices")){ta.store("meta.postShowMetaCRLBPCR",null);ta.store("meta.postShowMetaCR",null);ta.store("meta.postShowMetaCRLB",null)}},storeMiniData:function(b){if(ta.retrieve("checkrates.meta_ui_post_click_prices")){var d=b.getElement(".postShowMetaCR");var a=b.getElement(".postShowMetaCRLBPCR");var c=b.getElement(".postShowMetaCRLB");if(d&&c&&a){ta.store("meta.postShowMetaCRLBPCR",a);ta.store("meta.postShowMetaCR",d);ta.store("meta.postShowMetaCRLB",c)}}},prePriceProviderClicked:function(a){if(a){ta.trackEventOnPage("DATEPICKER","OPEN","provider_link",a);ta.store("meta.datepicker_tracked",true)}},providerButtonClicked:function(a){if(a&&!ta.has("hotels.hasTimeoutDates")){ta.trackEventOnPage("DATEPICKER","OPEN","provider_logo",a);ta.store("meta.datepicker_tracked",true)}},moreSitesLinkClicked:function(a){if(a&&!ta.has("hotels.hasTimeoutDates")){ta.trackEventOnPage("DATEPICKER","OPEN","more_sites_link",a);ta.store("meta.datepicker_tracked",true)}},buildMetaHacParamObj:function(){var b={};try{var a=document.getElement("#HAC_FORM input[name=geo]");if(a&&a.value){b.geo=a.value}if(!b.geo){var h=document.getElement("#SEARCH_LHN input[name=geo]");if(h){b.geo=h.value}}var i=document.getElementById("searchAll");if(i&&i.value!="true"){var f=ta.widgets.calendar.getPageInDate();if(f){b.inDay=f.getDate();b.inMonth=(f.getMonth()+1)+"/"+f.getFullYear()}var d=ta.widgets.calendar.getPageOutDate();if(d){b.outDay=d.getDate();b.outMonth=(d.getMonth()+1)+"/"+d.getFullYear()}var c=ta.widgets.calendar.getPageAdultsCount();if(c!=2){b.adults=c}b.searchAll="false"}}catch(g){ta.util.error.record(g,"buildHACUrlParams")}return Object.toQueryString(b)},getHACCategory:function(){var b=document.getElements(".tab.selected");var c="1";if(b&&b.length&&b.length>0){var a=b[0].className.match(/cat_(\d+)/);if(a){c=a[1]}}return c},buildHACSearchData:function(){var d=ta.widgets.calendar.getPageInDate();var h=ta.widgets.calendar.getPageOutDate();var i=ta.widgets.calendar.getPageAdultsCount();var g=document.getElementsByName("geo")[0].value;var c=false;var j=ta.commerce.meta._padZero;var f=d?j(d.getDate()):null;var b=h?j(h.getDate()):null;var e=d?j(d.getMonth()+1)+"/"+d.getFullYear():null;var k=h?j(h.getMonth()+1)+"/"+h.getFullYear():null;var a={};a.adults=i;a.geo=g;a.searchAll=c;a.inDateOfMonth=f;a.outDateOfMonth=b;a.inMonthYear=e;a.outMonthYear=k;a.category=ta.commerce.meta.getHACCategory();return a},buildMetaHACUrl:function(){var a=ta.commerce.meta.buildHACSearchData();var b="/HACSearch?adults="+a.adults+"&geo="+a.geo+"&searchAll="+a.searchAll;if(a.category){b=b+"&cat="+a.category}if(a.inDateOfMonth){b=b+"&inDay="+a.inDateOfMonth}if(a.outDateOfMonth){b=b+"&outDay="+a.outDateOfMonth}if(a.inMonthYear){b=b+"&inMonth="+a.inMonthYear}if(a.outMonthYear){b=b+"&outMonth="+a.outMonthYear}var c=b+window.location.hash;return c},redirectHACSearch:function(){ta.setEvtCookie("Mini_meta_LP_chevron_display","Clicked","Unavailable","","/HACSearch");window.location=ta.commerce.meta.buildMetaHACUrl()},_padZero:function(a){return String("0"+a).slice(-2)},anchorToOpenTab:function(){if(ta.id("ReviewsTab").hasClass("selected")){ta.commerce.meta.scrollToReviews()}else{if(ta.id("MetaPricesTab").hasClass("selected")){var a=ta.id("ReviewsTab");a.click();ta.commerce.meta.scrollToReviews()}}},scrollToReviews:function(){var a=ta.id("REVIEWS");if(a!=null){a.scrollIntoView(true)}else{ta.util.error.record(null,"couldnt find reviews element on page!")}},getTravelInfo:function(){try{var b=ta.widgets.calendar.getPageInDate();var f=ta.widgets.calendar.getPageOutDate();var i=b.getDate();var j=b.getMonth()+1;var h=b.getFullYear();var c=f.getDate();var g=f.getMonth()+1;var a=f.getFullYear()}catch(d){ta.util.error.record(d,"no travel info")}},multiLocMicroMetaReq:function(q,h){var e="multiLocMicroMetaReq_curCancelKey";var a=13;if(!ta.widgets.calendar.hasPageDates()){return}q=q||new Date().getTime();var f="multiLocMicroMetaReq_"+q+"_cancel";var o=true;if(h==null){o=false;h=1;ta.commerce.meta._clearMultiLocMicroMetaPrices()}else{if(ta.retrieve(f)==true){return}}if(ta.has(e)){var s=ta.retrieve(e);if(s!=f){ta.store(s,true);ta.commerce.meta.polling.removePollingInfoForRequest(s)}}if(!ta.has(f)){ta.store(f,false);ta.store(e,f)}var p=$$("#HACKATHON_RELATED_HOTELS .show_flyout");if(!p){return}var l=[];var i={};p.each(function(u){var v=u.get("data-locid");l.push(v);i[v]=u});var r=ta.widgets.calendar.getPageInDate();var t=ta.widgets.calendar.getPageOutDate();var d=r.getDate();var j=r.getMonth()+1;var m=r.getFullYear();var b=t.getDate();var g=t.getMonth()+1;var n=t.getFullYear();var c=l.join(" ");var k={inDay:d,inMonth:j,inYear:m,outDay:b,outMonth:g,outYear:n,locations:c,finalRequest:o};if(!ta.commerce.meta.polling.isRequestBeingPolled(f)){ta.commerce.meta.polling.setPollingAttemptForRequest(f,0)}new Request({url:"/MultiLocMicroMetaAjax",data:k,onSuccess:function(w,y){if(ta.retrieve(f)==true){return}if(w.contains("hac_complete")){ta.commerce.meta.polling.removePollingInfoForRequest(f);var v=new Element("div");v.innerHTML=w;var u=v.getElements(".prices");u.each(function(C){var D=C.get("data-locid");var z=i[D];if(z){var B=z.getElement(".pricesOuter");var A=B.getElement(".prices");if(A){C.replaces(A)}else{C.inject(B)}}})}else{if(h<a){ta.commerce.meta.polling.incrementPollingAttemptForRequest(f);setTimeout(function(){ta.commerce.meta.multiLocMicroMetaReq(q,h+1)},ta.commerce.meta.polling.getPollingWaitTimeForRequest(f))}}}}).send()},_clearMultiLocMicroMetaPrices:function(){var a=$$("#HACKATHON_RELATED_HOTELS .show_flyout");if(!a){return}a.each(function(b){var c=b.getElement(".pricesOuter").innerHTML=""})},loadMiniMetaCrossSell:function(h,i,j,d){try{if(!(ta.isMetaHotelMBP2013()||ta.isStateOptMiniMeta()||ta.has("metaUI.hrTestComHvy"))){return}var a=ta.id(i);if(!a){return}a.empty();a.addClass("spinner");var f="meta_cs_last_request";var c=new Date().getTime();ta.store(f,c);var g=1000;var m=ta.commerce.checkrates.getTravelDataFromDOM();if(!m||!m.adults||!m.inDay||!m.outDay||!m.sInMonthYear||!m.sOutMonthYear){return}var l={detail:h,adults:m.adults,inMonth:m.sInMonthYear[0]+" "+m.sInMonthYear[1],inDay:m.inDay,outMonth:m.sOutMonthYear[0]+" "+m.sOutMonthYear[1],outDay:m.outDay,reqNum:j?"2":"1",type:"mmcs"};if(ta.isStateOptMiniMeta()){l.type="mini_meta_state_opt"}if(ta.has("metaUI.hrTestComHvy")){l.type="af_hr_test"}var b=Object.toQueryString(l);if(!b||!b.trim()){ta.util.error.record(null,"ta.commerce.meta.loadMiniMetaCrossSell - toQueryString failure",null,l);return}new Request({url:"/MetaBestPriceCrossSellAjax",data:l,evalScripts:true,onSuccess:function(q,s){if(ta.retrieve(f)!=c){return}var o=q.contains("xsellHacStatusReady")||q.contains("xsellHacStatusSOL")||j;if(!o){setTimeout(function(){ta.commerce.meta.loadMiniMetaCrossSell(h,i,true,true)},g);return}else{d=true;var r=ta.id(i);if(r){r.innerHTML=q;r.removeClass("spinner")}}if(d){if(ta.isStateOptMiniMeta()){ta.commerce.meta.showMiniMetaCrossSellCarousel("MMXS_LIST",q)}else{if(ta.has("metaUI.hrTestComHvy")){var n="AV_TGT";var t=ta.id(n);if(t){t.setStyle("height",0);t.setStyle("opacity","0");t.removeClass("hidden");var e=new Fx.Tween(n,{property:"opacity"});var p=new Fx.Tween(n,{property:"height",onComplete:function(){e.start(0,1)}});p.start()}}else{ta.commerce.meta.showMiniMetaCrossSell("MINI_META_CROSS_SELL_NOCOMM")}}}},onFailure:function(){ta.util.error.record(null,"ta.commerce.meta.loadMiniMetaCrossSell - MetaBestPriceCrossSellAjax request failed")}}).send()}catch(k){ta.util.error.record(k,"ta.commerce.meta.loadMiniMetaCrossSell")}},showMiniMetaCrossSellCarousel:function(a,e){if(!e.contains(a)){var d=ta.id("MMSO_SEE_ALL");if(d){d.show()}ta.commerce.meta.trackMiniMetaStateOpt("alt_accom_not_shown");return}var c=document.getElement(".sidebar #AV_ABOVE_FOLD_META");if(c){ta.store("metaUI.hiddenAV",c);c.addClass("hidden")}if(!ta.has("metaUI.aniCarouselJS")){new Asset.javascript(jsAniCarouselAsset);ta.store("metaUI.aniCarouselJS",true)}var f=ta.id(a);if(f){var b=new Fx.Morph(f,{duration:300,wait:true});(function(){window.mmxsGallery=new ta.widgets.AniCarousel({listId:a,animation:b,ctrlsElem:ta.id("CAR_CTRLS"),trackingInfo:{Category:"Mini_meta_State-Optimized",Action:"cross-sell_arrow_clicked"}})}).delay(1000)}ta.commerce.meta.trackMiniMetaStateOpt("alt_accom_displayed")},showMiniMetaCrossSell:function(a){try{var c=ta.id("MINI_META_CROSS_SELL");if(c){c.removeClass("hidden")}var f=ta.id(a);if(f){f.removeClass("hidden")}var b=ta.select(".postShowMetaCR");if(b){b.each(function(e){e.addClass("hidden")})}}catch(d){ta.util.error.record(d,"ta.commerce.meta.showMiniMetaCrossSell")}},hideMiniMetaCrossSell:function(a){try{var c=ta.id("MINI_META_CROSS_SELL");if(c){c.addClass("hidden")}var f=ta.id(a);if(f){f.addClass("hidden")}var b=ta.select(".postShowMetaCR");if(b){b.each(function(e){e.removeClass("hidden")})}}catch(d){ta.util.error.record(d,"ta.commerce.meta.hideMiniMetaCrossSell")}},setupPhotoFlyoutEvents:function(b){if(typeof(b)=="undefined"){return}try{var a=ta.id(b);if(a&&!ta.has("tablet.meta_mbp")){a.addEvent("mouseenter",ta.commerce.meta.showMBPPhotoFlyout);a.addEvent("mouseleave",ta.commerce.meta.hideMBPPhotoFlyout)}}catch(c){ta.util.error.record(c,"ta.commerce.meta.setupPhotoFlyoutEvents")}},showMBPPhotoFlyout:function(){try{ta.store("showMBPPhotoFlyout.displaying",true);if(ta.has("showMBPPhotoFlyout.displayed")&&ta.retrieve("showMBPPhotoFlyout.displayed")==true){return}var i=ta.id("TOP_V_COMM_INFO");var c=ta.id("TOP_V_COMM_TAGLINE");var l=ta.id("TOP_V_COMM_ACCOMM_ID");var k=ta.id("TOP_V_COMM_CONT_ID");var f=ta.id("TOP_V_COMM_DETAILS");if(i&&c&&l&&k&&f){var d=ta.id("COMMERCE_FLYOUT");if(d){d.empty();var g=i.get("text")+" "+c.get("text");var b=new Element("div",{html:"<strong>"+i.get("text")+"</strong>","class":"ppn"});var a=new Element("div",{html:"<span>"+c.get("text")+" "+f.get("text")+"</span>","class":"tagline"});d.adopt(b);d.adopt(a);d.removeEvents("click");d.addEvent("click",function(e){ta.commerce.meta.updateNavArea("QC_Meta_Mini|Photo_Flyout")});d.addEvent("click",function(e){ta.call("ta.commerce.checkrates.openMetaProvider",e,this,l.get("text").toInt(),k.get("text").toInt())});var j=new Fx.Tween(d,{property:"right",duration:"short",onComplete:function(){ta.store("showMBPPhotoFlyout.displayed",true)}});(function(){if(ta.has("showMBPPhotoFlyout.displaying")&&ta.retrieve("showMBPPhotoFlyout.displaying")==true){j.start(-220,0)}}).delay(300)}}}catch(h){ta.util.error.record(h,"ta.commerce.meta.showMBPhotoFlyout")}},hideMBPPhotoFlyout:function(){try{ta.store("showMBPPhotoFlyout.displaying",false);if(!ta.has("showMBPPhotoFlyout.displayed")||ta.retrieve("showMBPPhotoFlyout.displayed")==false){return}var c=ta.id("COMMERCE_FLYOUT");if(c){var a=new Fx.Tween(c,{property:"right",duration:"short",onComplete:function(){ta.store("showMBPPhotoFlyout.displayed",false)}});ta.store("showMBPPhotoFlyout.displayed",false);a.start(0,-220)}}catch(b){ta.util.error.record(b,"ta.commerce.meta.hideMBPhotoFlyout")}},scrollToId:function(a){if(typeof(a)=="undefined"||!a||ta.id(a)==null){return}var b=ta.id(a);if(typeof(b.scrollIntoView)=="function"){b.scrollIntoView()}else{window.location.hash=a}},initNoAvailCarousel:function(){try{var a=ta.id("ALSO_VIEWED_LIST");if(!a){return}var f=a.getElement("ul");if(!f){return}var k=f.getElements("li").length;var i=new Fx.Tween(f,{property:"left"});var b=353;var g=1;var j=a.getElement(".prev");var c=a.getElement(".next");if(!c||!j){return}function h(e){if((g===1&&e<0)||(g===k&&e>0)){return}if(e<0){ta.trackEventOnPage("Pager_Arrows","Scroll_Left","Mini_Carousel_Xsell")}else{if(e>0){ta.trackEventOnPage("Pager_Arrows","Scroll_Right","Mini_Carousel_Xsell")}}g+=e;var n=parseInt(f.getStyle("left"));var l=b*e*-1;var m=n+l;i.start(m);var o=a.getElement(".paginator");if(o){if(g===1&&e<0){className="front"}else{if(g===k&&e>0){className="end"}else{className="middle"}}o.className="paginator "+className}}j.addEvent("click",function(){h(-1)});c.addEvent("click",function(){h(1)})}catch(d){ta.util.error.record(d,"ta.commerce.meta.initNoAvailCarousel")}},showRemainingProviders:function(b,a){a=ta.id(a);var c=a.hasClass("interrupterShowMore");if(a){a.destroy()}if(!c){ta.store("checkrates.hr_bc_see_all_click",true)}if(ta.has("tests.bookingcom")&&ta.tests&&ta.tests.bookingcom){ta.tests.bookingcom.chkHR(true)}if(c){document.getElements(".interrupterHidden").removeClass("interrupterHidden");return}document.getElements(".remaining").removeClass("remaining")},hideStateOptHRNoAvailMsg:function(){var a=document.getElement(".error_msg");if(a){a.hide()}},updateStateOptHRNoAvailErrorMsg:function(b){if(!b){return}var c=ta.retrieve(b);var a=document.getElement(".error_msg");if(c&&a){a.addClass("metaUIStateOptHRError");a.innerHTML=c;a.show()}},showStateOptHRNoAvailUI:function(b){try{if(!b||(b&&!b.contains("metaUIStateOptHR"))){return}if(b.contains("metaUIStateOptInvalidDates")){ta.commerce.meta.updateStateOptHRNoAvailErrorMsg("meta.bc.stateOptInvalidDates");return}if(b.contains("hasDisplayUnavailability")){ta.trackEventOnPage("Mini_meta_LP_chevron_display","Not_Displayed","May_Be_Available")}else{ta.trackEventOnPage("Mini_meta_LP_chevron_display","Not_Displayed","Unavailable")}ta.commerce.meta.updateStateOptHRNoAvailErrorMsg("meta.bc.onlinePricesNotAvailable");var d=ta.retrieve("meta.baseLocationId");var a=ta.id("META_UI_STATE_OPT_ALT_DATES_CONTAINER");if(d&&a){a.removeClass("hidden");ta.commerce.meta.hacAltDates(d,true,null,"MM_ALT_DATES")}}catch(c){ta.util.error.record(c,"ta.commerce.meta.showStateOptHRNoAvailUI")}},loadCarouselXSell:function(t){if(ta.retrieve("unavail_maybe_v1")||ta.retrieve("unavail_maybe_v2")){var f=ta.commerce.checkrates.getTravelDataFromDOM();if(f){var g=f.sInMonthYear[0];var h=f.sInMonthYear[1];var c=f.inDay;var d=f.sOutMonthYear[0];var j=f.sOutMonthYear[1];var b=f.outDay;var q=ta.util.date.create(h,g,c);var s=ta.util.date.create(j,d,b);var k=s-q;var m=1000*60*60*24;var u=Math.floor(k/m);if(u>30){var r=ta.retrieve("meta.bc.noConfirmedAvailabilityWithXSell");var o=document.getElement(".error_msg");if(r&&o){o.show();o.innerHTML=r;var l=document.getElement("#CHECK_RATES_CONT.chkRates .metaDatesChosen");if(l){l.addClass("miniMetaHideHdr");l.removeClass("miniMetaShowHdr")}}}}return}try{ta.commerce.meta.hideCarouselXSell();var a=document.getElement("#CHECK_RATES_CONT div.hacUnavailable");if(a){return}var n=ta.retrieve("meta.baseLocationId");var i=ta.id("CHECK_RATES_CONT");var f=ta.commerce.checkrates.getTravelDataFromDOM();if(!i||!n||!f||!f.adults||!f.inDay||!f.outDay||!f.sInMonthYear||!f.sOutMonthYear){return}new Request({url:"/MetaBestPriceCrossSellAjax",data:{detail:n,adults:f.adults,inMonth:f.sInMonthYear[0]+" "+f.sInMonthYear[1],inDay:f.inDay,outMonth:f.sOutMonthYear[0]+" "+f.sOutMonthYear[1],outDay:f.outDay,reqNum:1,type:"meta_carousel"},method:"GET",evalScripts:true,onSuccess:function(C,E){var z=Elements.from(C);var v=document.getElement(".similarCarousel");if(v){return}var A=document.getElements("#CHECK_RATES_CONT span.price");var y=document.getElements("#CHECK_RATES_CONT div.premium");if((A&&A.length>0)||(y&&y.length>0)){return}if(z){var w=z.filter(".similarCarousel");var D;if(t){if(w){D=ta.retrieve("meta.bc.noConfirmedAvailabilityWithXSell")}else{D=ta.retrieve("meta.bc.noConfirmedAvailability")}}else{if(w){D=ta.retrieve("meta.bc.noAvailabilityWithXSell")}else{D=ta.retrieve("meta.bc.noAvailability")}}var G=document.getElement(".error_msg");if(D&&G){G.show();G.innerHTML=D;var F=document.getElement("#CHECK_RATES_CONT.chkRates .metaDatesNotChosen");var B=document.getElement("#CHECK_RATES_CONT.chkRates .metaDatesChosen");if(F){F.addClass("miniMetaHideHdr");F.removeClass("miniMetaShowHdr")}if(B){B.addClass("miniMetaHideHdr");B.removeClass("miniMetaShowHdr")}}var e=document.getElement("div.premium_offers_area");if(w&&e){setTimeout(function(){var H=document.getElement(".similarCarousel");if(H){return}w.inject(e);ta.commerce.meta.initNoAvailCarousel()},100)}}}}).send()}catch(p){ta.util.error.record(p,"ta.commerce.meta.loadCarouselXSell")}},hideCarouselXSell:function(){var a=document.getElement(".similarCarousel");if(a){a.destroy()}var b=document.getElement(".error_msg");if(b){b.empty()}},alignPriceBlocks:function(){var a=41;var f=document.getElements("#HotelDateSearch .postShowMetaCR .priceBlock");var e=f.length;if(f&&e>1&&f[0]){var c=f[0].getSize().x;for(var b=1;b<e;b++){var d=f[b].getSize().x;if(d&&!isNaN(d)&&d>c){c=d}}c-=a;f.setStyle("width",c+"px")}},displayBlueChevronLowestPriceCTA:function(){var b="bcMetaLowestPriceCTA";if(ta.has(b)){var f=ta.retrieve(b);if(f.hasOwnProperty("idx")){var h="BlueChevron_LP_CTA_Display";var d=(f.idx==0)?"Not_Displayed":"Displayed";var i=f.idx+"";ta.trackEventOnPage(h,d,i)}var a=ta.id("BC_LP_CTA");if(a){(function(){a.fade("in")}).delay(700)}var e=ta.id("bc_lp_cta_text");if(e){var c=e.getSize().y;if(c==12){while(e.getSize().y<=c){e.style.width=""+(e.getSize().x-1)+"px"}e.style.width=""+(e.getSize().x+1)+"px"}a.style.left="-"+(e.getSize().x+20)+"px";var g=a.getElement(".bc_lp_cta_triangle");g.style.left=""+(e.getSize().x+10)+"px";e.style.marginTop=""+Math.round((25-e.getSize().y)/2)+"px"}var j=ta.retrieve("fadeBcLpCTAout");if(j&&j==1){(function(){a.fade("out")}).delay(5800)}}},hacAltDates:function(m,n,d,p,q){try{if(typeof(m)=="undefined"||typeof(n)=="undefined"||typeof(d)=="undefined"||!ta.id(p)||!ta.widgets.calendar.hasPageDates()){return}var f="hacAltDatesReq_curCancelKey";var a=5;q=q||new Date().getTime();var g="hacAltDatesReq_"+q+"_cancel";if(!d||d==0){d=1;ta.remove("metaUI.altDatesAvail");ta.remove("metaUI.altHotelsAvail")}else{if(ta.retrieve(g)==true){return}}if(ta.has(f)){var t=ta.retrieve(f);if(t!=g){ta.store(t,true);ta.commerce.meta.polling.removePollingInfoForRequest(t)}}if(!ta.has(g)){ta.store(g,false);ta.store(f,g)}var s=ta.widgets.calendar.getPageInDate();var u=ta.widgets.calendar.getPageOutDate();var o=ta.widgets.calendar.getPageAdultsCount();if(!s||!u||!o){return}var e=s.getDate();var i=s.getMonth()+1;var k=s.getFullYear();var b=u.getDate();var h=u.getMonth()+1;var l=u.getFullYear();var j={inDay:e,inMonth:i+" "+k,outDay:b,outMonth:h+" "+l,adults:o,location:m,initialRequest:n};var c=Object.toQueryString(j);if(!c||!c.trim()){ta.util.error.record(null,"ta.commerce.meta.hacAltDates - toQueryString failure",null,j);return}if(!ta.commerce.meta.polling.isRequestBeingPolled(g)){ta.commerce.meta.polling.setPollingAttemptForRequest(g,0)}new Request({url:"/HACAltDatesAjax",data:j,method:"get",onSuccess:function(K){if(ta.retrieve(g)==true||typeof(K)=="undefined"){return}var L=0;var A=0;var I=ta.id(p);var E=I.getParent();if(!E){return}var w=document.createDocumentFragment();var B=JSON.decode(K);if(B){for(var J=0;J<B.length;J++){var v=B[J];if(v.valid_dates=="true"&&v.available=="true"){L++;A++;if(!ta.has("metaUI.altDatesAvail")){var H=ta.id("MM_ALT_DATES_HDR");var G=ta.retrieve("meta.bc.onlinePricesAvailable");if(H&&G){H.set("text",G)}ta.store("metaUI.altDatesAvail",true)}var D=null;switch(J){case 0:D="day_before";break;case 1:D="day_after";break;case 2:D="week_before";break;case 3:D="week_after";break;default:D="unknown"}var M="ta.trackEventOnPage('DATEPICKER','OPEN','DATES_INLINE_FLEXIBLE','',null);";var F="ta.commerce.meta.requestWithAltDates("+v.check_in_date.replace(/-/g,",")+","+v.check_out_date.replace(/-/g,",")+");";var z="ta.commerce.meta.hideStateOptHRNoAvailMsg();";var y=new Element("li");if(A%2!==0){y.addClass("odd")}var N=new Element("span",{"class":"taLnk no_cpu",title:v.display_string,onclick:M+F+z}).set("text",v.display_string);y.adopt(N);w.appendChild(y)}else{if(v.response_complete=="true"){L++}}}if(w.hasChildNodes()){I.empty();I.show().appendChild(w)}if(L<B.length&&d<a){ta.commerce.meta.polling.incrementPollingAttemptForRequest(g);setTimeout(function(){ta.commerce.meta.hacAltDates(m,false,d+1,p,q)},ta.commerce.meta.polling.getPollingWaitTimeForRequest(g))}else{ta.commerce.meta.polling.removePollingInfoForRequest(g);if(ta.has("metaUI.altDatesAvail")){E.getElements(".jsAltDatesFail").each(function(O){O.hide()});E.getElements(".jsAltDatesAvail").each(function(O){O.show()})}else{var C=ta.id("META_UI_STATE_OPT_ALT_DATES_CONTAINER");if(C){C.addClass("hidden")}E.getElements(".jsAltDatesLoading").each(function(O){O.hide()});E.getElements(".jsAltDatesAvail").each(function(O){O.hide()})}}}else{return}}}).send()}catch(r){ta.util.error.record(r,"ta.commerce.meta.hacAltDates")}},trackMiniMetaStateOpt:function(a){ta.trackEventOnPage("Mini_meta_State-Optimized","display",a,0)},requestWithAltDates:function(h,b,f,c,i,a){var d,j,e;try{d=ta.util.date.create(h,b-1,f);j=ta.util.date.create(c,i-1,a);ta.widgets.calendar.setPageInDate(d);ta.widgets.calendar.setPageOutDate(j);ta.widgets.calendar.syncAllDatePickers();ta.widgets.calendar.launchInlineMeta()}catch(g){ta.util.error.record(g,"error constructing meta request with alternate dates")}},repositionGutter:function(){try{var j=ta.id("MAINWRAP");if(ta.id("HEAD")&&ta.id("HEAD").getElement(".masthead")){var k=ta.id("HEAD").getElement(".masthead")}if(ta.id("PAGE")&&ta.id("PAGE").getElement(".crumbs")){var h=ta.id("PAGE").getElement(".crumbs")}var l=ta.id("FOOT");if(j&&k&&h&&l){var a=j.getWidth();var g=90;var m=ta.id("ALSO_VIEWED_LIST");if(m){var f=m.getWidth()}var b=window.getSize().x;if(m&&b<2*f+a&&b>a+g+0.7*f){if(b>f+a+g){var d=(b-f-a-g+3)/2+g-13}else{var d=g-6}var c="0 auto 0 "+d+"px";j.setStyle("margin",c);k.setStyle("margin",c);h.setStyle("margin",c);l.setStyle("margin",c)}else{if(m&&b<=a+g+0.7*f){crossSellContainer=ta.id("AVAF_PLACEHOLDER");if(crossSellContainer&&m){ta.id("AV_ABOVE_FOLD_META").inject(crossSellContainer);m.removeClass("gutterCrossSell");if(m.hasClass("gutterPreDatesWidth")){m.removeClass("gutterPreDatesWidth")}m.addClass("gutterNotWideEnough");ta.id("AV_ABOVE_FOLD_META").removeClass("gutter")}}else{return}}}}catch(i){ta.util.error.record(i,"error repositioning gutter cross sell.")}},repositionGutterNoDates:function(){if(!ta.widgets.calendar.datesExist()){ta.commerce.meta.repositionGutter()}},copyCacheKeyClasses:function(a,d){if(!a||!d){return}var e=a.className.split(/ +/);var b=function(f){return f.slice(0,3)=="msk"};var c=function(f){d.addClass(f)};a.className.split(/ +/).filter(b).forEach(c)},initializeHoverTable:function(){var a=ta.commerce.meta.getHoverTableDisplayArea();if(!a){return false}ta.store("meta.initializedHoverTable",true);var b=ta.commerce.meta.findPostShowMetaCR();ta.commerce.meta.copyCacheKeyClasses(b,a);ta.commerce.meta.startHoverTableSearchTimer();return true},startHoverTableSearchTimer:function(){setTimeout(function(){ta.store("isHoverTableTimerExpired",true);ta.commerce.meta.lockHoverTable(null);ta.commerce.meta.updateHoverTable(null)},2000)},hideHoverTableDisplayArea:function(){var b=ta.commerce.meta.getHoverTableDisplayArea();var a=ta.retrieve("showHoverTextLinks");if(b&&!a){b.hide()}else{if(a){var c=b.getElement("#hover_table_search");if(c){c.hide()}ta.commerce.meta.updateHoverTableTextLinks();ta.commerce.meta.showHoverTableTextLinks();ta.store("showHoverTextLinks",false)}}},setupHoverTable:function(a){if(!ta.retrieve("meta.initializedHoverTable")){if(!ta.commerce.meta.initializeHoverTable()){setTimeout(function(){ta.commerce.meta.setupHoverTable(a)},100);return}}ta.commerce.meta.updateHoverTable(a)},getHoverTableDisplayArea:function(){return document.getElement("#hover_table_display_area")},showHoverTableTextLinks:function(){var c=ta.commerce.meta.getHoverTableDisplayArea();var a=c.getElement(".textLinks");var b=c.getElement(".disclaimer");if(a){a.show()}if(b){b.show()}},hideHoverTableTextLinks:function(){var c=ta.commerce.meta.getHoverTableDisplayArea();var a=c.getElement(".textLinks");var b=c.getElement(".disclaimer");if(a){a.hide()}if(b){b.hide()}},filterTextLinksForHoverTable:function(b){var g=ta.commerce.meta.getHoverTableDisplayArea();if(!g){return}var b=g.getElement(".hover_table.results");if(!b){return}var k=b.getElements(".provider");var d=g.getElements(".textLinks .textLink .providerName");if(!k||!d){return}var f=[];var e=g.getElement(".moreLink");var a;var i=6;var c=d.length-i;if(e==null||ta.retrieve("checkrates.hr_bc_see_all_click")==true||c<2){a=false}else{a=true}var h=true;var j=0;k.each(function(l){f.push(l.innerHTML.trim())});d.each(function(l){var m=l.getParent();if(f.contains(l.innerHTML.trim())){m.hide()}else{if(h){m.addClass("odd")}else{m.removeClass("odd")}h=!h;if(j>2&&a){m.addClass("remaining")}else{m.removeClass("remaining")}j++}});if(e!=null){if(a){e.show()}else{e.hide()}}},beginHoverTableHacQuery:function(){ta.store("isHoverTableTimerExpired",false);ta.commerce.meta.hideCarouselXSell();ta.commerce.meta.hideHoverTableTextLinks();var c=ta.commerce.meta.getHoverTableDisplayArea();if(!c){return}var a=c.getParent().getElement(".error_msg");if(a){a.hide()}c.show();var f=ta.commerce.meta.getHoverTableSearch();if(f){f.show()}ta.commerce.meta.startHoverTableSearchTimer();if(!ta.retrieve("meta.initializedHoverTable")){return false}ta.store("meta.lockedHoverTable",false);ta.remove("meta.lockHoverTableOnUpdate");var c=ta.commerce.meta.getHoverTableDisplayArea();var d=c.getElement(".hover_table.results");if(d){d.destroy()}var e=c.getElement(".textLinks");if(e){e.destroy()}var b=c.getElement(".disclaimer");if(b){b.destroy()}ta.commerce.meta.startHoverTableSearchTimer()},getHoverTableSearch:function(){return document.getElement("#hover_table_search")},updateHoverTableTextLinks:function(){var e=ta.commerce.meta.findPostShowMetaCR();if(!e){return}var a=e.getElement(".textLinks");var d=ta.commerce.meta.getHoverTableDisplayArea();if(!d){return}var b=d.getElement(".textLinks");var c=d.getElement(".disclaimer");if(a){if(b){b.destroy()}if(c){c.grab(a,"before")}else{d.grab(a,"bottom")}a.show()}},setDefaultHoverTableTab:function(b){var c=b.getElement(".default_hover_table_tab");if(c){var a=function(){ta.commerce.meta.showHoverTableContentForTab(c)};b.addEvent("mouseleave",a);a()}},findPostShowMetaCR:function(){return document.getElement(".postShowMetaCR.msk")},getElementFromPostShowMetaCR:function(a){var b=ta.commerce.meta.findPostShowMetaCR();if(b){return b.getElement(a)}else{return null}},getElementsFromPostShowMetaCR:function(a){var b=ta.commerce.meta.findPostShowMetaCR();if(b){return b.getElements(a)}else{return null}},lockHoverTable:function(a){if(ta.retrieve("meta.lockedHoverTable")){return}var g=ta.commerce.meta.findPostShowMetaCR();if(!g){return}var e=g.getElement(".hover_table.results");var d=ta.commerce.meta.getHoverTableDisplayArea();if(!d){return}if(e){var c=e.getElements(".provider").length;if(c<1&&!a){ta.store("meta.lockHoverTableOnUpdate",true);return}ta.commerce.meta.setDefaultHoverTableTab(e);d.grab(e);var b=g.getElement(".disclaimer");if(b){d.grab(b);b.show()}if(c>0||(ta.isBCHoverTable()&&a)){e.show()}}else{ta.store("meta.lockHoverTableOnUpdate",true);return}var f=ta.commerce.meta.getHoverTableSearch();if(f){f.hide()}ta.store("meta.lockedHoverTable",true)},updateHoverTable:function(a){if(!ta.retrieve("meta.lockedHoverTable")&&(a||ta.retrieve("meta.lockHoverTableOnUpdate"))){ta.commerce.meta.lockHoverTable(a)}if(ta.retrieve("meta.lockedHoverTable")){ta.commerce.meta.updateHoverTableTextLinks();ta.commerce.meta.filterTextLinksForHoverTable();ta.commerce.meta.showHoverTableTextLinks()}else{if(a==null){ta.store("showHoverTextLinks",true)}}},showHoverTableContentForTab:function(a){a=ta.id(a);if(!a){return}document.getElements(".hover_table .tab").removeClass("selected");document.getElements(".hover_table .tab .arrow").addClass("hidden");document.getElements(".hover_table.results .content").addClass("hidden");a.addClass("selected");a.getElement(".arrow").removeClass("hidden");a.getElement(".content").removeClass("hidden");return},handleHoverTableResponseText:function(b){var a=new Element("div",{html:b});if(a.getElement(".clearHoverTable")){ta.commerce.meta.hideHoverTableDisplayArea()}else{ta.commerce.meta.setupHoverTable(a.getElement(".hacComplete")!=null)}},truncateProviderNames:function(){var f=document.getElement(".textLink");if(f){var c=f.getSize().x;var e=f.getElement(".price");if(e){var b=e.getSize().x;var a=c-b-28;var d=$$(".textLinks .providerName");if(a>0){Array.each(d,function(g){if(g.getNext(".price")){g.setStyle("width",a)}})}}}},expandProvidersInline:function(b,d){b=ta.id(b);if(!b){return}var a=b.getParent(".metaPriceInfo");if(!a){return}var c=a.getElements(".provider");if(!c){return}c.show();b.hide()},flipHoverClass:function(b,a){if(b){b=ta.id(b);var c=a+"Idle";var d=a+"Over";b&&b.toggleClass(c).toggleClass(d)}},trackHotelRatingsInfoClickInHR:function(a){a.target=a.target||a.srcElement;if(a.target&&a.target.href){ta.setEvtCookie("Ratings_Info","all_hotels","",0,a.target.href)}},animateChevron:function(d,a,b){a=ta.id(a);if(!a){return}if(Browser.name==="ie"&&Browser.version<10){var c=new Fx.Morph(a,{duration:100});if(b==="enter"){c.start({width:382,"margin-left":-191})}else{if(b==="leave"){c.start({width:354,"margin-left":-177})}}}return},animateChevronBig:function(f,b,d){if(!ta.browser.isIElt10()){return}b=ta.id(b);if(!b){return}var a=b.getElement(".priceBlock");if(!a){return}var e=new Fx.Morph(b,{duration:200});var c=null;if(a){c=new Fx.Morph(a,{duration:200})}if(d==="enter"){e.start({width:424,height:72,"margin-left":-212});if(c){c.start({height:70})}}else{if(d==="leave"){e.start({width:354,height:58,"margin-left":-177});if(c){c.start({height:56})}}}},trackInterrupter:function(){if(ta.has("ta.mini_meta_in_reviews")&&!ta.has("ta.mmir.interrupterSeen")){var b=ta.id("MINI_META_IN_REVIEWS");if(b){var d=b.getPosition()}try{var f=window.getScroll();var a=window.getSize();if(d.y>f.y&&d.y<(f.y+a.y)){ta.store("ta.mmir.interrupterSeen",true);if(ta.has("ta.mmir.interrupterReviewNumber")){ta.trackEventOnPage("ReviewInterrupter","displayed",ta.retrieve("ta.mmir.interrupterReviewNumber"))}}}catch(c){}}},updateHeaderMsg:function(b,c){var a=document.getElement(b);if(c&&a){a.innerHTML=c}}};ta.commerce.minimeta={ajax:{MAX_POLL_ATTEMPT:20,ALL_HAC_COMPLETE:"hotelsMeta.allHacComplete",LOCS_ON_PAGE:"hotelsMeta.locsOnPage",ATTEMPT_STORE_KEY:"hotelsMeta.ajaxNum",TIME_EXPIRED:"hotelsMeta.timeExpired",MINI_META_APPEAR_LOADING_TIMEOUT:5000,MINI_META_STOP_LOADING_TIMEOUT:60000,travelData:ta.commerce.checkrates.getTravelDataFromDOM(),send:function(c,a){var b=ta.commerce.minimeta.ajax;setTimeout(function(){new Request({method:"post",url:b.getUrl(),data:b.buildPostData(a),onSuccess:function(d){var e=new Element("div",{html:d});b.updateDOM(e);if(!c&&b.shouldResubmit()){ta.commerce.minimeta.ajax.send()}b.updateAttemptNum()}}).send()},ta.commerce.meta.polling.getPollWaitTimeForPollingAttempt(ta.retrieve(ta.commerce.minimeta.ATTEMPT_STORE_KEY)))},getUrl:function(){return"/BulkMiniMetaCRAjax"},buildPostData:function(b){var a={};a.area="QC_Meta_Mini";a.returnAllOffers=true;a.detail=ta.commerce.minimeta.ajax._getLocOnPageString(b);a.action="getMiniMetaForLocations";return a},updateDOM:function(d){var a=d.getElement(".isAllHacComplete");if(a||ta.retrieve(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE)){ta.store(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE,true);var c=$$(".metaDisclaimer");if(c&&c.hasClass("hidden")){c.removeClass("hidden")}}var b=document.getElements(".listing");b.each(function(j){var i=j.id;var h=i.substring(i.indexOf("_")+1);var g=d.getElement("."+h);ta.commerce.minimeta.ajax.updateLoadingState(d);if(g){var e=g.getElement(".metaPriceInfo");var f=j.getElement(".metaPriceInfo");ta.commerce.minimeta.ajax._setPrice(e,h);ta.commerce.minimeta.ajax._setAccomType(e,h);e.replaces(f)}})},resetAjaxCall:function(){ta.remove(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE);ta.remove(ta.commerce.minimeta.ajax.LOCS_ON_PAGE);ta.remove(ta.commerce.minimeta.ajax.ATTEMPT_STORE_KEY);ta.remove(ta.commerce.minimeta.ajax.TIME_EXPIRED)},shouldResubmit:function(){if(ta.retrieve(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE)){return false}else{var a=ta.retrieve(ta.commerce.minimeta.ATTEMPT_STORE_KEY);if(!a||a<ta.commerce.minimeta.ajax.MAX_POLL_ATTEMPT-1){return true}else{return false}}},updateAttemptNum:function(){var a=ta.retrieve(ta.commerce.minimeta.ATTEMPT_STORE_KEY);if(!a){ta.store(ta.commerce.minimeta.ATTEMPT_STORE_KEY,1)}else{ta.store(ta.commerce.minimeta.ATTEMPT_STORE_KEY,a+1)}},_getLocOnPageString:function(b){listings=document.getElements(".listing");var a="";listings.each(function(d){if(ta.commerce.minimeta.ajax._isHacComplete(d)&&!b){return}var c=d.id;locId=c.substring(c.indexOf("_")+1);a=a+locId+","});if(a==""){ta.store(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE,true)}return a},_isHacComplete:function(a){return a.getElement(".metaPriceInfo.hacComplete")},_setPrice:function(b,f){var a=b.getElement(".classicPrice");if(a){var d="classicPrice_"+f;var c=ta.retrieve(d);if(ta.retrieve("hotels.shouldHideClassicPrices")){a.hide()}else{if(c&&c!=0){var e=a.getElement(".price");e.set("html",c);a.toggleClass("hidden",false)}else{a.hide()}}}},_setAccomType:function(a,d){var c=a.getElement(".contactStr");if(c){var b="accomType_"+d;var e=ta.retrieve(b);if(!e||e=="T_HOTEL"){c.set("html",ta.retrieve("hotels.contactHotel"))}else{c.set("html",ta.retrieve("hotels.contactAccom"))}}},updateLoadingState:function(b){if(ta.retrieve(ta.commerce.minimeta.ajax.TIME_EXPIRED)){var d=b.getElements(".loading_bubbles_gry");var c=new Element("span",{"class":"sprite-visitSite"});d.each(function(f){c.clone().replaces(f)});var a=b.getElements(".loadingHeader");var e=ta.retrieve("hotels.checkSites");a.each(function(f){f.set("html",e)})}}},storeAccomDetails:function(){var b=document.getElements(".classicPrices");b.each(function(d){ta.store(d.id,d.value)});var a=document.getElements(".accomTypes");a.each(function(d){ta.store(d.id,d.value)});var c=$$(".metaDisclaimer");if(c){c.addClass("hidden")}},doMetaDateSearch:function(d){if(!ta.widgets.calendar.hasPageDates()){var c=document.getElement(".metaDatePicker .date_picker_calendar_wrap");c.fireEvent("click")}else{if(ta.has("hac.filter.changed")){ta.hac.filters.updateResults()}else{if(!ta.retrieve("hotels.datesChanged")){ta.hac.filters.updateResults();ta.servlet.HACSearch.destroyAnimatedDateCTA()}else{var b=ta.hac.filters.buildHACUrlParamString();var a="/HACSearch?"+b+window.location.hash;window.location=a}}}},lowestPriceBookBtnHover:function(b){try{var a=document.getElement(".LowestPrice .bookBtn");if(!a){ta.util.error.record(null,"lowestPriceBookBtnHover - no button for .LowestPrice .bookBtn",null,{out:b});return}if(b){a.className=a.className.replace(/Over\b/,"Idle")}else{a.className=a.className.replace(/Idle\b/,"Over")}}catch(c){ta.util.error.record(c,"lowestPriceBookBtnHover - cannot change button hover appearance",null,{out:b})}}};ta.commerce.AvailDataWidget=new Class({Implements:[Options],options:{calendarOptions:{},argArray:[]},initialize:function(f,d,c,b,e,i){this.setOptions(i);if(f||window.event){f=new Event(f||window.event);if(f){f.stop()}}this.locId=d;this.ext=b;var h=null;if(this.ext){h="date_picker_adults_"+this.locId+this.ext}else{h="date_picker_adults_"+this.locId}this.adultField=ta.id(h);this.options.calendarOptions=Object.merge(this.options.calendarOptions,{ext:this.ext?this.ext:""});if(ta.has("hotels.redesignEnabled")&&document.getElement(".calendarWrap")){this.calendar=new ta.widgets.MultiDateCalendarInline(this.options.calendarOptions,this.locId,e,document.getElement(".calendarWrap"))}else{if(ta.retrieve("multiDP.two_field")){var g=true;if(f&&f.target&&ta.id(f.target).hasClass&&ta.id(f.target).hasClass("out_date")){g=false}this.calendar=new ta.widgets.SingleDateCalendar(this.options.calendarOptions,this.locId,e,this.options.argArray,g)}else{this.calendar=new ta.widgets.MultiDateCalendar(this.options.calendarOptions,this.locId,e,this.options.argArray)}}var a=ta.retrieve("adultFieldsMap");if(!a){a={}}if(this.adultField&&(!a[h]||this.adultField.getParent(".overlay"))){if(!a[h]){this.adultsField=new ta.widgets.AdultsField(this.adultField,this.locId,e,f);a[h]=this.adultsField;ta.store("adultFieldsMap",a)}else{this.adultsField=a[h]}}this.show(c);if(ta.widgets.calendar.trackCalendarObject){ta.widgets.calendar.trackCalendarObject(this)}},show:function(a){if(a=="calendar"&&this.calendar&&this.calendar.calendarOverlay){this.calendar.showCalendarOverlay()}else{if(a=="adults"&&this.adultsField){this.adultsField.adultsOverlay.show()}}if(ta.has("persistentFilters.showing")&&tabletOnFullSite&&this.calendar.calendarOverlay.container){this.calendar.calendarOverlay.container.setStyle("position","fixed")}},clear:function(){if(this.adultField){var a=ta.retrieve("adultFieldsMap");if(a){a[this.adultField.id]=false}ta.widgets.calendar.setPageAdultsCount(2);ta.widgets.calendar.syncAllDatePickers()}this.calendar.clear()},getState:function(d){var b=this.calendar.getState();var a={adults:"2"};if(this.adultsField){a=this.adultsField.getState()}else{if(ta.widgets.calendar.getPageAdultsCount()){a={adults:ta.widgets.calendar.getPageAdultsCount()+""}}}var c=Object.merge(b,a);if(d){return c}return Object.toQueryString(c)}});ta.widgets.AdultsField=new Class({adultsSelRegex:/.*_(\d)\s*$/,adultsExRegex:/.*_\d+_(.*)$/,initialize:function(l,d,h,b){this.adultsField=l;this.crId=d;this.selectionFunction=h;var m=this.adultsField.getParent(".overlay");if(m){this.parentOverlay=m.overlay}var i=ta.overlays.ACTIVATE_CLICK;if(this.parentOverlay&&this.parentOverlay.container&&ta.id(this.parentOverlay.container).hasClass("persistentCR")){i=ta.overlays.ACTIVATE_NEVER}this.guestFieldLabel=this.generateGuestFieldLabel(this.adultsField.id);this.adultsOverlay=new ta.overlays.RelativeOverlayBelow({style:"dp",showCloseButton:false,noPadding:true,autoShow:false,offsetLeft:1,activate:i,onShow:this.onAdultsShow.bind(this),onHide:this.onAdultsHide.bind(this)},this.adultsField);this.adultsField.onclick=function(){};ta.id(this.adultsField).addEvent("click",this.adultsOverlay.show);var k=ta.id(this.adultsOverlay.container).getElement(".adults_pre_selected");try{this.count=ta.retrieve("date.picker.adultsCount");if(!this.count){this.count=this.adultsSelRegex.exec(k.id)[1]}}catch(j){}if(!this.count){this.count="2"}ta.widgets.calendar.setPageAdultsCount(this.count);var a=ta.id(this.adultsOverlay.container).getElements(".option");var f=this.adultSelect.bind(this);var g=this.buildAdultsErrorMsg.bind(this);a.each(function(n,e){elemSelectFunc=function(o){f.pass([e+1,n,o.event])()};ta.id(n).addEvent("click",elemSelectFunc);if(ta.retrieve("open_guest_field.isTest2Enabled")&&(e+1)==a.length){ta.id(n).removeEvent("click",elemSelectFunc);g.pass(n)()}});var c=this.adultsField.clientWidth;if(ta.retrieve("open_guest_field.isTest2Enabled")){c=c+4}c=c+"px";ta.id(this.adultsOverlay.container).setStyles({width:c});this.optionElems=a;if(ta.retrieve("open_guest_field.isNewSelectBehaviorEnabled")){this.defaultCount=2;this.defaultCountElem=a[1];this.preSelectElem=a[this.count-1];if(this.optionElems[this.count-1]){this.optionElems[this.count-1].addClass("adults_pre_selected")}}},generateGuestFieldLabel:function(c){var b=this.adultsExRegex.exec(c);var a=ta.retrieve("open_guest_field.servletName");if(!b){if(!a){return""}else{if(a=="Hotel_Review"){return"Guest_HR"}else{if(a=="Hotels"){return"Guest_Hotels"}else{return""}}}return"Guests"}else{if(b[1]=="pop"){return"Guest_Flyout"}else{if(b[1]=="met"){return"Guests_MetaLightBox"}else{if(b[1]=="pto"){return"Guest_HR_PhotoLightbox"}else{if(b[1]=="amo"){return"Guest_HR_AmenitiesLightbox"}else{return""}}}}}},trackGuestFieldEvent:function(b,a){try{ta.trackEventOnPage("GuestPicker",b,a)}catch(c){ta.util.error.record(c,"ta.widgets.AdultsField.trackGuestFieldEvent")}},buildAdultsErrorMsg:function(c){var b=ta.overlays.ACTIVATE_CLICK;this.adultsErrorMsgOverlay=new ta.overlays.RelativeOverlayBelow({style:"dp",showCloseButton:true,autoShow:false,offsetLeft:1,activate:b,onShow:this.onAdultsErrorMsgShow.bind(this),onHide:this.onAdultsErrorMsgHide.bind(this)},c);this.adultsErrorMsgOverlay.parentOverlay=this.parentOverlay;c.onclick=function(){};ta.id(c).addEvent("click",this.adultsErrorMsgOverlay.show);ta.id(this.adultsErrorMsgOverlay.container).setStyles({"z-index":9998});var a=ta.id(this.adultsErrorMsgOverlay.container).getElement(".inner");if(a){a.addClass("date_picker_adults_error_container")}},onAdultsErrorMsgShow:function(){if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}var e=ta.id(this.adultsField).getCoordinates().top;var c=ta.id(this.adultsErrorMsgOverlay.container).offsetTop;var b=ta.id(this.adultsOverlay.container).clientHeight;if(c>=e){ta.id(this.adultsErrorMsgOverlay.container).setStyles({top:e+29})}else{ta.id(this.adultsErrorMsgOverlay.container).setStyles({top:c+b-29})}var f=ta.id(this.adultsOverlay.container).getElements(".option");var a=ta.retrieve("open_guest_field.isTrackingEventEnabled");ta.store("open_guest_field.isTrackingEventEnabled",false);this.adultSelect(this.defaultCount,this.defaultCountElem,"click");ta.store("open_guest_field.isTrackingEventEnabled",a);this.adultsOverlay.hide();var d=this.guestFieldLabel+"|3plus";if(ta.retrieve("open_guest_field.isTrackingEventEnabled")){this.trackGuestFieldEvent("Select",d)}},onAdultsErrorMsgHide:function(){try{if(this.parentOverlay&&!this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}}catch(a){ta.util.error.record(a,"ta.widgets.AdultsField.onAdultsErrorMsgHide")}},onAdultsShow:function(){try{if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}this.keyEventListener=this.onAdultsOverlayKeyDown.bind(this);document.addEvent("keydown",this.keyEventListener);this.adultsField.blur();var a=document.getElements(".date_picker_adults_option");if(a){Array.each(a,function(d){ta.id(d).removeClass("adults_selected");ta.id(d).removeClass("adults_pre_selected")})}if(ta.id(this.adultsField).getParent("#PERSISTENT_CHECK_RATES")){var b=ta.id(this.adultsField).getCoordinates().top;if(typeof(isIPad)=="undefined"||!isIPad){b=b-window.getScrollTop()}ta.id(this.adultsOverlay.container).setStyles({position:"fixed",top:b+29,zindex:9997})}this.count=ta.retrieve("date.picker.adultsCount");if(ta.retrieve("open_guest_field.isNewSelectBehaviorEnabled")){this.optionElems[this.count-1].addClass("adults_pre_selected");this.preSelectElem=this.optionElems[this.count-1]}if(ta.retrieve("open_guest_field.isTrackingEventEnabled")){this.trackGuestFieldEvent("Open",this.guestFieldLabel)}}catch(c){ta.util.error.record(c,"ta.widgets.AdultsField.onAdultsShow")}},onAdultsHide:function(){try{if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}if(this.keyEventListener){document.removeEvent("keydown",this.keyEventListener)}}catch(a){}},onAdultsOverlayKeyDown:function(a){if(a.key=="esc"){this.adultsOverlay.hide()}},adultSelect:function(e,d,c){if(ta.retrieve("meta.enabled")){ta.commerce.meta.tracking.resetAllTimingLocks();ta.commerce.meta.tracking.clearSuppressedAreas();ta.commerce.meta.polling.clearAllPollingInfo()}this.updateValue(e,d.innerHTML);this.adultsOverlay.hide();var b=this.guestFieldLabel+"|"+this.count;if(ta.retrieve("open_guest_field.isTrackingEventEnabled")){this.trackGuestFieldEvent("Select",b)}if(!ta.widgets.calendar.hasPageDates()){return}if(this.selectionFunction){if(this.selectionFunction===ta.widgets.calendar.launchInlineMeta){this.selectionFunction.call(this,c)}else{this.selectionFunction.call(this,this.crId,this.adultsField)}}if(ta.commerce.metajson){ta.commerce.metajson.refetchAll()}if(typeof oxapp!="undefined"&&oxapp&&oxapp.context){var a=oxapp.context.get("TravelDates");if(a){a.save()}}if(ta.has("checkrates.meta_af")&&!(ta.has("checkrates.avaf_anti_distraction")&&!this.options.ext)){ta.commerce.meta.loadMetaAF(this.crId,"AV_ABOVE_FOLD_META",false)}else{if(ta.has("checkrates.avaf_anti_distraction")&&!this.options.ext){var f=ta.id("AV_ABOVE_FOLD_META");if(f){f.destroy()}}}if(ta.retrieve("stateopt_modal_test")){ta.commerce.meta.closeStateoptModal()}ta.widgets.calendar.trackCalendarEvent("DATEPICKER","CHANGE","GUESTS",e)},updateValue:function(a,b){this.count=a;this.adultsField.innerHTML=b;ta.widgets.calendar.setPageAdultsCount(this.count);ta.widgets.calendar.syncAllDatePickers();var c=document.getElements(".adults");c.each(function(d){d.innerHTML=b})},getAdultsCount:function(){return this.count},getState:function(){return{adults:this.count+""}}});ta.commerce.meta.tracking={getTimingForNavArea:function(a){if(!a){return}var b=ta.commerce.meta.tracking.processNavArea(a);return ta.retrieve(b)},setTimingLockForNavArea:function(b,a){ta.store(b+"-LOCK",a)},isTimingLocked:function(b){var c=ta.commerce.meta.tracking.processNavArea(b);var d=ta.retrieve(c);if(!d){return false}var a=Date.now();if(a-d>=2000){ta.commerce.meta.tracking.resetTimingLockForNavArea(c);return false}return true},resetTimingLockForNavArea:function(a){var b=ta.commerce.meta.tracking.processNavArea(a);if(ta.retrieve(b+"-LOCK")){ta.remove(b+"-LOCK")}},resetAllTimingLocks:function(){var a=["QC_Meta_Inline","QC_Meta_Mini","QC_Meta_Metro","QC_Meta_Micro","QC_Meta_Lightbox"];for(var b=0;b<a.length;b++){ta.commerce.meta.tracking.resetTimingLockForNavArea(a[b])}},processNavArea:function(a){if(!a){return}if(a.indexOf("QC_Meta_Inline")==0){return"QC_Meta_Inline"}if(a.indexOf("QC_Meta_Mini")==0){return"QC_Meta_Mini"}if(a.indexOf("QC_Meta_Metro")==0){return"QC_Meta_Metro"}if(a.indexOf("QC_Meta_Micro")==0){return"QC_Meta_Micro"}if(a.indexOf("QC_Meta_Lightbox")==0){return"QC_Meta_Lightbox"}},setTimingForNavArea:function(c,b){if(!c){return}if(!b){b=Date.now()}var a=ta.commerce.meta.tracking.processNavArea(c);if(ta.commerce.meta.tracking.isTimingLocked(a)){return ta.commerce.meta.tracking.getTimingForNavArea(a)}ta.store(a,b);ta.commerce.meta.tracking.setTimingLockForNavArea(a,b);if(a=="QC_Meta_Inline"&&!ta.commerce.meta.tracking.containsSuppressedArea("QC_Meta_Mini")){ta.commerce.meta.tracking.setTimingLockForNavArea("QC_Meta_Mini",b)}return b},updateUrlWithTiming:function(b,a){if(!b||!a){return}var c=ta.commerce.meta.tracking.setTimingForNavArea(a);if(!c){return b}if(b.contains("&metaRequestTiming=")){var d=new RegExp("(&|\\?)metaRequestTiming=[^&]*");b=b.replace(d,"&metaRequestTiming="+c)}else{b+="&metaRequestTiming="+c}return b},suppressImpressionsForArea:function(c){if(!c){return}var b=ta.commerce.meta.tracking.processNavArea(c);if(ta.commerce.meta.tracking.containsSuppressedArea(b)){return}var a=ta.retrieve("suppressed.areas");a.push(b);ta.store("suppressed.areas",a)},getSuppressedAreas:function(){var a=ta.retrieve("suppressed.areas");if(!a){a=[];ta.store("suppressed.areas",a)}return a},getSuppressedAreasAsString:function(){var b=ta.commerce.meta.tracking.getSuppressedAreas();var a="";if(b.length>0){for(var c=0;c<b.length;c++){a+=b[c]+";"}}return a},hasAnySuppressedAreas:function(){var a=ta.commerce.meta.tracking.getSuppressedAreas();return a.length>0},containsSuppressedArea:function(d){if(!d){return false}var b=ta.commerce.meta.tracking.processNavArea(d);var a=ta.commerce.meta.tracking.getSuppressedAreas();for(var c=0;c<a.length;c++){if(a[c]==b){return true}}return false},removeSuppressedArea:function(e){if(!e){return}var b=ta.commerce.meta.tracking.processNavArea(e);var f;var c;if(ta.commerce.meta.tracking.containsSuppressedArea(b)){var a=ta.commerce.meta.tracking.getSuppressedAreas();for(var d=0;d<a.length;d++){if(a[d]==b){c=d;f=true}if(f){a=ta.commerce.meta.tracking.removeElementByIndex(a,c);ta.store("suppressed.areas",a)}}}},removeElementByIndex:function(b,a){if(b&&a>=0&&a<b.length){b.splice(a,1)}return b},clearSuppressedAreas:function(){ta.store("suppressed.areas",[])}};ta.commerce.meta.polling={setPollingAttemptForRequest:function(a,b){var c=ta.commerce.meta.polling.getPollingMap();if(!b){b=1}c[a]=b;ta.commerce.meta.polling.setPollingMap(c)},getPollingAttemptForRequest:function(a){if(ta.commerce.meta.polling.isRequestBeingPolled(a)){var c=ta.commerce.meta.polling.getPollingMap();var b=c[a];if(b){return b}}},getPollingWaitTimeForRequest:function(a){var b=ta.commerce.meta.polling.getPollingAttemptForRequest(a);return ta.commerce.meta.polling.getPollWaitTimeForPollingAttempt(b)},isRequestBeingPolled:function(a){var c=ta.commerce.meta.polling.getPollingMap();var b=c[a];if(b){return true}return false},incrementPollingAttemptForRequest:function(a){var c=ta.commerce.meta.polling.getPollingMap();var b=c[a];if(b){b=b+1;c[a]=b}ta.commerce.meta.polling.setPollingMap(c);return b},clearAllPollingInfo:function(){var a=new Object();ta.store("ta.meta.polling.map")},removePollingInfoForRequest:function(a){if(ta.commerce.meta.polling.isRequestBeingPolled(a)){var b=ta.commerce.meta.polling.getPollingMap();delete b[a];ta.commerce.meta.polling.setPollingMap(b)}},getPollingMap:function(){var a=ta.retrieve("ta.meta.polling.map");if(!a){a=new Object();ta.store("ta.meta.polling.map",a)}return a},setPollingMap:function(a){if(a){ta.store("ta.meta.polling.map",a)}},getPollWaitTimeForPollingAttempt:function(a){switch(a){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:return 1000;case 11:return 5000;case 12:return 15000;case 13:return 30000;case undefined:case null:default:return 1000}}};ta.commerce.meta.horizontalXSell=(function(){var k=10;var g=1000;var h=false;var c=null;var m=null;var l=null;var o=0;var f=function(p){if(p.contains("hacComplete")&&(p.contains("hacMiniOfferNotAvailable")||p.contains("hacMiniOfferUnavailable"))){return true}return false};var j=function(p){if(!a()){return false}if(!p.contains("hacMiniOfferUnavailable")){return true}return false};var e=function(r,u){try{if(!u){o=0}c=new Date().getTime();var t=c;var s=ta.commerce.checkrates.getTravelDataFromDOM();if(!s||!s.adults||!s.inDay||!s.outDay||!s.sInMonthYear||!s.sOutMonthYear){return}var p={detail:r,adults:s.adults,inMonth:s.sInMonthYear[0]+" "+s.sInMonthYear[1],inDay:s.inDay,outMonth:s.sOutMonthYear[0]+" "+s.sOutMonthYear[1],outDay:s.outDay,reqNum:u?"2":"1",type:"horizontal_hr"};var v=Object.toQueryString(p);if(!v||!v.trim()){ta.util.error.record(null,"ta.commerce.meta.horizontalXSell.loadHorizontalXSell - toQueryString failure",null,p);return}new Request({url:"/MetaBestPriceCrossSellAjax",data:p,evalScripts:true,onSuccess:function(A,C){if(t!=c){return}var F=new Element("div",{html:A});var B=F.getElement(".xsellHacStatusReady")||F.getElement(".xsellHacStatusSOL")||u;if(!B&&o<k){setTimeout(function(){o=o+1;e(r,true)},g)}else{var y=ta.id("HORIZONTAL_CROSS_SELL");var D=F.getElement(".metaMicro");if(y&&D){if(y.getElement(".metaMicro")){y.innerHTML=A}else{y.setStyle("opacity","0");var w=new Fx.Tween(y,{property:"opacity"});y.setStyle("height",0);var z=122;var E=new Fx.Tween(y,{property:"height",onComplete:function(){y.setStyle("height","auto");y.innerHTML=A;w.start(0,1)}});E.start(0,z)}if(m){m()}d(true);ta.trackEventOnPage("HorizXSell","displayed")}}},onFailure:function(){ta.util.error.record(null,"ta.commerce.meta.horizontalXSell.loadHorizontalXSell - MetaBestPriceCrossSellAjax request failed")}}).send()}catch(q){ta.util.error.record(q,"ta.commerce.meta.horizontalXSell.loadHorizontalXSell")}};var i=function(p,q){if(!p||!p.getElement(".bc_flags")){return}var r=p.getElement(".bc_flags").className;if(j(r)){removeHorizontalXSell()}else{if(f(r)){e(q,false)}}};removeHorizontalXSell=function(){var p=ta.id("HORIZONTAL_CROSS_SELL");var r=ta.id("HORIZONTAL_CROSS_SELL_LIST");var s=document.getElement("#HORIZONTAL_CROSS_SELL_LIST .lodging");if(p&&r&&s){var t=r.getSize().y;p.setStyle("height",t);var u=new Fx.Tween(r,{duration:200,property:"opacity",onComplete:function(){r.addClass("hidden");q.start(t,0).chain(function(){p.setStyle("height",0);p.innerHTML=""})}});u.start(1,0);var q=new Fx.Tween(p,{duration:"long",property:"height"});if(l){l()}d(false)}};var a=function(){return h};var d=function(p){h=p};var n=function(p){m=p};var b=function(p){l=p};return{updateHorizontalXSell:i,removeHorizontalXSell:removeHorizontalXSell,isLoaded:a,setLoaded:d,setOnloadFunction:n,setOnRemoveFunction:b}}());ta.commerce.meta.horizontalXSellExtensions={putAvafBelowMap:function(){if(ta.commerce.meta.horizontalXSell.isLoaded()){return}var d=ta.id("AV_ABOVE_FOLD_META");var c=ta.id("RHS_MAP");var b=d.parentNode;if(d&&c&&b){var a=b.getElement(".bxDivider.map");if(a){b.insertBefore(a,d);b.insertBefore(c,a)}else{b.insertBefore(c,d)}}},putAvafAboveMap:function(){if(!ta.commerce.meta.horizontalXSell.isLoaded()){return}var d=ta.id("AV_ABOVE_FOLD_META");var c=ta.id("RHS_MAP");var b=d.parentNode;if(d&&c&&b){var a=b.getElement(".bxDivider.map");b.insertBefore(d,c)}}};if(!ta.tests){ta.tests={}}ta.tests.bookingcom=(function(l,j,f,e){var h="http://b.scorecardresearch.com/p?c1=3&c2=6036461&c3=ALbook1&c4=%ID1%&c5=%ID2%&c6=&c10=1&c11=%esid!&c13=%psz=!;&c16=dfp&cj=1&ax_fwd=1&rn=%RND%",b=[[1010,101010],[3030,303030]],o="BookingCom",c=/booking.(com|gif)/i,n=false,i=false,g=function(p){return(p)?n:i},m=function(u,r){if(f.find(u)&&r){var q=f.select(u);for(var p=0;p<q.length;p++){var t=q[p];if(t.get("data-provider")&&t.get("data-provider")==o&&!t.hasClass("hidden")){var s=t.hasClass(r);if(s){k(true);return true}else{if(!/noLink/.test(t.innerHTML)){k(false);return true}}}}}return false},a=function(t,s){if(g(s)){return true}if(f.find(t)){var q=f.select(t);for(var p=0;p<q.length;p++){var r=q[p];if(c.test(r.innerHTML)){k(s);return true}}}return false},d=function(p,q){if(g(q)){return true}if(p&&p.innerHTML){if(c.test(p.innerHTML)){k(q);return true}}return false},k=function(q){var r=(q)?b[0]:b[1];var p=h.replace("%ID1%",r[0]).replace("%ID2%",r[1]).replace("%RND%",Math.floor(Math.random()*100000));l.body.appendChild(new Element("img",{"class":"tracking",src:p,height:"0",width:"0"}));(q)?n=true:i=true;if(n&&i){f.remove("tests.bookingcom")}};return{chkLightbox:function(){setTimeout(function(){var q=f.find(".overlay #PROVIDER_BLOCK");if(q){var p=".overlay #PROVIDER_BLOCK .metaProvider.jsPrvdr";a(p,true);p=".overlay #PROVIDER_BLOCK .remainingProv.jsPrvdr";a(p,false)}},1000)},chkMicroMeta:function(p){setTimeout(function(){if(p){d(f.find(".micro_meta_first_block"),true)}else{d(f.find("#micro_meta_ajax"),true)}},1000)},chkHotels:function(){if(n){return}var p="#PAGE .metaPriceInfo .header";var q=m(p,"header");if(!q){p="#PAGE .provider:not(.hidden):not(.grayed_out)";m(p,"provider")}},chkChevronLayer:function(p){a(p,true)},chkSmartDeals:function(){var p="#PAGE .lpContainer";a(p,true);p="#PAGE .listContainer";a(p,false)},chkHR:function(q){if(q&&!n){var p="#CHECK_RATES_CONT .offer:not(.remaining):not(.noLink)";m(p,"premium")}else{if(!i){var p="#CHECK_RATES_CONT .remaining .providerName:not(.noLink)";a(p,false)}}}}}(document,window,ta));ta.servlet.GeoCheckRates={checkBoxToggle:function(b,c){var a=$(c.parentNode);if(c.checked){a.addClass("checked")}else{a.removeClass("checked")}}};ta.common.scrollAd={_maxFails:10,_aAdHeights:[0,250,600],_adHeight:null,_adParent:null,_adElem:null,_ctrColElem:null,_spotSaved:false,_nFails:0,handleScroll:function(){var k=ta.common.scrollAd;var i=ta.retrieve("scrollAd.sbElem");if(!i){return}var n=k._adElem||ta.common.scrollAd._getAdElem(i);if(k._nFails>k._maxFails){window.removeEvent("scroll",window.ta_handleScroll);if(n){n.removeClass("scrollAd");n.style.marginTop=0}return}if(n){try{if(!k._ctrColElem){k._ctrColElem=document.getElement("#BODYCON .gridA .balance")||document.getElement("#BODYCON .gridR .balance")}var h=k._ctrColElem.offsetHeight;var a=i.offsetHeight;var d=k._adHeight||k._aAdHeights[Math.round(n.offsetHeight/300)];var l=h-a-d>0;if(!l){k._nFails++;if(window.getScroll().y>a){k._nFails+=k._maxFails}}else{var j=k._ctrColElem.getTop();var o=window.getScroll().y;var g=j+a-15;var c=j+h-d-15;var b=0;if(ta.has("pcr.overlay")){var f=ta.retrieve("pcr.overlay").visible;if(f){var p=document.getElement(".persistentCR.overlay");if(p){b=p.offsetHeight}}}if(o>g&&o<(c-b)){if(!k._spotSaved){k._saveSpot(n)}n.addClass("scrollAd");if(b>0){n.style.marginTop=b+"px"}else{n.style.marginTop=0}k._nFails=0}else{n.removeClass("scrollAd");n.style.marginTop=0}}}catch(m){ta.util.error.record(m,"ta.common.scrollAd:handleScroll")}}},_getAdElem:function(d){var c=ta.common.scrollAd;var b=ta.id(d).getElements(".ad.iab_medRec");var e=c._getAdParent(b);if(!e){c._nFails++;return}else{var a=e.getElement(".adInner");c._adElem=a;return a}},_getAdParent:function(d){var e=ta.common.scrollAd;var b=100;var a=d.length;var g;var f=ta.retrieve("scrollAd.adIndex");if(typeof f!="undefined"&&parseInt(f)){g=parseInt(f)}if(typeof g!="undefined"&&g<a){if(d[g].offsetHeight>b){e._adParent=d[g]}else{return}}else{for(var c=d.length-1;c>-1;c--){if(d[c].offsetHeight>b){e._adParent=d[c];return d[c]}}return}},_saveSpot:function(b){var d=ta.common.scrollAd;var a=ta.id(d._adParent);var c=d._aAdHeights[Math.round(b.offsetHeight/300)];if(c>0){d._adheight=c;if(document.all){a.style.zoom="1";b.style.position="static"}a.addClass("reserveH");a.style.height=c+"px";d._spotSaved=true}}};ta.p13n.Trending={getRecs:function(){try{var d="";if(ta.isAttractionsRedesign2012()){d="true"}else{if(ta.isRestaurantsRedesign2012()){d="false"}else{ta.util.error.record(null,"Trending servlet called from wrong page!");return}}var b=["geo="+modelGeoId,"isAttraction="+d];var a="http://"+document.domain+"/TrendingServlet?"+b.join("&");new Request({url:a,onSuccess:function(h){try{var g=ta.id("trendingModule");if(g){g.innerHTML=h}}catch(f){ta.util.error.record(f,"Trending module could not replace")}}}).send()}catch(c){ta.util.error.record(c,"Trending failed.")}}};